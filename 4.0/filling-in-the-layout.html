<html dir="ltr">
  <head>
    <title>Ruby on Rails チュートリアル</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="../stylesheets/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../stylesheets/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr">

<div id="book">
            




            
            
            <div id="cha-filling_in_the_layout" class="chapter" data-tralics-id="cid30" data-number="5" data-chapter="filling_in_the_layout">
<h1><a href="#cha-filling_in_the_layout" class="heading hyperref"><span class="number">第5章</span> レイアウトを作成する</a></h1>
<p><a class="hyperref" href="rails_flavored_ruby?version=4.2#cha-rails_flavored_ruby">第<span class="ref">4</span>章</a>の簡単なRubyツアーの中で、サンプルアプリケーション (<a class="hyperref" href="rails_flavored_ruby?version=4.2#sec-motivation"><span class="ref">4.1</span></a>) にアプリケーションスタイルシートを含める方法を学びました。しかし、<a class="hyperref" href="rails_flavored_ruby?version=4.2#sec-css_revisited"><span class="ref">4.3.4</span></a>で指摘したとおり、このスタイルシートは空のままです。この章では、アプリケーションにBootstrapフレームワークを組み込み、そして、カスタムスタイルを追加します<sup class="footnote" id="cha-5_footnote-ref-1"><a href="#cha-5_footnote-1">1</a></sup>。また、これまで作成したページ (HomeやAboutなど) へのリンクをレイアウトに追加します (<a class="hyperref" href="#sec-structure"><span class="ref">5.1</span></a>)。その途中で、パーシャル、Railsのルーティング、Asset Pipelineについて学び、さらにSassについても紹介します(<a class="hyperref" href="#sec-sass_and_the_asset_pipeline"><span class="ref">5.2</span></a>)。章の最後に、ユーザーをサイトにログインさせるための重要な一歩を踏み出します (<a class="hyperref" href="#sec-user_signup"><span class="ref">5.4</span></a>)。</p>
<p>本章では、サンプルアプリケーションにレイアウトを追加したり、修正したりといった部分に注力していきます。また、レイアウトについてはテスト駆動開発で進めたり、全くテストを書かない箇所もでてきます。テストを書くときと書かないときのガイドラインについては、<a class="hyperref" href="static_pages?version=4.2#aside-when_to_test">コラム<span class="ref">3.3</span></a>で解説します。この結果、本章ではテキストエディタによる修正とブラウザによる確認がほとんどになります。テスト駆動開発で進める唯一の箇所は、<a class="hyperref" href="#sec-contact_page"><span class="ref">5.3.1</span></a>のContactページの追加する箇所のみです。最後に、新しいテスト手法「 統合テスト (<em>Integration Test</em>)」について紹介します (<a class="hyperref" href="#sec-layout_link_tests"><span class="ref">5.3.4</span></a>)。統合テストを使って、最終的なレイアウトやリンクが正しいかどうかをチェックします。</p>
</div><div id="sec-structure" class="section" data-tralics-id="cid31" data-number="5.1">
<h2><a href="#sec-structure" class="heading hyperref"><span class="number">5.1</span> 構造を追加する</a></h2>
<p><em>Railsチュートリアル</em>はWeb開発のための本であり、Webデザインの本ではありませんが、だからといって<em>何のスタイルもない</em>寒々しい外観のアプリケーションでいつまでも作業を続けていると憂鬱になってしまいます。そこで、この章ではレイアウトにいくつかの構造とCSSを与えて最小限のスタイルを追加します。カスタムCSSルールの他に、Twitter社によるオープンソースのWebデザインフレームワークである<a href="http://getbootstrap.com/" target="_blank"><em>Bootstrap</em></a>を利用します。また、<em>コード</em>そのものにもスタイルを与えます。つまり、散らかりはじめたコードレイアウトを<em>パーシャル</em>を使用して整えるということです。</p>
<p>Webアプリケーションを作成するときに、ユーザーインターフェイスの概要をできるだけ早いうちに把握しておくことがしばしば有用です。本書の残りでは、<em>モックアップ</em> (Webの文脈ではよく <em>ワイヤーフレーム</em>と呼ばれます) という、最終的なアプリケーションの外観を示す一種のラフスケッチを使用することにします<sup class="footnote" id="cha-5_footnote-ref-2"><a href="#cha-5_footnote-2">2</a></sup>。この章では、 主に<a class="hyperref" href="static_pages?version=4.2#sec-static_pages"><span class="ref">3.2</span></a>で紹介したサイトロゴ、ナビゲーションヘッダー、サイトフッターを含む静的ページを開発します。これらのページの中で最も重要な、Homeページのモックアップを<a class="hyperref" href="#fig-home_page_mockup">図<span class="ref">5.1</span></a>に示します。モックアップに基いて作成した最終結果は<a class="hyperref" href="#fig-site_with_footer">図<span class="ref">5.7</span></a>で確認することができます。両者を見比べると、細部が若干異なることに気が付くでしょう (たとえば、実際には最後にRailsのロゴをページに追加します)。しかしモックアップは正確である必要はありませんので、これで十分です。</p>
<div class="center figure" id="fig-home_page_mockup" data-tralics-id="uid406" data-number="5.1">
<div class="graphics image box"><img src="http://railstutorial.jp/books/4.2/images/figures/home_page_mockup_3rd_edition.png" alt="images/figures/home_page_mockup_3rd_edition"></div>
<div class="caption">
<span class="header">図5.1</span> <span class="description">サンプルアプリケーションのHomeページのモックアップ
</span>
</div>
</div>
<p>Gitでバージョン管理をしているのであれば、これまでと同様、この時点で新しいブランチを作成するのがよいでしょう。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git checkout -b filling-in-layout
</pre></div></div>
<div id="sec-adding_to_the_layout" class="subsection" data-tralics-id="uid407" data-number="5.1.1">
<h3><a href="#sec-adding_to_the_layout" class="heading hyperref"><span class="number">5.1.1</span> ナビゲーション</a></h3>
<p>第一段階として、サンプルアプリケーションにリンクとスタイルを追加するために、サイトのレイアウトファイル<code>application.html.erb</code> (<a class="hyperref" href="rails_flavored_ruby?version=4.2#code-application_layout_full_title">リスト<span class="ref">4.3</span></a>で登場) にHTML構造を追加し、レイアウトファイルを更新します。この更新には、領域 (divタグ) の追加、CSSクラスの追加、サイトナビゲーションの起点となる領域の追加も含まれます。完全なファイルを<a class="hyperref" href="#code-layout_new_structure">リスト<span class="ref">5.1</span></a>に示します。続いて、これを構成している多くの部品について解説します。表示結果を今すぐ確認したいのであれば、<a class="hyperref" href="#fig-layout_no_logo_or_custom_css">図<span class="ref">5.2</span></a>で確認できます(<em>注:</em>この時点ではわざわざ見に行くほどの仕上がりではありませんが)。</p>
<div class="codelisting" id="code-layout_new_structure" data-tralics-id="uid408" data-number="5.1">
<div class="heading">
<span class="number">リスト5.1:</span> 

<span class="description">構造を追加したWebサイトのレイアウト<span class="break"></span> <span class="filepath">app/views/layouts/application.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span><span class="p">,</span>
                                           <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js"&gt;</span>
<span class="c">      &lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top navbar-inverse"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"sample app"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;nav&gt;</span>
          <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/nav&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div></div>
</div>
<p>それでは、<a class="hyperref" href="#code-layout_new_structure">リスト<span class="ref">5.1</span></a>の新しい要素を上から順に見ていきましょう。<a class="hyperref" href="static_pages?version=4.2#sec-testing_titles"><span class="ref">3.4.1</span></a>でも簡単に説明しましたが、RailsはデフォルトでHTML5を使用します (<code>&lt;!DOCTYPE html&gt;</code>というdoctypeでそのことが示されています)。HTML5は比較的新しく、一部のブラウザ (特に旧式のInternet Explorer) ではHTML5のサポートが不完全であるため、以下のようなJavaScriptコード (通称 “<a href="https://github.com/aFarkas/html5shiv" target="_blank">HTML5 shim</a>”)<sup class="footnote" id="cha-5_footnote-ref-3"><a href="#cha-5_footnote-3">3</a></sup> を使用してこの問題を回避します。</p>
<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">  &lt;script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js"&gt;</span>
<span class="c">  &lt;/script&gt;</span>
<span class="c">&lt;![endif]--&gt;</span>
</pre></div></div>
<p class="noindent">上のコードには、以下のような奇妙な構文が含まれています。</p>
<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
</pre></div></div>
<p class="noindent">これは、Microsoft Internet Explorer&nbsp;(IE) のバージョンが9より小さい場合 (<code>if lt IE 9</code>) にのみ、囲まれている行を実行します。この風変わりな文法<code> [if lt IE 9]</code> は、Railsの一部<em>ではありません</em>。これは実は、<a href="http://ja.wikipedia.org/wiki/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88" target="_blank">条件付きコメント</a>と呼ばれるもので、今回のような状況のためにInternet Explorerで特別にサポートされています。これにより、Firefox、Chrome、Safariなどの他のブラウザに影響を与えずに、IEのバージョンが9未満の場合に<em>のみ</em>HTML5 shimをインクルードすることができるため、非常に好都合です。</p>
<p>それに続くセクションには、サイトのロゴを表示する<code>header</code>、(<code>div</code>タグによる) いくつかの領域、ナビゲーションリンクのリストがあります。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top navbar-inverse"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"sample app"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;nav&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/nav&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div></div>
<p class="noindent"><code>header</code>タグは、ページのトップに来るべき要素を表します。この<code>header</code>タグには、<code>navbar</code>、<code>navbar-fixed-top</code>、<code>navbar-inverse</code>という3つの<em>CSSクラス</em><sup class="footnote" id="cha-5_footnote-ref-4"><a href="#cha-5_footnote-4">3</a></sup>がスペース区切りで与えられています。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top navbar-inverse"</span><span class="nt">&gt;</span>
</pre></div></div>
<p class="noindent">すべてのHTML要素には、クラスと<em>id</em>の両方を指定することができます。これらは単なるラベルで、CSSでスタイルを指定するときに便利です (<a class="hyperref" href="#sec-custom_css"><span class="ref">5.1.2</span></a>)。クラスとIDの主な違いは、クラスはページの中で何度でも使用できるのに対し、IDは一度しか使用することができない点です。今回の場合、すべてのnavbarクラスには、<a class="hyperref" href="#sec-custom_css"><span class="ref">5.1.2</span></a>でインストールするBootstrapフレームワークによって特別な意味が与えられます。</p>
<p><code>header</code>タグの内側には2つの<code>div</code>タグがあります。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
</pre></div></div>
<p class="noindent"><code>div</code>タグは一般的な表示領域を表し、ドキュメントを別々のパーツに分ける以外のことはしません。古いスタイルのHTMLでは、<code>div</code>タグはサイトのほぼすべての領域に使用されますが、HTML5では多くのアプリケーションに共通の領域で使用する<code>header</code>要素、<code>nav</code>要素、<code>section</code>要素が追加されています。この場合、<code>div</code>タグにもCSSクラス (<code>container</code>) が与えられています。<code>header</code>タグのクラスと同様に、このクラスもBootstrapにおいて特別な意味を持っています。</p>
<p>divに続いて、埋め込みRubyコードが出現します。</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"sample app"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div></div>
<p class="noindent">ここでは、リンク (<a class="hyperref" href="static_pages?version=4.2#sec-custom_static_pages"><span class="ref">3.3.2</span></a>で、アンカータグ<code>a</code>を使用して作成) を生成するために、Railsヘルパーの<code>link_to</code>を使用しています。<code>link_to</code>の第1引数はリンクテキスト、第2引数はURLです。このURIは<a class="hyperref" href="#sec-named_routes"><span class="ref">5.3.3</span></a>で<em>名前付きルート</em>のURLに変更しますが、今はWebデザインで一般に使用されるスタブURI<code>’#’</code>にしておきます。第3引数はオプションハッシュで、この場合はサンプルアプリのリンクでCSSのid <code>logo</code>を指定しています(他の3つのリンクにはオプションハッシュが指定されていませんが、必須ではないので構いません)。Railsヘルパーは、このようにオプションのハッシュを取ることがよくあり、これによりRailsのコードから離れることなく任意のHTMLオプションを柔軟に追加することができます。</p>
<p>divの内側の2番目の要素は、<em>リストアイテム</em>タグ<code>li</code>と<em>順不同リスト</em>タグ<code>ul</code>によって作られた、ナビゲーションリンクのリストです。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div></div>
<p class="noindent">正確にはここでは不要なのですが、<code>nav</code>タグには「その内側がナビゲーションリンクである」という意図を明示的に伝える役割があります。さらに、<code>ul</code>タグに付与されている<code>nav</code>や<code>navbar-nav</code>、<code>navbar-right</code>クラスもBootstrapにおいて特別な意味を持ちます。したがって、<a class="hyperref" href="#sec-custom_css"><span class="ref">5.1.2</span></a>でBootstrapのCSSを追加したときに、これらのスタイルも自動的に適用されます。ブラウザからソースを見ることで確認ができますが、Railsが埋め込みRubyを評価し、レイアウトを描画すると、上のリストは以下のように置き換わります<sup class="footnote" id="cha-5_footnote-ref-5"><a href="#cha-5_footnote-5">5</a></sup>。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Help<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Log in<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div></div>
<p class="noindent">これがブラウザに返されるHTMLになります。</p>
<p>レイアウトの最後の部分は、メインコンテンツ用の<code>div</code>です。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div></div>
<p class="noindent">上と同様、<code>container</code>クラスもBootstrapにおいて特別な意味を持ちます。<a class="hyperref" href="static_pages?version=4.2#sec-layouts_and_embedded_ruby"><span class="ref">3.4.3</span></a>で学んだように、<code>yield</code>メソッドはWebサイトのレイアウトにページごとの内容を挿入します。</p>
<p><a class="hyperref" href="#sec-partials"><span class="ref">5.1.3</span></a>で追加するサイトフッターを除いて、これでレイアウトは完成しました。Homeページへアクセスして表示結果を確認することができます。今後登場するスタイル要素を利用できるようにするために、<code>home.html.erb</code>ビューに特別な要素をいくつか追加します(<a class="hyperref" href="#code-signup_button">リスト<span class="ref">5.2</span></a>)。</p>
<div class="codelisting" id="code-signup_button" data-tralics-id="uid412" data-number="5.2">
<div class="heading">
<span class="number">リスト5.2:</span> 

<span class="description">サインアップページへのリンクがあるHomeページ<span class="break"></span> <span class="filepath">app/views/static_pages/home.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center jumbotron"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.railstutorial.org/"</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign up now!"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-lg btn-primary"</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">"rails.png"</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="s2">"Rails logo"</span><span class="p">),</span>
            <span class="s1">'http://rubyonrails.org/'</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p class="noindent"><a class="hyperref" href="sign_up?version=4.2#cha-sign_up"><span class="ref">第7章</span></a>でサイトにユーザーを追加するときに備えて、最初の<code>link_to</code>に仮のリンクを作成します。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">class=</span><span class="s">"btn btn-lg btn-primary"</span><span class="nt">&gt;</span>Sign up now!<span class="nt">&lt;/a&gt;</span>
</pre></div></div>
<p class="noindent">上で挙げた<code>div</code>タグのCSSクラス<code>jumbotron</code>や、signupボタンの<code>btn</code>クラス、<code>btn-lg</code>クラス、<code>btn-primary</code>クラスはすべて、Bootstrapにおいて特別な意味を持ちます。</p>
<p>2番目の<code>link_to</code>では、引数として画像ファイルのパスと任意のオプションハッシュをとる<code>image_tag</code>ヘルパーの能力が示されています。シンボルを使用して、この場合は<code>alt</code>属性を設定しています。画像を表示するためには、<code>rails.png</code>というRailsのロゴ画像ファイルを加える必要があります。Ruby on Rails公式ページの <a href="http://rubyonrails.org/images/rails.png" target="_blank">http://rubyonrails.org/images/rails.png</a>から画像をダウンロードして、<code>app/assets/images/</code>ディレクトリに置いてください。Cloud IDEやUnix系のOS (Max OS Xなど) を使っている場合は、次のように<code>curl</code>コマンドで簡単に取得できます<sup class="footnote" id="cha-5_footnote-ref-6"><a href="#cha-5_footnote-6">6</a></sup>。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> curl -O http://rubyonrails.org/images/rails.png
<span class="gp">$</span> mv rails.png app/assets/images/
</pre></div></div>
<p class="noindent">Cloud IDEを使っていると、(筆者にも理由は分からないのですが) ときどき2行目のmvコマンドで失敗することがあるようです。その場合は、1行目の<code>curl</code>コマンドをもう一度実行して、ロゴ画像が正しくダウンロードできているかどうか確認してください (<code>curl</code>コマンドの詳細については、<a href="http://conqueringthecommandline.com/book/curl" target="_blank"><em>Conquering the Command Line</em>という本の第3章</a> (英語) を参照してください) 。<a class="hyperref" href="#code-signup_button">リスト<span class="ref">5.2</span></a>で<code>image_tag</code>ヘルパーを使っているので、Railsは該当する画像ファイルを、アセットパイプラインを通して<code>app/assets/images/</code>ディレクトリの中から探してくれます (アセットパイプラインについては<a class="hyperref" href="#sec-sass_and_the_asset_pipeline"><span class="ref">5.2</span></a>で説明します)。</p>
<p><code>image_tag</code>の効果を確かめるために、ブラウザから生成されたHTMLを見てみましょう<sup class="footnote" id="cha-5_footnote-ref-7"><a href="#cha-5_footnote-7">7</a></sup>。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"Rails logo"</span> <span class="na">src=</span><span class="s">"/assets/rails-9308b8f92fea4c19a3a0d8385b494526.png"</span> <span class="nt">/&gt;</span>
</pre></div></div>
<p class="noindent">ファイル名が重ならないようにするために、Railsが<code>9308b8f92fea4c19a3a0d8385b494526</code>という文字列 (実際の文字列はシステムごとに異なります) を追加していることがわかります。これは、たとえば画像ファイルを新しい画像に更新したときに、ブラウザ内に保存されたキャッシュに意図的にヒットさせないようにするための仕組みです。また、<code>src</code>属性には "<code>images</code>" というディレクトリ名が<em>含まれていない</em>ことにも注目してください。これは<code>assets</code>ディレクトリ内の他のディレクトリ (imagesやjavascripts、stylesheetsなど) も同様です。これは高速化のための仕組みで、Railsは<code>assets</code>ディレクトリ直下の画像を<code>app/assets/images</code>ディレクトリにある画像と紐付けています。これにより、ブラウザから見るとすべてのファイルが同じディレクトリにあるように見えるようになります。そして、このようなフラットなディレクトリ構成を採っていると、ファイルをより高速にブラウザに渡すことができるようになります。最後に、<code>alt</code>属性は、画像がない場合に代わりに表示される文字列です。たとえば視覚障害のあるユーザーが使用するスクリーンリーダーでは、ここの属性が読み上げられて、そこに画像があることが示されます。</p>
<p>いよいよ、ここまでの苦労の成果を確認する準備ができました (<a class="hyperref" href="#fig-layout_no_logo_or_custom_css">図<span class="ref">5.2</span></a>)。思っていたよりもみすぼらしいでしょうか。そうかもしれません。しかし、HTML要素に実用的なクラスを与えるという良い仕事ができたのも確かです。さらに、クラスを与えたこの段階で、CSSを使用してサイトにスタイルを与えることができたのは、タイミングとして非常に適切であると思います。</p>
<div class="center figure" id="fig-layout_no_logo_or_custom_css" data-tralics-id="uid415" data-number="5.2">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/layout_no_logo_or_custom_css_bootstrap_3rd_edition.png" alt="images/figures/layout_no_logo_or_custom_css_bootstrap_3rd_edition"></div>
<div class="caption">
<span class="header">図5.2</span> <span class="description">カスタムCSSを使用していないHomeページ</span>
</div>
</div>
</div>
<div id="sec-custom_css" class="subsection" data-tralics-id="uid416" data-number="5.1.2">
<h3><a href="#sec-custom_css" class="heading hyperref"><span class="number">5.1.2</span> BootstrapとカスタムCSS</a></h3>
<p><a class="hyperref" href="#sec-adding_to_the_layout"><span class="ref">5.1.1</span></a>では、多くのHTML要素にCSSクラスを関連付けました。こうしておくことで、CSSベースでレイアウトを構成する際に高い柔軟性を与えてくれます。<a class="hyperref" href="#sec-adding_to_the_layout"><span class="ref">5.1.1</span></a>で述べたように、これらのクラスの多くは、Twitterが作成したフレームワークである<a href="http://getbootstrap.com/" target="_blank">Bootstrap</a>特有のものです。Bootstrapを使用すると、洗練されたWebデザインとユーザーインターフェイス要素を簡単にHTML5アプリケーションに追加することができます。この節では、サンプルアプリケーションにスタイルを追加するために、カスタムCSSルールとBootstrapを組み合わせて使用します。注目すべき点は、Bootstrapを使うことでアプリケーションを<a href="http://e-words.jp/w/%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B7%E3%83%96%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3.html" target="_blank"><em>レシポンシブデザイン</em></a>にできるということです。これにより、どの端末でアプリケーションを閲覧しても、ある程度見栄えをよくすることができます。</p>
<p>最初に、<a class="hyperref" href="#code-bootstrap_sass">リスト<span class="ref">5.3</span></a>で示しているようにBootstrapを追加しましょう。これは、<span class="tt">bootstrap-sass</span> gemを使用してRailsアプリケーションに導入できます。Bootstrapフレームワークでは、動的なスタイルシートを生成するために<a href="http://lesscss.org/" target="_blank">LESS CSS</a>言語を使用していますが、RailsのAsset Pipelineはデフォルトでは (LESSと非常によく似た) Sass言語をサポートします (<a class="hyperref" href="#sec-sass_and_the_asset_pipeline"><span class="ref">5.2</span></a>)。そのため、<span class="tt">bootstrap-sass</span>は、LESSをSassへ変換し、必要なBootstrapファイルを現在のアプリケーションですべて利用できるようにします<sup class="footnote" id="cha-5_footnote-ref-8"><a href="#cha-5_footnote-8">8</a></sup>。</p>
<div class="codelisting" id="code-bootstrap_sass" data-tralics-id="uid418" data-number="5.3">
<div class="heading">
<span class="number">リスト5.3:</span> 

<span class="description"><code>Gemfile</code>へ<span class="tt">bootstrap-sass</span>を追加する</span>
</div>

<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span>                <span class="s1">'4.2.2'</span>
<span class="n">gem</span> <span class="s1">'bootstrap-sass'</span><span class="p">,</span>       <span class="s1">'3.2.0.0'</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div></div>
</div>
<p class="noindent">いつものように<code>bundle install</code>を実行して、Bootstrapをインストールします。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install</pre></div></div>
<p>ちなみに、<code>rails generate</code>コマンドを実行することでコントローラーごとに分けられたCSSファイルが自動的に生成されますが、これらのファイルを正しい順序で読み込ませるのは至難の技なので、本チュートリアルでは (簡潔のために) すべてのCSSを1つにまとめる方針を採っています。カスタムCSSを動かすための最初の一歩は、カスタムCSSファイルを作ることです。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> touch app/assets/stylesheets/custom.css.scss
</pre></div></div>
<p class="noindent">(ここでは<a class="hyperref" href="static_pages?version=4.2#sec-green"><span class="ref">3.3.3</span></a>の途中で紹介した<code>touch</code>コマンドを使っていますが、ファイルが作成できるなら [新規ファイル作成] や他のコマンドでも問題ありません。) このディレクトリ名とファイル名は、どちらも重要です。以下のディレクトリは、</p>
<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets/</span>
</pre></div></div>
<p class="noindent">Asset Pipeline (<a class="hyperref" href="#sec-sass_and_the_asset_pipeline"><span class="ref">5.2</span></a>)の一部であり、このディレクトリに置かれたスタイルシートは<code>application.css</code>の一部として自動的にWebサイトのレイアウトにインクルードされます。さらに、ファイル名の<code>custom.css.scss</code>には<code>.css</code>という拡張子も含まれているので、このファイルはCSSファイルであることが示されています。また、<code>.scss</code>という拡張子も含まれているので、 このファイルはSassを記述できるCSSファイル (Sassy CSS: Scss) であることも示されており、Asset Pipelineはこれを見てSassを処理できるようにします(Sassは<a class="hyperref" href="#sec-sass"><span class="ref">5.2.2</span></a>まで登場しませんが、<span class="tt">bootstrap-sass</span> gemが動作するためのおまじないとして必要です)。</p>
<p>カスタムCSS用のファイルを作成したら、<a class="hyperref" href="#code-bootstrap_css">リスト<span class="ref">5.4</span></a>のように<code>@import</code>を使用して、Bootstrap (とそれに関連するSprockets) をインクルードします<sup class="footnote" id="cha-5_footnote-ref-9"><a href="#cha-5_footnote-9">9</a></sup>。</p>
<div class="codelisting" id="code-bootstrap_css" data-tralics-id="uid420" data-number="5.4">
<div class="heading">
<span class="number">リスト5.4:</span> 

<span class="description">Bootstrap CSSを追加する<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>
</pre></div></div>
</div>
<p class="noindent"><a class="hyperref" href="#code-bootstrap_css">リスト<span class="ref">5.4</span></a>の2行では、Bootstrap CSSのフレームワークを導入しています。導入後、Webサーバを再起動させると、アプリケーションに反映させることができます (<a class="hyperref" href="beginning?version=4.2#sec-rails_server"><span class="ref">1.3.2</span></a>で紹介したように、Ctrl-Cを押してWebサーバを停止させた後、<code>rails server</code>コマンドを打ってWebサーバを起動してください)。うまくいけば<a class="hyperref" href="#fig-sample_app_only_bootstrap">図<span class="ref">5.3</span></a>のような結果になります。さて、テキストの配置は今ひとつで、ロゴにはスタイルもありませんが、色使いとsignupボタンはなかなかよい感じになってきました。</p>
<div class="center figure" id="fig-sample_app_only_bootstrap" data-tralics-id="uid421" data-number="5.3">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/sample_app_only_bootstrap_3rd_edition.png" alt="images/figures/sample_app_only_bootstrap_3rd_edition"></div>
<div class="caption">
<span class="header">図5.3</span> <span class="description">Bootstrap CSSとサンプルアプリケーション</span>
</div>
</div>
<p>次に、<a class="hyperref" href="#code-universal_css">リスト<span class="ref">5.5</span></a>に示したように、Webサイト全体にわたってレイアウトと個別のページにスタイルを与えるためのCSSを追加します。テストの結果を<a class="hyperref" href="#fig-sample_app_universal">図<span class="ref">5.4</span></a>に示します。<a class="hyperref" href="#code-universal_css">リスト<span class="ref">5.5</span></a>には多数の記述ルールがあります。CSSの記述ルールを把握するためには、関心のある箇所をコメントアウトして表示を確認することをお勧めします。CSSでは、<code>/* … */</code>でコメントアウトできるので、調べてみたいコードをこれで囲い、表示がどのように変わるかを確認してみてください。</p>
<div class="codelisting" id="code-universal_css" data-tralics-id="uid422" data-number="5.5">
<div class="heading">
<span class="number">リスト5.5:</span> 

<span class="description">すべてのページに適用される共通のスタイルをCSSに追加する<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-sample_app_universal" data-tralics-id="uid423" data-number="5.4">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/sample_app_universal_3rd_edition.png" alt="images/figures/sample_app_universal_3rd_edition"></div>
<div class="caption">
<span class="header">図5.4</span> <span class="description">スペースや共通スタイルを追加した結果
</span>
</div>
</div>
<p><a class="hyperref" href="#code-universal_css">リスト<span class="ref">5.5</span></a>のCSSの形式は一貫しています。CSSルールでは一般に、クラス、id、HTMLタグ、またはそれらの組み合わせ、のいずれかを指定します。そしてその後ろにスタイリングコマンドのリストを記述します。たとえば、以下のコードでは、</p>
<div class="code"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent">ページ上部に60ピクセルの余白を追加します。<code>header</code>タグに<code>navbar-fixed-top</code>クラスが与えられているので、これに従ってBootstrapはナビゲーションバーをページ上部に固定し、ナビゲーションバーの下に余白を置いて主要部分から分離します(デフォルトのnavbarの色がBootstrap 2.0から変更されたため、現在の淡色の代わりにダークな色調にしたい場合は<code>navbar-inverse</code>クラスを使用する必要があります)。また、このルールにある以下のCSSは、</p>
<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent"><code>center</code>クラスに<code>text-align: center</code>プロパティを関連付けています。言い換えると、<code>.center</code>冒頭のドット<code>.</code>は、このルールがクラスに対してスタイルを適用することを示しています。(冒頭がポンド記号<code>#</code>の場合は、<a class="hyperref" href="#code-logo_css">リスト<span class="ref">5.7</span></a>に示したように、そのルールがCSSの<em>id</em>に対してスタイルを適用することを示します。この場合、<code>center</code>クラスに属している (<code>div</code>などの) タグの内側にある要素は、すべてページ中でセンタリングされることを意味しています(このクラスの例は<a class="hyperref" href="#code-signup_button">リスト<span class="ref">5.2</span></a>で参照できます)。</p>
<p>Bootstrapには洗練されたタイポグラフィーを利用できるCSSルールがありますが、ここではさらに、<a class="hyperref" href="#code-typography_css">リスト<span class="ref">5.6</span></a>に示したようにサイトのテキストの外観を変えるカスタムCSSルールを追加しましょう。(これらのルールはHomeページですべて適用されるとは限りませんが、サンプルアプリケーションの他の場所でも使用されるものもあります)。<a class="hyperref" href="#code-typography_css">リスト<span class="ref">5.6</span></a>を反映した結果を<a class="hyperref" href="#fig-sample_app_typography">図<span class="ref">5.5</span></a>で確認することができます。</p>
<div class="codelisting" id="code-typography_css" data-tralics-id="uid424" data-number="5.6">
<div class="heading">
<span class="number">リスト5.6:</span> 

<span class="description">洗練されたタイポグラフィーを利用するためのCSSを追加する<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="o">/*</span> <span class="nt">typography</span> <span class="o">*/</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.2</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-sample_app_typography" data-tralics-id="uid425" data-number="5.5">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/sample_app_typography_3rd_edition.png" alt="images/figures/sample_app_typography_3rd_edition"></div>
<div class="caption">
<span class="header">図5.5: </span><span class="description">タイポグラフィースタイルを追加する
</span>
</div>
</div>
<p>最後に、いくつかのルールをサイトロゴに追加します。このサイトロゴは「sample app」だけが表示されているシンプルなものです。<a class="hyperref" href="#code-logo_css">リスト<span class="ref">5.7</span></a>のCSSは、テキストを大文字に変換し、サイズ、色、配置を変更します(サイトロゴがページで一度しか使用されないことを前提としてCSS idを使用していますが、代わりにクラスを使用することもできます)。</p>
<div class="codelisting" id="code-logo_css" data-tralics-id="uid426" data-number="5.7">
<div class="heading">
<span class="number">リスト5.7:</span> 

<span class="description">サイトロゴにCSSを追加する<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="o">/*</span> <span class="nt">header</span> <span class="o">*/</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
</div>
<p class="noindent">上のコードの<code>color: #fff</code>は、ロゴの色を白に変更します。HTMLの色は、16進数 (基数が16) の3つの数値の組み合わせで表現され、赤、緑、青の三原色に (この順序で) コード化することができます。このコード<code>#ffffff</code>は、3色すべてが最大に使用されており、純白になります。なお、<code>#fff</code>は、完全な<code>#ffffff</code>の短縮形です。CSS標準には、共通<a href="http://www.google.com/url?q=http%3A%2F%2Fwww.w3schools.com%2Fhtml%2Fhtml_colornames.asp&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH80Xqn0NJxi4Z2DXhn6tfSquaVDA">HTMLカラー</a>の別名も多数定義されています。たとえば、<code>#fff</code>を<code>white</code>と書くこともできます。<a class="hyperref" href="#code-logo_css">リスト<span class="ref">5.7</span></a>のCSSの結果は<a class="hyperref" href="#fig-sample_app_logo">図<span class="ref">5.6</span></a>で確認できます。</p>
<div class="center figure" id="fig-sample_app_logo" data-tralics-id="uid427" data-number="5.6">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/sample_app_logo_3rd_edition.png" alt="images/figures/sample_app_logo_3rd_edition"></div>
<div class="caption">
<span class="header">図5.6</span> <span class="description">デザインされたロゴとサンプルアプリ
</span>
</div>
</div>
</div>
<div id="sec-partials" class="subsection" data-tralics-id="uid428" data-number="5.1.3">
<h3><a href="#sec-partials" class="heading hyperref"><span class="number">5.1.3</span> パーシャル (partial)</a></h3>
<p><a class="hyperref" href="#code-layout_new_structure">リスト<span class="ref">5.1</span></a>のレイアウトはその目的を果たしていますが、少々散らかっています。HTML shimは、それだけで3行も占有し、風変わりなIE特有の文法を使用しているので、これをうまく隠すことができたらどんなによいでしょう。また、HTMLヘッダーは論理的な単位を形成するため、一箇所にまとめる必要もあります。Railsでは、<em>パーシャル (partial)</em> と呼ばれる機能を使用してこれを実現することができます。最初に、パーシャルを定義するとレイアウトがどのように変わるかを見てみましょう (<a class="hyperref" href="#code-layout_with_partials">リスト<span class="ref">5.8</span></a>)。</p>
<div class="codelisting" id="code-layout_with_partials" data-tralics-id="uid429" data-number="5.8">
<div class="heading">
<span class="number">リスト5.8:</span> 

<span class="description">レイアウトにshimとheaderのパーシャルを追加する<span class="break"></span> <span class="filepath">app/views/layouts/application.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s1">'all'</span><span class="p">,</span>
                                           <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="s1">'data-turbolinks-track'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/shim'</span> <span class="cp">%&gt;</span>
</span>  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/header'</span> <span class="cp">%&gt;</span>
</span>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div></div>
</div>
<p><a class="hyperref" href="#code-layout_with_partials">リスト<span class="ref">5.8</span></a>では、以下のように<code>render</code>と呼ばれるRailsヘルパー呼び出しだけを使って、HTML shimのスタイルシート行を置換しています。</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/shim'</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p class="noindent">この行では、<code>app/views/layouts/_shim.html.erb</code>というファイルを探してその内容を評価し、結果をビューに挿入しています<sup class="footnote" id="cha-5_footnote-ref-10"><a href="#cha-5_footnote-10">10</a></sup> (<span class="inline_verbatim">&lt;%= ... %&gt;</span>は、テンプレート内でRubyの式を評価するための埋め込みRuby記法であることを思い出してください。評価した結果がテンプレートに挿入されます)。ファイル名<code>_shim.html.erb</code>の前のアンダースコアに注目してください。このアンダースコアは、パーシャルで使用する普遍的な命名規約であり、また、一目見ただけでディレクトリ中のすべてのパーシャルを識別することが可能になります。</p>
<p>もちろん、パーシャルが動作するためには、それに対応するファイルとコンテンツを記述しなければなりません。このshimパーシャルの場合は、<a class="hyperref" href="#code-layout_new_structure">リスト<span class="ref">5.1</span></a>のわずか3行のshimコードだけです。追加した結果を<a class="hyperref" href="#code-stylesheets_partial">リスト<span class="ref">5.9</span></a>に示します</p>
<div class="codelisting" id="code-stylesheets_partial" data-tralics-id="uid431" data-number="5.9">
<div class="heading">
<span class="number">リスト5.9:</span> 

<span class="description">HTML shim用のパーシャル<span class="break"></span> <span class="filepath">app/views/layouts/_shim.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">  &lt;script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js"&gt;</span>
<span class="c">  &lt;/script&gt;</span>
<span class="c">&lt;![endif]--&gt;</span>
</pre></div></div>
</div>
<p>同様に、他のヘッダーの情報も<a class="hyperref" href="#code-header_partial">リスト<span class="ref">5.10</span></a>のパーシャルに移動し、<code>render</code>を呼び出してレイアウトに挿入することができます。(パーシャルでは、自動生成せずに、テキストエディタを使って手動で作成するのが一般的です。)</p>
<div class="codelisting" id="code-header_partial" data-tralics-id="uid432" data-number="5.10">
<div class="heading">
<span class="number">リスト5.10:</span> 

<span class="description">header用のパーシャル<span class="break"></span> <span class="filepath">app/views/layouts/_header.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top navbar-inverse"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"sample app"</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;nav&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/nav&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div></div>
</div>
<p>これでパーシャルの作成方法がわかりましたので、今度はヘッダーに対応するフッターを同じ方法で追加しましょう。ここまでくれば、ファイル名は<code>_footer.html.erb</code>で、layoutsディレクトリ (<a class="hyperref" href="#code-footer_partial">リスト<span class="ref">5.11</span></a>) に置けばよいということがわかると思います<sup class="footnote" id="cha-5_footnote-ref-11"><a href="#cha-5_footnote-11">11</a></sup>。</p>
<div class="codelisting" id="code-footer_partial" data-tralics-id="uid434" data-number="5.11">
<div class="heading">
<span class="number">リスト5.11:</span> 

<span class="description">footer用のパーシャル<span class="break"></span> <span class="filepath">app/views/layouts/_footer.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.railstutorial.org/"</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.michaelhartl.com/"</span><span class="nt">&gt;</span>Michael Hartl<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"About"</span><span class="p">,</span>   <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Contact"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://news.railstutorial.org/"</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div></div>
</div>
<p class="noindent">ヘッダーの場合と同様に、フッターの中でも<code>link_to</code>メソッドを使用して、AboutページとContactページへの内部リンクを追加してあります。ひとまず、リンク先のURLは<code>’#’</code>としておきます(<code>header</code>タグと同様、<code>footer</code>タグもHTML5で新たに追加された要素です)。</p>
<p>フッタパーシャルは、スタイルシートやヘッダーパーシャルのときと同じ方法でレイアウト中に追加できます (<a class="hyperref" href="#code-layout_with_footer">リスト<span class="ref">5.12</span></a>)。</p>
<div class="codelisting" id="code-layout_with_footer" data-tralics-id="uid435" data-number="5.12">
<div class="heading">
<span class="number">リスト5.12:</span> 

<span class="description">レイアウトにfooterパーシャルを追加する<span class="break"></span> <span class="filepath">app/views/layouts/application.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="ss">media</span><span class="p">:</span> <span class="s2">"all"</span><span class="p">,</span>
                                           <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbolinks-track"</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/shim'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/header'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'layouts/footer'</span> <span class="cp">%&gt;</span>
</span>    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div></div>
</div>
<p>そのまま実際にフッターを表示してみるとどうにも見苦しいので、<a class="hyperref" href="#code-footer_css">リスト<span class="ref">5.13</span></a>でスタイルを若干追加しましょう。スタイルを追加した結果を<a class="hyperref" href="#fig-site_with_footer">図<span class="ref">5.7</span></a>に示します。</p>
<div class="codelisting" id="code-footer_css" data-tralics-id="uid436" data-number="5.13">
<div class="heading">
<span class="number">リスト5.13:</span> 

<span class="description">サイトにfooter用CSSを追加する<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="o">/*</span> <span class="nt">footer</span> <span class="o">*/</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">small</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
  <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-left</span><span class="o">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-site_with_footer" data-tralics-id="uid437" data-number="5.7">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/site_with_footer_bootstrap_3rd_edition.png" alt="images/figures/site_with_footer_bootstrap_3rd_edition"></div>
<div class="caption">
<span class="header">図5.7</span> <span class="description">Homeページにfooterを追加する
</span>
</div>
</div>
</div>
</div><div id="sec-sass_and_the_asset_pipeline" class="section" data-tralics-id="cid32" data-number="5.2">
<h2><a href="#sec-sass_and_the_asset_pipeline" class="heading hyperref"><span class="number">5.2</span> SassとAsset Pipeline</a></h2>
<p>最近のRailsに追加された機能の中で最も特筆すべき機能のひとつは、CSS、JavaScript、画像などの静的コンテンツの生産性と管理を大幅に強化する「<em>Asset Pipeline</em>」です。この節では、Asset Pipelineの概要と、素晴らしいCSS生成ツールである「<em>Sass</em>」の使い方について説明します。</p>
<div id="sec-the_asset_pipeline" class="subsection" data-tralics-id="uid438" data-number="5.2.1">
<h3><a href="#sec-the_asset_pipeline" class="heading hyperref"><span class="number">5.2.1</span> Asset Pipeline</a></h3>
<p>アセットパイプラインは、Railsの流儀を守りながら多大な変化をもたらしますが、一般的なRails開発者の視点からは、アセットディレクトリ、マニフェストファイル、プリプロセッサエンジンという、3つの主要な機能が理解の対象となります<sup class="footnote" id="cha-5_footnote-ref-12"><a href="#cha-5_footnote-12">12</a></sup>。では、それぞれを順に見ていきましょう。</p>
<div id="uid440" class="subsubsection" data-tralics-id="uid440" data-number="5.2.1.1">
<h4><a href="#uid440" class="heading">アセットディレクトリ</a></h4>
<p>Rails 3.0以前のバージョンでは、静的ファイルは<code>public/</code>以下の次のディレクトリに置かれていました。</p>
<ul>
<li>
<code>public/stylesheets</code>
</li>
<li>
<code>public/javascripts</code>
</li>
<li>
<code>public/images</code>
</li>
</ul>
<p class="noindent">これらのディレクトリ中のファイルは http://example.com/stylesheets のようなリクエストによって自動的に配信されます。これは3.0以降も同様です。</p>
<p>Rails3.1以降では、静的ファイルを目的別に分類する、標準的な<em>3つの</em>ディレクトリが使用されるようになりました。最新のRailsでも同様です。</p>
<ul>
<li>
<code>app/assets</code>: 現在のアプリケーション固有のアセット</li>
<li>
<code>lib/assets</code>: あなたの開発チームによって作成されたライブラリ用のアセット</li>
<li>
<code>vendor/assets</code>: サードパーティのアセット</li>
</ul>
<p class="noindent">これらのディレクトリには、それぞれのアセットクラス用のサブディレクトリがあります。たとえば、app/assetsには次のようなサブディレクトリがあります。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/assets/
<span class="go">images/  javascripts/  stylesheets/</span>
</pre></div></div>
<p>上記の説明から、<a class="hyperref" href="#sec-custom_css"><span class="ref">5.1.2</span></a>で取り上げたカスタムCSSが配置された場所と、その理由について理解することができると思います。<code>custom.css.scss</code>は、サンプルアプリケーション固有のアセットなので、<code>app/assets/stylesheets</code>に配置されているのです。</p>
</div>
<div id="uid447" class="subsubsection" data-tralics-id="uid447" data-number="5.2.1.2">
<h4><a href="#uid447" class="heading">マニフェストファイル</a></h4>
<p>アセットを上記の論理的な場所へ配置すれば、<em>マニフェストファイル</em>を使用して、それらをどのように1つのファイルにまとめるのかをRailsに指示することができます。なお、実際にまとめるのは<a href="https://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Fsstephenson%2Fsprockets&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGZJvnWyvkI9kTnoU538f69H-n8gA">Sprockets</a> gemが行います。(マニフェストファイルはCSSとJavaScriptには適用されますが、画像ファイルには適用されません) 。1つの例として、アプリケーションスタイルシート用のマニフェストファイルを見てみましょう (<a class="hyperref" href="#code-app_css_manifest">リスト<span class="ref">5.14</span></a>)。</p>
<div class="codelisting" id="code-app_css_manifest" data-tralics-id="uid448" data-number="5.14">
<div class="heading">
<span class="number">リスト5.14:</span> 

<span class="description">アプリケーション固有のCSS用マニフェストファイル<span class="break"></span> <span class="filepath">app/assets/stylesheets/application.css</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This is a manifest file that'll be compiled into application.css, which</span>
<span class="cm"> * will include all the files listed below.</span>
<span class="cm"> *</span>
<span class="cm"> * Any CSS and SCSS file within this directory, lib/assets/stylesheets,</span>
<span class="cm"> * vendor/assets/stylesheets, or vendor/assets/stylesheets of plugins, if any,</span>
<span class="cm"> * can be referenced here using a relative path.</span>
<span class="cm"> *</span>
<span class="cm"> * You're free to add application-wide styles to this file and they'll appear</span>
<span class="cm"> * at the bottom of the compiled file so the styles you add here take</span>
<span class="cm"> * precedence over styles defined in any styles defined in the other CSS/SCSS</span>
<span class="cm"> * files in this directory. It is generally better to create a new file per</span>
<span class="cm"> * style scope.</span>
<span class="cm"> *</span>
<span class="hll"><span class="cm"> *= require_tree .</span>
</span><span class="hll"><span class="cm"> *= require_self</span>
</span><span class="cm"> */</span>
</pre></div></div>
</div>
<p class="noindent">上の行で重要な部分は実はCSSコメントの中にあります。以下の行は、適切なファイルをインクルードするためにSprocketsによって使用されます。</p>
<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> *= require_tree .</span>
<span class="cm"> *= require_self</span>
<span class="cm">*/</span>
</pre></div></div>
<p class="noindent">以下の行は、</p>
<div class="code"><div class="highlight"><pre><span class="go">*= require_tree .</span>
</pre></div></div>
<p class="noindent"><code>app/assets/stylesheets</code>ディレクトリ (サブディレクトリを含む) 中のすべてのCSSファイルが、アプリケーションCSSに含まれるようにします。次の行</p>
<div class="code"><div class="highlight"><pre><span class="go">*= require_self</span>
</pre></div></div>
<p class="noindent">CSSの読み込みシーケンスの中で、<code>application.css</code>自身もインクルードすることを指定しています。</p>
<p>Railsには実用的なデフォルトのマニフェストファイルが付属しているので、<em>Railsチュートリアル</em>では変更を加える必要がありませんが、もし必要な場合は、Railsガイドの「<a href="http://railsguides.jp/asset_pipeline.html" target="_blank">アセットパイプライン</a>」で詳細な情報を参照できます。</p>
</div>
<div id="uid449" class="subsubsection" data-tralics-id="uid449" data-number="5.2.1.3">
<h4><a href="#uid449" class="heading">プリプロセッサエンジン</a></h4>
<p>必要なアセットをディレクトリに配置してまとめた後、Railsはさまざまなプリプロセッサエンジンを介してそれらを実行し、ブラウザに配信できるようにそれらをマニフェストファイルを用いて結合し、サイトテンプレート用に準備します。Railsは、どのプリプロセッサを使用するかを、ファイル名の拡張子を使用して判断します。最も一般的な拡張子は、Sass用の<code>.scss</code>、CoffeeScript用の<code>.coffee</code>、埋め込みRuby (ERb) 用の<code>.erb</code>です。<a class="hyperref" href="static_pages?version=4.2#sec-layouts_and_embedded_ruby"><span class="ref">3.4.3</span></a>では最初にERbを、<a class="hyperref" href="#sec-sass"><span class="ref">5.2.2</span></a>ではSassをそれぞれ扱いました。なお本書では扱いませんが、CoffeeScriptはエレガントで簡潔な言語で、JavaScriptにコンパイルして実行します(興味のある方は、RailsCastの「<a href="http://railscasts.com/episodes/267-coffeescript-basics" target="_blank">CoffeeScriptの基礎</a> (英語)」から始めると良いでしょう)。</p>
<p>プリプロセッサエンジンはつなげて実行する (chain) ことができます。</p>
<p class="noindent"><code>foobar.js.coffee</code></p>
<p class="noindent">上の拡張子の場合、CoffeeScriptプロセッサ経由で実行されます。</p>
<p class="noindent"><code>foobar.js.erb.coffee</code></p>
<p class="noindent">上の拡張子の場合は、CoffeeScriptとERbの両方で実行されます (コードは右から左へと実行されますので、この例ではCoffeeScriptが最初に実行されます)。</p>
</div>
<div id="uid450" class="subsubsection" data-tralics-id="uid450" data-number="5.2.1.4">
<h4><a href="#uid450" class="heading">本番環境での効率性</a></h4>
<p>Asset Pipelineの最大のメリットの1つは、本番のアプリケーションで効率的になるように最適化されたアセットも自動的に生成されることです。従来は、CSSとJavaScriptを整理するために、機能を個別のファイルに分割し、(インデントを多用して) 読みやすいフォーマットに整えていました。これは、プログラマにとっては便利な方法ですが、本番環境にとっては非効率です。それというのも、最小化されていないCSSやJavaScriptファイルを多数インクルードすると、ページの読み込み時間が著しく遅くなるからです (読み込み時間は、ユーザー体験の質に影響を与える重要な指標の1つです)。Asset Pipelineを使うと、この「開発効率と読み込み時間のどちらを重視するか」という問題について悩む必要がなくなります。開発環境ではプログラマにとって読みやすいように整理しておき、本番環境ではAsset Pipelineを使ってファイルを最小化すればよいのです。具体的には、Asset Pipelineがすべてのスタイルシートを1つのCSSファイル (<code>application.css</code>) にまとめ、すべてのJavaScriptファイルを1つのJSファイル (<code>javascripts.js</code>) にまとめてくれます。さらに、それらのファイルすべてに対して  不要な空白やインデントを取り除く処理を行い、ファイルサイズを<em>最小化</em>してくれます。結果として、開発環境と本番環境という、2つの異なった状況に対してそれぞれ最高の環境を提供してくれます。</p>
</div>
</div>
<div id="sec-sass" class="subsection" data-tralics-id="uid451" data-number="5.2.2">
<h3><a href="#sec-sass" class="heading hyperref"><span class="number">5.2.2</span> 素晴らしい構文を備えたスタイルシート</a></h3>
<p><em>Sass</em> は、スタイルシートを記述するための言語であり、CSSに比べて多くの点が強化されています。この節では、Sassが提供する2つの重要な機能、<em>ネスト</em>と<em>変数</em>について説明します。(3つ目の重要な機能である<em>ミックスイン</em>については、<a class="hyperref" href="sign_up?version=4.2#sec-rails_environments"><span class="ref">7.1.1</span></a>で紹介します)。</p>
<p><a class="hyperref" href="#sec-custom_css"><span class="ref">5.1.2</span></a>でも簡単に説明しましたが、SassはSCSSというフォーマットに対応しています (<code>.scss</code>という拡張子はSCSSであることを表します)。SCSSは、厳密な意味で、CSS本体を抽象化したフォーマットです。具体的には、SCSS は CSS に新しい機能を<em>追加</em>しただけで、全く新しい構文を定義したようなものではありません<sup class="footnote intersentence" id="cha-5_footnote-ref-13"><a href="#cha-5_footnote-13">13</a></sup>。本書の例では、Bootstrapの恩恵を得るために、私達は最初からSCSSを使用しています。RailsのAsset Pipelineは、<code>.scss</code>という拡張子を持つファイルをSassを使って自動的に処理してくれます。このため、<code>custom.css.scss</code>ファイルはSassプリプロセッサによって前処理され、その後ブラウザへの配信に備えてパッケージ化されます。</p>
<div id="uid453" class="subsubsection" data-tralics-id="uid453" data-number="5.2.2.1">
<h4><a href="#uid453" class="heading">ネスト</a></h4>
<p>スタイルシート内に共通のパターンがある場合は、要素をネストさせることができます。たとえば、<a class="hyperref" href="#code-universal_css">リスト<span class="ref">5.5</span></a>では、以下のように<code>.center</code>と<code>.center h1</code>の両方に対してルールがあります。</p>
<div class="code"><div class="highlight"><pre><span class="hll"><span class="nc">.center</span> <span class="p">{</span>
</span>  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="hll"><span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
</span>  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent">上のルールは、Sassを使用して以下のように書き換えることができます。</p>
<div class="code"><div class="highlight"><pre><span class="hll"><span class="nc">.center</span> <span class="p">{</span>
</span>  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="hll">  <span class="nt">h1</span> <span class="p">{</span>
</span>    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent">上の例では、ネストの内側にある<code>h1</code>というルールは、<code>.center</code>のルールを継承しています。</p>
<p>今度は、もう少し異なるルールに対してネスト機能を使う例を見てみましょう。<a class="hyperref" href="#code-logo_css">リスト<span class="ref">5.7</span></a>には以下のコードがあります。</p>
<div class="code"><div class="highlight"><pre><span class="hll"><span class="nn">#logo</span> <span class="p">{</span>
</span>  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="hll"><span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
</span>  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent">上のコードには<code>#logo</code>というidが2回使用されています。1回目はロゴ自身を定義するために、2回目は<code>hover</code>属性を定義するために使用されています (なおhover属性は、該当する要素の上にマウスポインタをかざしたときの表示を定義します)。2つ目のルールをネストするためには、親属性である<code>#logo</code>を参照する必要があります。このような場合、SCSSでは以下のようにアンパーサンド<code>&amp;</code>を使って実現できます。</p>
<div class="code"><div class="highlight"><pre><span class="hll"><span class="nn">#logo</span> <span class="p">{</span>
</span>  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
<span class="hll">  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
</span>    <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent">Sassは、SCSSをCSSに変換する際に、<code>&amp;:hover</code>を <code>#logo:hover</code>に置換します。</p>
<p>これらのネスト機能は、フッターのCSSでも使用できます。<a class="hyperref" href="#code-footer_css">リスト<span class="ref">5.13</span></a>のコードは、SCSSを使用して以下のように書き換えることができます。</p>
<div class="code"><div class="highlight"><pre><span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
<p class="noindent"><a class="hyperref" href="#code-footer_css">リスト<span class="ref">5.13</span></a>を手作業で変換してみることは、良い演習になります。変換後にもCSSが適切に動作していることを確認してみましょう。</p>
</div>
<div id="uid454" class="subsubsection" data-tralics-id="uid454" data-number="5.2.2.2">
<h4><a href="#uid454" class="heading">変数</a></h4>
<p>Sassでは、冗長なコードを削除し、より自由な表現を可能にするために、<em>変数</em>が定義できるようになっています。たとえば、<a class="hyperref" href="#code-typography_css">リスト<span class="ref">5.6</span></a>や<a class="hyperref" href="#code-footer_css">リスト<span class="ref">5.13</span></a>を見てみると、同じ色を繰り返し参照している箇所があります。</p>
<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
<span class="hll">  <span class="na">color</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
</span><span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
<span class="hll">  <span class="na">color</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
</span><span class="p">}</span>
</pre></div></div>
<p class="noindent">上のコードの<code>#777</code>は薄い灰色を指しています。Sassでは、このような値を変数として定義し、以下のように変数名を与えることができます。</p>
<div class="code"><div class="highlight"><pre><span class="nv">$light-gray</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
</pre></div></div>
<p class="noindent">この機能を使用して、SCSSを以下のように書き直すことができます。</p>
<div class="code"><div class="highlight"><pre><span class="nv">$light-gray</span><span class="o">:</span> <span class="mh">#777</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$light-gray</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$light-gray</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p><code>$light-gray</code>のような変数名は、<code>#777</code> のような値よりもわかりやすいので、たとえその変数が繰り返し使われないとしても、変数名を与えることは多くの場合有用です。実際、Bootstrapフレームワークでは、多くの色に対して変数名を定義しています。定義されている変数はBootstrapページの「<a href="http://getbootstrap.com/customize/#less-variables" target="_blank">LESS変数一覧</a>」で参照することができます。このWebサイトでは、SassではなくLESSを使って変数が定義されていますが、<span class="tt">bootstrap-sass</span>というgemを使用すれば、Sassでも同様の変数が使えるようになります。LESSとSassの違いを想像するのはそれほど難しくありません。たとえば、LESSではアットマーク<code>@</code>を使用しているのに対して、Sassはドルマーク<code>$</code>を使っていることはすぐにわかります。話を戻して、Bootstrapの変数の一覧表を見ると、薄い灰色に対して以下の変数名が与えられることに気が付きます。</p>
<div class="code"><div class="highlight"><pre> <span class="k">@gray-light</span><span class="nd">:</span> <span class="nn">#777</span><span class="o">;</span>
</pre></div></div>
<p class="noindent">これは、<span class="tt">bootstrap-sass</span>というgemを使えば、SCSSでも同様に<code>$gray-light</code>という変数が使えることを意味しています。先ほど定義した<code>$light-gray</code>というカスタム変数に代わりに、用意された変数を使ってみましょう。</p>
<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-light</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-light</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
<p>今回取り上げたSassのネスト機能や変数機能を使ってSCSSファイルを全面的に書き直すと、<a class="hyperref" href="#code-refactored_scss">リスト<span class="ref">5.15</span></a>のようになります。このリストでは、Sassの変数 (詳しくはBootstrap LESSの変数一覧を参考にしてください) や、組み込みの色変数 (たとえば<code>#fff</code>には<code>white</code> という変数) を使っています。<code>footer</code>タグのルールが、劇的に向上していることを確認してみてください。</p>
<div class="codelisting" id="code-refactored_scss" data-tralics-id="uid455" data-number="5.15">
<div class="heading">
<span class="number">リスト5.15:</span> 

<span class="description">ネストや変数を使って初期のSCSSファイルを書き直した結果<span class="break"></span> <span class="filepath">app/assets/stylesheets/custom.css.scss</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">"bootstrap-sprockets"</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">"bootstrap"</span><span class="p">;</span>

<span class="cm">/* mixins, variables, etc. */</span>

<span class="nv">$gray-medium-light</span><span class="o">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* typography */</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.2</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-light</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* header */</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* footer */</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="nv">$gray-medium-light</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-light</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nv">$gray</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
      <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-darker</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nt">small</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
</div>
<p>Sassを使ってスタイルシートをより簡単にする方法は他にもありますが、今回はその中でも最も重要な機能を使って<a class="hyperref" href="#code-refactored_scss">リスト<span class="ref">5.16</span></a>を書き直しました。Sassを使うことによって、素晴らしいスタートを切ることができました。Sassの詳細については、<a href="http://www.google.com/url?q=http%3A%2F%2Fsass-lang.com%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEc4Dgk0kfBWDNSeg4ljN59euobvw">Sass の公式サイト</a> (英語) を参照してください。</p>
</div>
</div>
</div><div id="sec-layout_links" class="section" data-tralics-id="cid33" data-number="5.3">
<h2><a href="#sec-layout_links" class="heading hyperref"><span class="number">5.3</span> レイアウトのリンク</a></h2>
<p>サイトのレイアウトが美しく仕上がりましたので、今度は<code>’#’</code>で代用していたリンクを書き換えてみましょう。もちろん、以下のようにリンクを直接記述することもできます。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/static_pages/about"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
</pre></div></div>
<p class="noindent">しかし、上の記法はRails流ではありません。まず、aboutページへのURLは/static_pages/aboutよりも/aboutの方がよいでしょう。さらに、Railsでは以下のようなコードでは<em>名前付きルート</em>を使用するのが慣例となっています。</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"About"</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p class="noindent">上のようにすることでコードの意味がわかりやすくなり、<code>about_path</code>の定義を変えれば<code>about_path</code>が使用されているすべてのURLを変更できるため、柔軟性が高まります。</p>
<p>今後使用する計画のあるすべてのリンクのリストを、URLとルート (route) のマッピングと共に<a class="hyperref" href="#table-url_mapping">表<span class="ref">5.1</span></a>に示します。<a class="hyperref" href="static_pages?version=4.2#sec-setting_the_root_route"><span class="ref">3.4.4</span></a>で最初のルートは設定済みですが、それ以外のルートについても同様に実装していきます。なお、loginについては本章の最後で少しだけ実装します (<a class="hyperref" href="log_in_log_out?version=4.2#cha-log_in_log_out"><span class="ref">第8章</span></a>で本格的に実装します)。</p>
<div class="table" id="table-url_mapping" data-tralics-id="uid456" data-number="5.1">
<table class="tabular">
<tbody><tr class="bottom_border">
<td class="align_left"><strong>ページ</strong></td>
<td class="align_left"><strong>URL</strong></td>
<td class="align_right"><strong>名前付きルート</strong></td>
</tr>
<tr>
<td class="align_left">Home</td>
<td class="align_left">/</td>
<td class="align_right"><code>root_path</code></td>
</tr>
<tr>
<td class="align_left">About</td>
<td class="align_left">/about</td>
<td class="align_right"><code>about_path</code></td>
</tr>
<tr>
<td class="align_left">Help</td>
<td class="align_left">/help</td>
<td class="align_right"><code>help_path</code></td>
</tr>
<tr>
<td class="align_left">Contact</td>
<td class="align_left">/contact</td>
<td class="align_right"><code>contact_path</code></td>
</tr>
<tr>
<td class="align_left">Sign up</td>
<td class="align_left">/signup</td>
<td class="align_right"><code>signup_path</code></td>
</tr>
<tr>
<td class="align_left">Log in</td>
<td class="align_left">/login</td>
<td class="align_right"><code>login_path</code></td>
</tr>
</tbody></table>
<div class="caption">
<span class="header">表 5.1</span> <span class="description">サイトリンクのルート (routing) とURLのマッピング
</span>
</div>
</div>
<div id="sec-contact_page" class="subsection" data-tralics-id="uid457" data-number="5.3.1">
<h3><a href="#sec-contact_page" class="heading hyperref"><span class="number">5.3.1 </span>Contactページ</a></h3>
<p>まずは、<a class="hyperref" href="static_pages?version=4.2#cha-static_pages"><span class="ref">第3章</span></a>の演習で取り上げたContactページについて追加しましょう。Contactページのテストを<a class="hyperref" href="#code-contact_page_test">リスト<span class="ref">5.16</span></a>に示します。これは単に<a class="hyperref" href="static_pages?version=4.2#code-title_tests">リスト<span class="ref">3.22</span></a>で使用されているテストのパターンに従ったものです。</p>
<div class="codelisting" id="code-contact_page_test" data-tralics-id="uid458" data-number="5.16">
<div class="heading">
<span class="number">リスト5.16:</span> 

<span class="description">Contactページのテスト (<span style="color:red"><span class="sc"></span><span class="sc"><strong>RED</strong></span><span class="sc"></span></span><span class="break"></span>) <span class="filepath">test/controllers/static_pages_controller_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">StaticPagesControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="nb">test</span> <span class="s2">"should get home"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:home</span>
    <span class="n">assert_response</span> <span class="ss">:success</span>
    <span class="n">assert_select</span> <span class="s2">"title"</span><span class="p">,</span> <span class="s2">"Ruby on Rails Tutorial Sample App"</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should get help"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:help</span>
    <span class="n">assert_response</span> <span class="ss">:success</span>
    <span class="n">assert_select</span> <span class="s2">"title"</span><span class="p">,</span> <span class="s2">"Help | Ruby on Rails Tutorial Sample App"</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should get about"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:about</span>
    <span class="n">assert_response</span> <span class="ss">:success</span>
    <span class="n">assert_select</span> <span class="s2">"title"</span><span class="p">,</span> <span class="s2">"About | Ruby on Rails Tutorial Sample App"</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"should get contact"</span> <span class="k">do</span>
</span><span class="hll">    <span class="n">get</span> <span class="ss">:contact</span>
</span><span class="hll">    <span class="n">assert_response</span> <span class="ss">:success</span>
</span><span class="hll">    <span class="n">assert_select</span> <span class="s2">"title"</span><span class="p">,</span> <span class="s2">"Contact | Ruby on Rails Tutorial Sample App"</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p class="noindent">この時点では、<a class="hyperref" href="#code-contact_page_test">リスト<span class="ref">5.16</span></a>のテストは<span style="color:red"><span class="sc"></span><span class="sc"><strong>RED</strong></span><span class="sc"></span></span>になっているはずです。</p>
<div class="codelisting" id="uid459" data-tralics-id="uid459" data-number="5.17">
<div class="heading">
<span class="number">リスト5.17:</span> <span class="description"><span style="color:red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div>
</div>
<p>アプリケーションコードは、<a class="hyperref" href="static_pages?version=4.2#sec-getting_started_with_testing"><span class="ref">3.3</span></a>のAboutページへの追加と良く似ています。最初にルート (<a class="hyperref" href="#code-contact_route">リスト<span class="ref">5.18</span></a>) を更新します。次に<code>contact</code>アクションをStaticPagesコントローラ (<a class="hyperref" href="#code-contact_action">リスト<span class="ref">5.19</span></a>) に追加します。最後にContactビュー (<a class="hyperref" href="#code-contact_view">リスト<span class="ref">5.20</span></a>) を作成します。</p>
<div class="codelisting" id="code-contact_route" data-tralics-id="uid460" data-number="5.18">
<div class="heading">
<span class="number">リスト5.18:</span> 

<span class="description">Contactページのルートを追加する (<span style="color:red"><span class="sc"></span><span class="sc"><strong>RED</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">config/routes.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s1">'static_pages#home'</span>
  <span class="n">get</span>  <span class="s1">'static_pages/help'</span>
  <span class="n">get</span>  <span class="s1">'static_pages/about'</span>
<span class="hll">  <span class="n">get</span>  <span class="s1">'static_pages/contact'</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-contact_action" data-tralics-id="uid461" data-number="5.19">
<div class="heading">
<span class="number">リスト5.19:</span> 

<span class="description">Contactページ用のアクションを追加する (<span style="color:red"><span class="sc"></span><span class="sc"><strong>RED</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">app/controllers/static_pages_controller.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-contact_view" data-tralics-id="uid462" data-number="5.20">
<div class="heading">
<span class="number">リスト5.20:</span> 

<span class="description">Contactページのビューを追加する (<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>GREEN</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">app/views/static_pages/contact.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Contact'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact the Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.railstutorial.org/#contact"</span><span class="nt">&gt;</span>contact page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div></div>
</div>
<p>ここで、すべてのテストが<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>GREEN</strong></span><span class="sc"></span></span>であることを確認しておいてください。</p>
<div class="codelisting" id="uid463" data-tralics-id="uid463" data-number="5.21">
<div class="heading">
<span class="number">リスト5.21:</span> <span class="description"><span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div>
</div>
</div>
<div id="sec-rails_routes" class="subsection" data-tralics-id="uid464" data-number="5.3.2">
<h3><a href="#sec-rails_routes" class="heading hyperref"><span class="number">5.3.2</span> Railsのルート</a></h3>
<p>本項では、名前付きルートをサンプルアプリケーションの静的ページで使うために、ルーティング用のファイル (<code>config/routes.rb</code>) を編集していきます。Railsはこのファイルの内容を見て、URLのマッピングをしています。 まずは、<a class="hyperref" href="static_pages?version=4.2#sec-setting_the_root_route"><span class="ref">3.4.4</span></a>で定義したHomeページのルーティングについて見直していきましょう。あのときは特別にHomeページのみ設定をしましたが、残りの静的ページについても同様にルーティングを設定していきます。</p>
<p>私たちはこれまでに、ルートURLを定義するコードを3回見てきました。1つ目は</p>
<div class="code"><div class="highlight"><pre><span class="n">root</span> <span class="s1">'application#hello'</span>
</pre></div></div>
<p class="noindent">というHelloアプリケーションのコード (<a class="hyperref" href="beginning?version=4.2#code-hello_root_route">リスト<span class="ref">1.10</span></a>)です。2つ目は</p>
<div class="code"><div class="highlight"><pre><span class="n">root</span> <span class="s1">'users#index'</span>
</pre></div></div>
<p class="noindent">というToyアプリケーションのコード (<a class="hyperref" href="toy_app?version=4.2#code-rails_routes_root_route">リスト<span class="ref">2.3</span></a>)。そして最後は</p>
<div class="code"><div class="highlight"><pre><span class="n">root</span> <span class="s1">'static_pages#home'</span>
</pre></div></div>
<p class="noindent">というSampleアプリケーションのコードです (<a class="hyperref" href="static_pages?version=4.2#code-home_root_route">リスト<span class="ref">3.37</span></a>)。いずれの場合においても、<code>root</code>メソッドを使ってルートURL "/" をコントローラーのアクションに紐付けていました。ルートURLのようなルーティングを定義することの効果は、ブラウザからアクセスしやすくすることだけではありません。それ以外にも、生のURLではなく、名前付きルートを使ってURLを参照することができるようになります。たとえばルートURLを定義すると、<code>root_path</code>や<code>root_url</code>といったメソッドを通してURLを参照することができます。ちなみに前者はルートURL以下の文字列を、後者は完全なURLの文字列を返します。</p>
<div class="code"><div class="highlight"><pre><span class="n">root_path</span> <span class="o">-&gt;</span> <span class="s1">'/'</span>
<span class="n">root_url</span>  <span class="o">-&gt;</span> <span class="s1">'http://www.example.com/'</span>
</pre></div></div>
<p class="noindent">なお、<em>Railsチュートリアル</em>では、<code>_path</code>書式を使用する一般的な規約に従い、リダイレクトの場合のみ<code>_url</code>書式を使用します。これは、HTTP標準では技術的にリダイレクト後に完全なURLが要求されるためです。ただし、ほとんどのブラウザではどちらの方法でも動作します。</p>
<p>HelpページやAboutページ、Contactページなどの名前付きルートを定義したい場合は、<code>get</code>ルールを使って定義することができます (<a class="hyperref" href="#code-contact_route">リスト<span class="ref">5.18</span></a>)。たとえば次のようなルールは、</p>
<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">'static_pages/help'</span>
</pre></div></div>
<p class="noindent">以下のように書き換えます。</p>
<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">'help'</span> <span class="o">=&gt;</span> <span class="s1">'static_pages#help'</span>
</pre></div></div>
<p class="noindent">このようにgetルールを使って変更すると、<span class="tt">GET</span>リクエストが /help に送信されたときにStaticPagesコントローラーの<code>help</code>アクションを呼び出してくれるようになります。これにより、/static_pages/help のような冗長なURLが /help のような分かりやすいURLにすることができます。また、ルートURLのときと同様に、<code>help_path</code>や<code>help_url</code>といった名前付きルートも使えるようになります。</p>
<div class="code"><div class="highlight"><pre><span class="n">help_path</span> <span class="o">-&gt;</span> <span class="s1">'/help'</span>
<span class="n">help_url</span>  <span class="o">-&gt;</span> <span class="s1">'http://www.example.com/help'</span>
</pre></div></div>
<p class="noindent">他の静的ページについても同様にルーティングを変更していくと、<a class="hyperref" href="#code-contact_route">リスト<span class="ref">5.18</span></a>は<a class="hyperref" href="#code-static_page_routes">リスト<span class="ref">5.22</span></a>のようなコードになります。</p>
<div class="codelisting" id="code-static_page_routes" data-tralics-id="uid465" data-number="5.22">
<div class="heading">
<span class="number">リスト5.22:</span> 

<span class="description">静的なページのルーティング一覧<span class="break"></span> <span class="filepath">config/routes.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span>             <span class="s1">'static_pages#home'</span>
  <span class="n">get</span> <span class="s1">'help'</span>    <span class="o">=&gt;</span> <span class="s1">'static_pages#help'</span>
  <span class="n">get</span> <span class="s1">'about'</span>   <span class="o">=&gt;</span> <span class="s1">'static_pages#about'</span>
  <span class="n">get</span> <span class="s1">'contact'</span> <span class="o">=&gt;</span> <span class="s1">'static_pages#contact'</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div>
<div id="sec-named_routes" class="subsection" data-tralics-id="uid466" data-number="5.3.3">
<h3><a href="#sec-named_routes" class="heading hyperref"><span class="number">5.3.3 </span>名前付きルート</a></h3>
<p><a class="hyperref" href="#code-static_page_routes">リスト<span class="ref">5.22</span></a>でルートを定義したことにより、レイアウトの中で名前付きルートが使えるようになりました。早速、<code>link_to</code>メソッドの2番目の引数で、適切な名前付きルートを使ってみましょう。たとえば以下のコードの場合、</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"About"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p class="noindent">上を以下のように置き換えます。</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"About"</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p class="noindent">他も同様です。</p>
<p>最初に、HomeページとHelpページへのリンクを持つヘッダーパーシャル<code>_header.html.erb</code> (<a class="hyperref" href="#code-header_partial_links">リスト<span class="ref">5.23</span></a>) から取りかかります。ヘッダーパーシャルでは、Web共通の慣習に従って、ロゴにもHomeページへのリンクを追加します。</p>
<div class="codelisting" id="code-header_partial_links" data-tralics-id="uid467" data-number="5.23">
<div class="heading">
<span class="number">リスト5.23:</span> 

<span class="description">headerパーシャルにリンクを追加する<span class="break"></span> <span class="filepath">app/views/layouts/_header.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"navbar navbar-fixed-top navbar-inverse"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"sample app"</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"logo"</span> <span class="cp">%&gt;</span>
</span>    <span class="nt">&lt;nav&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav navbar-nav navbar-right"</span><span class="nt">&gt;</span>
<span class="hll">        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span>    <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
</span><span class="hll">        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Help"</span><span class="p">,</span>    <span class="n">help_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
</span>        <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Log in"</span><span class="p">,</span> <span class="s1">'#'</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/nav&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div></div>
</div>
<p class="noindent">[Log in] リンクの名前付きルートは<a class="hyperref" href="log_in_log_out?version=4.2#cha-log_in_log_out"><span class="ref">第8章</span></a>で作成するため、今の段階では<code>’#’</code>のままにしておきます。</p>
<p>フッターパーシャル<code>_footer.html.erb</code>にもリンクがあります。これらはAboutページとContactページへのリンクです (<a class="hyperref" href="#code-footer_partial_links">リスト<span class="ref">5.24</span></a>)。</p>
<div class="codelisting" id="code-footer_partial_links" data-tralics-id="uid468" data-number="5.24">
<div class="heading">
<span class="number">リスト5.24:</span> 

<span class="description">footerパーシャルにリンクを追加する<span class="break"></span> <span class="filepath">app/views/layouts/_footer.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.railstutorial.org/"</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.michaelhartl.com/"</span><span class="nt">&gt;</span>Michael Hartl<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
<span class="hll">      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"About"</span><span class="p">,</span>   <span class="n">about_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
</span><span class="hll">      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Contact"</span><span class="p">,</span> <span class="n">contact_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
</span>      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"http://news.railstutorial.org/"</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div></div>
</div>
<p>これで、レイアウトに<a class="hyperref" href="static_pages?version=4.2#cha-static_pages"><span class="ref">第3章</span></a>で作成したすべての静的ページへのリンクができました。たとえば<a href="http://localhost:3000/about" target="_blank">/about</a>の場合はAboutページ (<a class="hyperref" href="#fig-about_page">図<span class="ref">5.8</span></a>) に移動します。</p>
<div class="center figure" id="fig-about_page" data-tralics-id="uid469" data-number="5.8">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/about_page_styled_3rd_edition.png" alt="images/figures/about_page_styled_3rd_edition"></div>
<div class="caption">
<span class="header">図5.8</span> <span class="description"><a href="http://localhost:3000/about" target="_blank">/about</a>で表示されるAboutページ
</span>
</div>
</div>
</div>
<div id="sec-layout_link_tests" class="subsection" data-tralics-id="uid470" data-number="5.3.4">
<h3><a href="#sec-layout_link_tests" class="heading hyperref"><span class="number">5.3.4 </span>リンクのテスト</a></h3>
<p>レイアウト内のいくつかのリンクを埋めることができたので、これらのリンクが正しく動いているかどうかチェックするテストを書いてみましょう。ブラウザを立ち上げてルートURLにアクセスし、それぞれのリンクをクリックして確かめることもできますが、変更する度にこの作業を毎回繰り返していくのは大きな負担です。そこで、「統合テスト (<em>(Integration Test)</em>)」を使って一連の作業を自動化してみましょう。統合テストを使うと、アプリケーションの動作を端から端まで (end-to-end) シミュレートしてテストすることができます。まずは、<code>site_layout</code>というテストのテンプレートを生成するところから始めてみます。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test site_layout
<span class="go">      invoke  test_unit</span>
<span class="go">      create    test/integration/site_layout_test.rb</span>
</pre></div></div>
<p class="noindent">このとき、Railsは与えられたファイル名の末尾に <code>_test</code> という文字列を追加することに注目してください。</p>
<p>今回の目的は、アプリケーションのHTML構造を調べて、レイアウトの各リンクが正しく動くかどうかチェックすることです。つまり、</p>
<ol>
<li>ルートURL (Homeページ) にGETリクエストを送る
</li>
<li>正しいページテンプレートが描画されているかどうか確かめる
</li>
<li>Home、Help、About、Contactの各ページへのリンクが正しく動くか確かめる
</li>
</ol>
<p>Railsの統合テストでは、上のステップをコードに落とし込んでいくことになります (<a class="hyperref" href="#code-layout_links_test">リスト<span class="ref">5.25</span></a>)。具体的には、まず<code>assert_template</code>メソッドを使って、Homeページが正しいビューを描画しているかどうか確かめます<sup class="footnote" id="cha-5_footnote-ref-14"><a href="#cha-5_footnote-14">14</a></sup>。</p>
<div class="codelisting" id="code-layout_links_test" data-tralics-id="uid475" data-number="5.25">
<div class="heading">
<span class="number">リスト5.25:</span> 

<span class="description">レイアウトのリンクに対するテスト (<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>GREEN</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">test/integration/site_layout_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">SiteLayoutTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="nb">test</span> <span class="s2">"layout links"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_template</span> <span class="s1">'static_pages/home'</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="mi">2</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">help_path</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">about_path</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">contact_path</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p class="noindent"><a class="hyperref" href="#code-layout_links_test">リスト<span class="ref">5.25</span></a>では、<code>assert_select</code>メソッドの高度なオプションを使っています (このメソッド自体は<a class="hyperref" href="static_pages?version=4.2#code-title_tests">リスト<span class="ref">3.22</span></a>や<a class="hyperref" href="#code-contact_page_test">リスト<span class="ref">5.16</span></a>でも登場しました)。 今回のケースでは、特定のリンクが存在するかどうかを、<code>a</code>タグと<code>href</code>属性をオプションで指定して調べています。たとえば</p>
<div class="code"><div class="highlight"><pre><span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">about_path</span>
</pre></div></div>
<p class="noindent">上のコードでは、Railsは自動的にはてなマーク "?" を<code>about_path</code>に置換しています (このとき "about_path" 内に特殊記号があればエスケープ処理されます)。これにより、次のようなHTMLがあるかどうかをチェックすることができます。</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/about"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/a&gt;</span>
</pre></div></div>
<p class="noindent">一方で、ルートURLへのリンクは<em>2つ</em>あることを思い出してください (1つはロゴに、もう1つはナビゲーションバーにあります)。このようなときは</p>
<div class="code"><div class="highlight"><pre><span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="mi">2</span>
</pre></div></div>
<p class="noindent">といった風に書くことで、<a class="hyperref" href="#code-header_partial_links">リスト<span class="ref">5.23</span></a>で定義したHomeページのリンクの個数も調べることもできます</p>
<p><code>assert_select</code>には色々な指定の仕方があります。その代表例をいくつか<a class="hyperref" href="#table-assert_select">表<span class="ref">5.2</span></a>で紹介します。<code>assert_select</code>は柔軟でパワフルな機能ですが (ここでは紹介し切れないほど他にも多くのオプションがあります)、しかし経験的には、このメソッドで複雑なテストはしない方が賢明です。今回のようなレイアウト内で頻繁に変更されるHTML要素 (リンクなど) をテストするぐらいに抑えておくとよいです。</p>
<div class="table" id="table-assert_select" data-tralics-id="uid476" data-number="5.2">
<table class="tabular">
<tbody><tr class="bottom_border">
<td class="align_left"><strong>コード</strong></td>
<td class="align_left"><strong>マッチするHTML</strong></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "div"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;div&gt;foobar&lt;/div&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "div", "foobar"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;div&gt;foobar&lt;/div&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "div.nav"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;div class="nav"&gt;foobar&lt;/div&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "div#profile"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;div id="profile"&gt;foobar&lt;/div&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "div[name=yo]"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;div name="yo"&gt;hey&lt;/div&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "a[href=?]", ’/’, count: 1</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;a href="/"&gt;foo&lt;/a&gt;</span></td>
</tr>
<tr>
<td class="align_left"><code>assert_select "a[href=?]", ’/’, text: "foo"</code></td>
<td class="align_left"><span class="inline_verbatim">&lt;a href="/"&gt;foo&lt;/a&gt;</span></td>
</tr>
</tbody></table>
<div class="caption">
<span class="header">表5.2: </span><span class="description"><code>assert_select</code>のいくつかの使用例
</span>
</div>
</div>
<p><a class="hyperref" href="#code-layout_links_test">リスト<span class="ref">5.25</span></a>で追加した統合テストが通るかどうかは、次のようにRakeタスクを実行することで試すことができます。</p>
<div class="codelisting" id="uid477" data-tralics-id="uid477" data-number="5.26">
<div class="heading">
<span class="number">リスト5.26:</span> <span class="description"><span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:integration
</pre></div></div>
</div>
<p class="noindent">統合テストが成功したら、今度はすべてのテストを流して<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>成功</strong></span><span class="sc"></span></span>するかどうか確かめてみてください。</p>
<div class="codelisting" id="uid478" data-tralics-id="uid478" data-number="5.27">
<div class="heading">
<span class="number">リスト5.27:</span> <span class="description"><span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div>
</div>
<p class="noindent">レイアウトのリンクをテストする統合テストが追加されたことで、リンクに間違った変更が加えられたらすぐに気付けるようになりました。</p>
</div>
</div><div id="sec-user_signup" class="section" data-tralics-id="cid34" data-number="5.4">
<h2><a href="#sec-user_signup" class="heading hyperref"><span class="number">5.4</span> ユーザー登録: 最初のステップ</a></h2>
<p>この節では、レイアウトとルーティングの取り組みにおける頂点として、ユーザー登録ページへのルーティングを作成します。そのために2番目のコントローラを作成することになります。これは、Webサイトでユーザー登録を行えるようにするための最初の重要な一歩となります。次の一歩であるユーザーのモデリングは<a class="hyperref" href="modeling_users?version=4.2#cha-modeling_users"><span class="ref">第6章</span></a>で行い、<a class="hyperref" href="sign_up?version=4.2#cha-sign_up"><span class="ref">第7章</span></a>でユーザー登録が完成します。</p>
<div id="sec-users_controller" class="subsection" data-tralics-id="uid479" data-number="5.4.1">
<h3><a href="#sec-users_controller" class="heading hyperref"><span class="number">5.4.1</span> Usersコントローラ</a></h3>
<p><a class="hyperref" href="static_pages?version=4.2#sec-static_pages"><span class="ref">3.2</span></a>で、最初のコントローラであるStaticPagesコントローラを作成しました。今度は2番目のコントローラであるUsersコントローラを作成しましょう。1番目のときと同様、<code>generate</code>を実行して、現時点での要求である新規ユーザー用のユーザー登録ページ (スタブ) を持つ、最も簡単なコントローラを作成します。Railsで好まれている<a href="http://ja.wikipedia.org/wiki/Representational_State_Transfer" target="_blank">RESTアーキテクチャ</a>の規約に従い、新規ユーザー用のアクションを<code>new</code>とします。したがって、<code>generate controller</code>の引数に<code>new</code>を渡して、自動的にアクションを作成してみましょう。変更の結果を<a class="hyperref" href="#code-generate_users_controller">リスト<span class="ref">5.28</span></a>に示します。</p>
<div class="codelisting" id="code-generate_users_controller" data-tralics-id="uid480" data-number="5.28">
<div class="heading">
<span class="number">リスト5.28:</span> 

<span class="description">Usersコントローラの生成 (<code>new</code>アクションを追加)</span>
</div>

<div class="code"><div class="highlight"><pre><span class="hll"><span class="gp">$</span> rails generate controller Users new
</span><span class="go">      create  app/controllers/users_controller.rb</span>
<span class="go">       route  get 'users/new'</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/users</span>
<span class="go">      create    app/views/users/new.html.erb</span>
<span class="go">      invoke  test_unit</span>
<span class="go">      create    test/controllers/users_controller_test.rb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/users_helper.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/helpers/users_helper_test.rb</span>
<span class="go">      invoke  assets</span>
<span class="go">      invoke    coffee</span>
<span class="go">      create      app/assets/javascripts/users.js.coffee</span>
<span class="go">      invoke    scss</span>
<span class="go">      create      app/assets/stylesheets/users.css.scss</span>
</pre></div></div>
</div>
<p class="noindent"><a class="hyperref" href="#code-generate_users_controller">リスト<span class="ref">5.28</span></a>により、<code>new</code>アクションを持つUsersコントローラ(<a class="hyperref" href="#code-initial_users_controller">リスト<span class="ref">5.30</span></a>)と、スタブのユーザービューを作成します(<a class="hyperref" href="#code-initial_new_action">リスト<span class="ref">5.31</span></a>)。このとき、新しいUserページ用の小さなテスト (<a class="hyperref" href="#code-user_new_test">リスト<span class="ref">5.32</span></a>) も生成されていて、この時点ではパスするはずです。</p>
<div class="codelisting" id="uid481" data-tralics-id="uid481" data-number="5.29">
<div class="heading">
<span class="number">リスト5.29:</span> <span class="description"><span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div>
</div>
<div class="codelisting" id="code-initial_users_controller" data-tralics-id="uid482" data-number="5.30">
<div class="heading">
<span class="number">リスト5.30:</span> 

<span class="description"><code>new</code>アクションを持つ最初のUsersコントローラ<span class="break"></span> <span class="filepath">app/controllers/users_controller.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-initial_new_action" data-tralics-id="uid483" data-number="5.31">
<div class="heading">
<span class="number">リスト5.31:</span> 

<span class="description">Users用の最初の<code>new</code>アクション<span class="break"></span> <span class="filepath">app/views/users/new.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Users#new<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-user_new_test" data-tralics-id="uid484" data-number="5.32">
<div class="heading">
<span class="number">リスト5.32:</span> 

<span class="description">Userページ用の最初のテスト (<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">test/controllers/users_controller_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UsersControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="nb">test</span> <span class="s2">"should get new"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:new</span>
    <span class="n">assert_response</span> <span class="ss">:success</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div>
<div id="sec-signup_url" class="subsection" data-tralics-id="uid485" data-number="5.4.2">
<h3><a href="#sec-signup_url" class="heading hyperref"><span class="number">5.4.2</span> ユーザー登録用URL</a></h3>
<p><a class="hyperref" href="#sec-users_controller"><span class="ref">5.4.1</span></a>のコードにより、新規ユーザー用の動作するページが/users/new にできました。ここで<a class="hyperref" href="#table-url_mapping">表<span class="ref">5.1</span></a>を思い出していただきたいのですが、URLは/users/newではなく表のとおりに/signupにしたいと思います。<a class="hyperref" href="#code-static_page_routes">リスト<span class="ref">5.22</span></a>の例に従い、ユーザー登録URL用に<code>get ’/signup’</code>のルールを追加します (<a class="hyperref" href="#code-signup_route">リスト<span class="ref">5.33</span></a>)。</p>
<div class="codelisting" id="code-signup_route" data-tralics-id="uid486" data-number="5.33">
<div class="heading">
<span class="number">リスト5.33:</span> 

<span class="description">ユーザー登録ページのルート<span class="break"></span> <span class="filepath">config/routes.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span>             <span class="s1">'static_pages#home'</span>
  <span class="n">get</span> <span class="s1">'help'</span>    <span class="o">=&gt;</span> <span class="s1">'static_pages#help'</span>
  <span class="n">get</span> <span class="s1">'about'</span>   <span class="o">=&gt;</span> <span class="s1">'static_pages#about'</span>
  <span class="n">get</span> <span class="s1">'contact'</span> <span class="o">=&gt;</span> <span class="s1">'static_pages#contact'</span>
<span class="hll">  <span class="n">get</span> <span class="s1">'signup'</span>  <span class="o">=&gt;</span> <span class="s1">'users#new'</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>次に、新しく定義された名前付きルートを使って、Homeページのボタンに適切なリンクを追加します。他のルートと同様、<code>get ’/signup’</code>と記述したことで<code>signup_path</code>という名前付きルートができ、それを<a class="hyperref" href="#code-home_page_signup_link">リスト<span class="ref">5.34</span></a>で使用します。signupページへのテストは演習に回すことにします (<a class="hyperref" href="#sec-layout_exercises"><span class="ref">5.6</span></a>)。</p>
<div class="codelisting" id="code-home_page_signup_link" data-tralics-id="uid487" data-number="5.34">
<div class="heading">
<span class="number">リスト5.34:</span> 

<span class="description">ボタンにユーザー登録ページへのリンクを追加する<span class="break"></span> <span class="filepath">app/views/static_pages/home.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"center jumbotron"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://www.railstutorial.org/"</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

<span class="hll">  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign up now!"</span><span class="p">,</span> <span class="n">signup_path</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-lg btn-primary"</span> <span class="cp">%&gt;</span>
</span><span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">"rails.png"</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="s2">"Rails logo"</span><span class="p">),</span>
            <span class="s1">'http://rubyonrails.org/'</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p>最後に、signupページ用のカスタムスタブ (stub) のビューを追加します (<a class="hyperref" href="#code-initial_signup_page"><span class="ref">5.35</span></a>)。</p>
<div class="codelisting" id="code-initial_signup_page" data-tralics-id="uid488" data-number="5.35">
<div class="heading">
<span class="number">リスト5.35:</span> 

<span class="description">最初のユーザー登録ページ (スタブ)<span class="break"></span> <span class="filepath">app/views/users/new.html.erb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Sign up'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>This will be a signup page for new users.<span class="nt">&lt;/p&gt;</span>
</pre></div></div>
</div>
<p class="noindent">これで、少なくともサインインのルートを追加するまでの間、リンクと名前付きルートが完成しました(<a class="hyperref" href="log_in_log_out?version=4.2#cha-log_in_log_out"><span class="ref">第8章</span></a>)。結果を<a class="hyperref" href="#fig-new_signup_page">図<span class="ref">5.9</span></a>の新規ユーザーのページ (URI /signup) に示します。</p>
<div class="center figure" id="fig-new_signup_page" data-tralics-id="uid489" data-number="5.9">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/new_signup_page_3rd_edition.png" alt="images/figures/new_signup_page_3rd_edition"></div>
<div class="caption">
<span class="header">図5.9</span> <span class="description"><a href="http://localhost:3000/signup" target="_blank">/signup</a>で表示される新しいユーザー登録ページ
</span>
</div>
</div>
</div>
</div><div id="sec-layout_conclusion" class="section" data-tralics-id="cid35" data-number="5.5">
<h2><a href="#sec-layout_conclusion" class="heading hyperref"><span class="number">5.5</span> 最後に</a></h2>
<p>この章では、アプリケーションのレイアウトを形にし、ルーティングを洗練させました。本書では、以後サンプルアプリケーションを肉付けすることに専念します。最初に、ユーザー登録、サインイン、サインアウトできるユーザーを追加します。次に、マイクロポストを追加します。最後に、他のユーザーをフォローできるようにします。</p>
<p>Gitを使っている方は、この時点でmasterブランチに変更をマージしてください。</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake test
$ git add -A
$ git commit -m "Finish layout and routes"
$ git checkout master
$ git merge filling-in-layout
</pre></div></div>
<p class="noindent">続いて、Bitbucketにプッシュします。</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push</pre></div></div>
<p class="noindent">最後に、Herokuへデプロイします。</p>
<div class="code"><div class="highlight"><pre>$ git push heroku</pre></div></div>
<p class="noindent">デプロイが無事に終わると、本番環境でサンプルアプリケーションが動いているはずです (<a class="hyperref" href="#fig-layout_production">図<span class="ref">5.10</span></a>)。</p>
<div class="center figure" id="fig-layout_production" data-tralics-id="uid490" data-number="5.10">
<div class="graphics image"><img src="http://railstutorial.jp/books/4.2/images/figures/layout_production.png" alt="images/figures/layout_production"></div>
<div class="caption">
<span class="header">図5.10: </span><span class="description">本番環境で動くサンプルアプリケーション
</span>
</div>
</div>
<div id="sec-filling_in_the_layout_what_we_learned_in_this_chapter" class="subsection" data-tralics-id="uid491" data-number="5.5.1">
<h3><a href="#sec-filling_in_the_layout_what_we_learned_in_this_chapter" class="heading hyperref"><span class="number">5.5.1 </span>本章のまとめ</a></h3>
<ul>
<li>HTML5を使ってheaderやfooter、logoやbodyといったコンテンツのレイアウトを定義しました
</li>
<li>Railsのパーシャルは効率化のために使われ、別ファイルにマークアップを切り出すことができます
</li>
<li>CSSは、CSSクラスとidを使ってレイアウトやデザインを調整します
</li>
<li>Bootstrapフレームワークを使うと、いい感じのデザインを素早く実装できる
</li>
<li>SassとAsset Pipelineは、(開発効率のために切り分けられた) CSSの冗長な部分を圧縮し、本番環境に最適化した結果を出力する
</li>
<li>Railsのルーティングでは自由にルールを定義することができ、また、その際に名前付きルートも使えるようになる
</li>
<li>統合テストは、ブラウザによるページ間の遷移を効率的にシミュレートする
</li>
</ul>
</div>
</div><div id="sec-layout_exercises" class="section" data-tralics-id="cid36" data-number="5.6">
<h2><a href="#sec-layout_exercises" class="heading hyperref"><span class="number">5.6</span> 演習</a></h2>
<p><em>注</em>: 『<em>演習の解答マニュアル</em> (英語)』には<em>Ruby on Railsチュートリアル</em>のすべての演習の解答が掲載されており、<a href="http://www.railstutorial.org/" target="_blank">www.railstutorial.org</a>から購入して頂いた方は無料で手に入れることができます。</p>
<p>演習とチュートリアル本編の食い違いを避ける方法については、<a class="hyperref" href="static_pages?version=4.2#sec-static_pages_exercises"><span class="ref">3.6</span></a>のトピックブランチの演習に追加したメモをご覧ください。</p>
<ol>
<li>
<a class="hyperref" href="#sec-sass"><span class="ref">5.2.2</span></a>で触れたように、まずは<a class="hyperref" href="#code-footer_css">リスト<span class="ref">5.13</span></a>のフッター用CSSを<a class="hyperref" href="#code-refactored_scss">リスト<span class="ref">5.15</span></a>のSCSSに変更してみてください。
</li>
<li>
<a class="hyperref" href="#code-layout_links_test">リスト<span class="ref">5.25</span></a>の統合テストでは、 <code>get</code>メソッドを使ってユーザー登録ページにアクセスし、ページタイトルが正しいかどうかチェックするテストコードを加えてください。
</li>
<li>
<a class="hyperref" href="#code-test_helper_application_helper">リスト<span class="ref">5.36</span></a>でお見せしたように、Applicationヘルパーで使っている<code>full_title</code>ヘルパーを、test環境でも使えるようにすると便利です。こうしておくと、<a class="hyperref" href="#code-layout_links_test_signup_full_title_helper">リスト<span class="ref">5.37</span></a>のようなコードを使って正しいタイトルをテストすることができます (ちなみにこれは前回の演習の応用でもあります)。ただし、これは完璧なテストではありません。たとえばベースタイトルに“Ruby on Rails Tutoial”といった誤字があったとしても、このテストでは発見することができないでしょう。この問題を解決するためには、<code>full_title</code>ヘルパーに対するテストを書く必要があります。そのために、Applicationヘルパーをテストするファイルを作成し、<a class="hyperref" href="#code-full_title_helper_tests">リスト<span class="ref">5.38</span></a>の<code>FILL_IN</code>のようなコードを書いてみましょう。ヒント: <a class="hyperref" href="#code-full_title_helper_tests">リスト<span class="ref">5.38</span></a>では<code>assert_equal &lt;期待される値&gt;, &lt;実際の値&gt;</code>といった形で使っていましたが、内部では<code>==</code>演算子を使って、期待される値と実際の値を比較して正しいかどうかテストしています。
</li>
</ol>
<div class="codelisting" id="code-test_helper_application_helper" data-tralics-id="uid502" data-number="5.36">
<div class="heading">
<span class="number">リスト5.36:</span> 

<span class="description">テスト環境でもApplicationヘルパーを使えるようにする<span class="break"></span> <span class="filepath">test/test_helper.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="no">ENV</span><span class="o">[</span><span class="s1">'RAILS_ENV'</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">'test'</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="k">class</span> <span class="nc">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="n">fixtures</span> <span class="ss">:all</span>
<span class="hll">  <span class="kp">include</span> <span class="no">ApplicationHelper</span>
</span>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-layout_links_test_signup_full_title_helper" data-tralics-id="uid503" data-number="5.37">
<div class="heading">
<span class="number">リスト5.37:</span> 

<span class="description">テスト環境で<code>full_title</code>ヘルパーを使う (<span style="color:ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>)<span class="break"></span> <span class="filepath">test/integration/site_layout_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">SiteLayoutTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="nb">test</span> <span class="s2">"layout links"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_template</span> <span class="s1">'static_pages/home'</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="mi">2</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">help_path</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">about_path</span>
    <span class="n">assert_select</span> <span class="s2">"a[href=?]"</span><span class="p">,</span> <span class="n">contact_path</span>
<span class="hll">    <span class="n">get</span> <span class="n">signup_path</span>
</span><span class="hll">    <span class="n">assert_select</span> <span class="s2">"title"</span><span class="p">,</span> <span class="n">full_title</span><span class="p">(</span><span class="s2">"Sign up"</span><span class="p">)</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-full_title_helper_tests" data-tralics-id="uid504" data-number="5.38">
<div class="heading">
<span class="number">リスト5.38:</span> 

<span class="description"><code>full_title</code>ヘルパーの単体テスト<span class="break"></span> <span class="filepath">test/helpers/application_helper_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">ApplicationHelperTest</span> <span class="o">&lt;</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="nb">test</span> <span class="s2">"full title helper"</span> <span class="k">do</span>
    <span class="n">assert_equal</span> <span class="n">full_title</span><span class="p">,</span>         <span class="no">FILL_IN</span>
    <span class="n">assert_equal</span> <span class="n">full_title</span><span class="p">(</span><span class="s2">"Help"</span><span class="p">),</span> <span class="no">FILL_IN</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div><div id="cha-5_footnotes">
  <div class="navigation">
<a class="next_page" href="modeling_users?version=4.2#cha-modeling_users"><span class="number">第6章</span>ユーザーのモデルを作成する</a><a class="prev_page" href="rails_flavored_ruby?version=4.2#cha-rails_flavored_ruby">«&nbsp;<span class="number">第4章</span>Rails風味のRuby</a>
</div>
<ol class="footnotes">
    <li id="cha-5_footnote-1">
<a href="https://twitter.com/colmtuite" target="_blank">Colm Tuite</a>の多大な貢献により、サンプルアプリケーションをBootstrap CSSのフレームワークに変換することができました。感謝します。<a class="arrow" href="#cha-5_footnote-ref-1">↑</a>
</li>
    <li id="cha-5_footnote-2">
<em>Ruby on Railsチュートリアル</em> のモックアップは、「<a href="http://gomockingbird.com" target="_blank">Mockingbird</a>」という素晴らしいモックアップ作成サービスで作られています。<a class="arrow" href="#cha-5_footnote-ref-2">↑</a>
</li>
    <li id="cha-5_footnote-3">
<em>shim</em>と<em>shiv</em>という単語は、今回の用途ではどちらでも大丈夫です。shimを意味は「洗う機械、もしくは薄い物質を整理しフィットさせるためのモノ、あるいは服を削除すること」なので、意味合いとしては前者が正しいです。ちなみに後者は「ナイフ、もしくは武器として使う剃刀」という意味なので、おそらく原著者である Sjoerd Visscherのちょっとしたイタズラ心でしょう。<a class="arrow" href="#cha-5_footnote-ref-3">↑</a>
</li>
    <li id="cha-5_footnote-4">CSSクラスは、Rubyのクラスとはまったく関係がありません。<a class="arrow" href="#cha-5_footnote-ref-4">↑</a>
</li>
    <li id="cha-5_footnote-5">スペースを入れると見栄えが変わるかもしれませんが、<a class="hyperref" href="static_pages?version=4.2#sec-testing_titles"><span class="ref">3.4.1</span></a>で触れたようにHTMLは重複する空白を無視するのでどちらでも大丈夫です。<a class="arrow" href="#cha-5_footnote-ref-5">↑</a>
</li>
    <li id="cha-5_footnote-6">もしOS Xの<a href="http://brew.sh/" target="_blank">Homebrew</a>が使えるようになっていれば、<code>brew install curl</code>というコマンドを打って<code>curl</code>をインストールすることができます。&nbsp;<a class="arrow" href="#cha-5_footnote-ref-6">↑</a>
</li>
    <li id="cha-5_footnote-7">既にお気付きだと思いますが、<code>img</code>タグは<span class="inline_verbatim">&lt;img&gt;...&lt;/img&gt;</span>ではなく<span class="inline_verbatim">&lt;img ... /&gt;</span>と書きます。この書式に従うタグは<em>閉じタグ</em>として知られています。&nbsp;<a class="arrow" href="#cha-5_footnote-ref-7">↑</a>
</li>
    <li id="cha-5_footnote-8">Asset PipelineではLessを使うこともできます。詳しくは<a href="http://rubygems.org/gems/less-rails-bootstrap" target="_blank"><span class="tt">less-rails-bootstrap</span> gem</a>を参照してください。<a class="arrow" href="#cha-5_footnote-ref-8">↑</a>
</li>
    <li id="cha-5_footnote-9">もしこのステップが摩訶不思議に思えたら、次のように考えてみましょう。「私はただ<a href="https://github.com/twbs/bootstrap-sass#bootstrap-for-sass---" target="_blank">bootstrap-sassのREADMEファイル</a>に従っているのだ」と。<a class="arrow" href="#cha-5_footnote-ref-9">↑</a>
</li>
    <li id="cha-5_footnote-10">多くのRails開発者は、異なるビューの間で共通に使用するパーシャルを保存するディレクトリとして、<code>shared</code>ディレクトリを使用します。著者は、複数のビューで共有するユーティリティパーシャルについては<code>shared</code>フォルダに保存し、文字どおり全ページ (サイトレイアウトの一部として) 共通のパーシャルについては<code>layouts</code>ディレクトリへ保存することを好んでいます (<code>shared</code>ディレクトリは<a class="hyperref" href="sign_up?version=4.2#cha-sign_up"><span class="ref">第7章</span></a>で作成します)。著者はこのように分割保存するのが論理的であると考えますが、<code>shared</code>フォルダにすべて保存しても問題なく動作します。<a class="arrow" href="#cha-5_footnote-ref-10">↑</a>
</li>
    <li id="cha-5_footnote-11">
<code>footer</code>タグと<code>.footer</code>クラスを両方使用していることについて疑問に思う方がいるかもしれません。その理由は、footerタグとする方が読み手にとって意味が明確であるのと、.footerクラスはBootstrapで使用するためです。<code>footer</code>を<code>div</code>に置き換えても動作は変わりません。<a class="arrow" href="#cha-5_footnote-ref-11">↑</a>
</li>
    <li id="cha-5_footnote-12">このチュートリアル構成は、Michael Erasmusによる素晴らしいブログ記事「5分でわかるRails 3のAsset Pipeline (英語)」をもとにしています。詳細についてはRailsガイドの「<a href="http://railsguides.jp/asset_pipeline.html" target="_blank">アセットパイプライン</a>」の項を参照してください。<a class="arrow" href="#cha-5_footnote-ref-12">↑</a>
</li>
    <li id="cha-5_footnote-13">Sassでもサポートされている古い<code>.sass</code>というフォーマットでは、冗長性の少ない (括弧の少ない)  新しい言語を定義しますが、既存のプロジェクトには若干不便であり、既にCSSに慣れ親しんだ人にとっては学習が面倒でもあります。<a class="arrow" href="http://www.google.com/url?q=http%3A%2F%2Frailstutorial.jp%2Fbooks%2F4.2%2Ffilling_in_the_layout.html%23cha-5_footnote-ref-13&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEpqrWFTbSpNg0gW9VL4TRymfkSKA">↑</a>
</li>
    <li id="cha-5_footnote-14">何人かの開発者は「1つのテストに複数のアサーションを入れるべきではない」と強く主張するでしょう。 この演習は不必要に複雑で、もし各テストの直前に共通のセットアップ用タスクがあれば、たしかに不要な負荷がかかることでしょう。しかし、よく書かれたテストは一貫したストーリーのようになり、人間にとって理解しやすいです。ストーリーを独立した場面ごとに分割されてしまうと、物語調ではなくなってしまいます。このことから、複数のアサーションを1つのテストにまとめるようにして、(minitestを通して) Rubyにどのセリフで間違ったのかを話させるようにしています。<a class="arrow" href="#cha-5_footnote-ref-14">↑</a>
</li>
  </ol>
</div>
          </div>

  </body>
</html>
