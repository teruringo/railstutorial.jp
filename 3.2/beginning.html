<html dir="ltr">
  <head>
    <title>Ruby on Rails チュートリアル</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="../stylesheets/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../stylesheets/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr">
    <div id="book">

<div id="top"></div>


<h1 class="chapter"><a id="sec-1" href="./beginning.html#top" class="heading"><span class="number">第1章</span> ゼロからデプロイまで</a></h1>


<p><a href="#"><em>Ruby on Rails チュートリアル</em></a>へようこそ。本書は「<a href="http://rubyonrails.org/">Ruby on Rails</a> を使ったWeb開発を学びたいのだけど、何から始めれば良いでしょうか？」といった質問に答えるために作成されました。<em>本書</em>を読み終わったときには、あなたは自分の手で Web アプリケーションを開発することから、デプロイ (deploy: 本番環境でアプリを動かし、一般公開すること) までの全ての技術を習得できるはずです。また、Rails の教育エコシステムに存在する、さらに高度な内容の本やブログ、スクリーンキャストなどを読み解く力も身につけられるでしょう。加えて、<em>Ruby on Rails チュートリアル</em>はRails 3を使用しているため、これからあなたが本書で学ぶ内容は、Web 開発の主流の話だと言えます。(なお、この <em>Ruby on Rails チュートリアル</em>が最新版かどうかについては、本書の公式サイト (<a href="http://railstutorial.jp">http://railstutorial.jp/</a>) でチェックすることができます。特に、本書をオフラインで読んでいる方は、<a href="./book">オンライン版の Rails チュートリアル</a>で最新版かどうかを一度ご確認してください。)</p>

<p>本書の目的は、単に Rails を教えることでは<em>ではなく</em>、<em>Rails を使った Web アプリケーションの開発</em>を教えることです。具体的には、World Wide Web 上で動くソフトウェアを開発できるようにすること (あるいは洗練すること) が本書の目的になります。したがって、Ruby on Rails だけではなく、HTML や CSS、データベース、バージョン管理、テスト、デプロイといった技術も、本書で教える対象となります。この目的を達成するため、<em>Ruby on Rails チュートリアル</em>では、統合的なアプローチを採用しています。つまり、「実際に動くサンプルアプリケーションをゼロから開発する」という例題をこなしていきながら、Rails について総合的に学んでいきます。<a href="http://sivers.org">Derek Sivers</a> が前書きで述べたとおり、本書は一本道のストーリーで構成されていて、最初から最後まで飛ばさずに読まれることを前提としています。そのため、技術書を飛ばし読みするのが習慣になっている方にとっては、少し頭の切り替えが必要になるかもしれません。しかし、その価値は十分にあります。ぜひトライしてみてください。<em>Ruby on Rails チュートリアル</em>を TV ゲームに例えれば、あなたは主人公であり、各章をこなす度に Rails 開発者としてレベルアップしていくと考えてください (演習は<a href="http://ja.wikipedia.org/wiki/%E3%83%9C%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC#.E4.B8.AD.E3.83.9C.E3.82.B9">中ボス</a>です)。</p>

<p>第1章では、必要なソフトウェアをインストールし、開発環境 (<a class="ref" href="./beginning.html#sec-up_and_running">1.2</a>) を整えて Ruby on Rails を動かす準備をします。その後、<code>first_app</code> という最初の Rails アプリの作成に着手します。<em>Rails チュートリアル</em>では、ソフトウェア開発のベストプラクティスを重要視しているので、新しい Rails プロジェクトを作成した後に、すぐに Git (<a class="ref" href="./beginning.html#sec-version_control">1.3</a>) を使ったバージョン管理を実践してもらいます。そして最後に、本番 (production) 環境 (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) に<em>デプロイして、作成したアプリを一般公開する</em>ところまで一通り実践します。</p>

<p><a class="ref" href="./a-demo-app.html#top">第2章</a>では、Rails アプリケーションの基本的な仕組みを体験してもらうために、新たなプロジェクトを作成します。手っ取り早く動かしたいので、この<em>デモアプリ </em>(<code>demo_app</code>) では、scaffold (<a class="ref" href="./beginning.html#sidebar-scaffolding">コラム 1.2</a>) を使ってコードを自動生成します。ただし、scaffold で自動生成されたコードは、複雑であまり美しくありません。このため、<a class="ref" href="./a-demo-app.html#top">第2章</a>では、自動生成されたコードを解説するのではなく、生成された <em>URI</em> (Webブラウザで言う <em>URL</em><sup class="footnote" id="fnref-1_1"><a href="./beginning.html#fn-1_1">1</a></sup>) がどのように動くのか、Webブラウザを使って確かめることに焦点を当てます。</p>

<p>第3章以降では、１つの大きな<em>サンプルアプリケーション</em> (<code>sample_app</code>) を開発していきます。また、コードを自動生成するのではなく、ゼロからコードを書いていきます。加えて、サンプルアプリケーションからは、TDD (<em>テスト駆動開発</em>) という開発手法で開発を進めていきます。具体的には、<a class="ref" href="./static-pages.html#top">第3章</a>では、静的ページと若干の動的コンテンツを追加するところから始めます。その後、<a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>では、少し回り道をし、Rails を動かしている Ruby 言語について簡単に学びます。<a class="ref" href="./filling-in-the-layout.html#top">第5章</a>から<a class="ref" href="./updating-showing-and-deleting-users.html#top">第9章</a>では、レイアウトやユーザーのデータモデル、そして、ユーザー登録・認証システムを作っていき、サンプルアプリケーションの基本的な部分を実装します。最後に、<a class="ref" href="./user-microposts.html#top">第10章</a>と<a class="ref" href="./following-users.html#top">第11章</a>では、マイクロブログ機能とソーシャル機能を実装し、実際に動作するサイトに仕上げます。</p>

<p>最終的なサンプルアプリケーションは、(偶然にも、かつては Rails で実装されていた) <a href="http://twitter.com/">某ソーシャルマイクロブログサイト</a>にとてもよく似た仕上がりになります。なお、<em>Rails チュートリアル</em>では、サンプルアプリケーションの開発を中心にして話が進められていきますが、(サンプルアプリケーションに特化した技術ではなく) Web アプリケーションの開発で必要になる一般的な技術を重点的に解説していきます。このため、本書を読み終わる事には、あなたが今後どんな Web アプリケーションを開発したいのかに関わらず、どんな開発にも通用する基礎的な力を身につけることができます。</p>

<div class="label" id="sidebar-scaffolding"></div>


<div class="sidebar"><span class="title"><span class="header">コラム 1.1</span></span><span class="title"><span class="description">早くて簡単な Scaffold の甘い誘惑</span></span>
<p>Rails の作者 David Heinemer Hansson 氏による有名な動画「<a href="http://www.youtube.com/watch?v=Gzj723LkRJY">15分で作るブログ</a>」を見て頂ければわかるように、Rails は初期の頃から、明快で刺激的なフレームワークです。この動画や、これに続く関連動画を見ることは、Rails のパワーを知る最適な方法の１つなので、ぜひ一度視聴する事をお勧めします。ただし、気をつけなくてはならない点が１つあります。それは、これらの動画では「15分でブログを作る」といった離れ業を、<em>scaffold</em> という機能を利用して成し遂げている点です。このため、15分で作られた機能は、Railsの<code>generate</code>コマンドによって (まるで魔法のように) <em>自動生成されたコード</em>に強く依存しています。</p>

<p>実際、Ruby on Rails のチュートリアルを書いているとき、<a href="http://en.wikipedia.org/wiki/Dark_side_(Star_Wars)">あまりにも素早く簡単にコードが生成できる</a> (訳注: 原文の「quicker, easier, more seductive」は、スターウォーズ エピソードV のヨーダの台詞の引用) scaffold の機能を、つい使ってしまいたくなりました。しかし、自動生成されたコードは初心者にとってはあまりに量が多く、複雑です。さらに、自動生成されたコードが運よく動いたとしても、そのコードが正常に動いている理由を理解するのはかなり困難です。scaffold を使ってコードを自動生成することばかりに頼っていると、コードを自動生成する達人にはなれるかもしれませんが、Rails に関する実践的な知識はほとんど身に付きません。</p>

<p>このため、<em>Ruby on Rails チュートリアル</em>では、より実践的な知識を身につけるために、ほぼ逆のアプローチで開発を進めていきます。具体的には、<a class="ref" href="./a-demo-app.html#top">第2章</a>で作成する簡単なデモアプリではscaffoldを使いますが、<em>このチュートリアル</em>の中核である<a class="ref" href="./static-pages.html#top">第3章以降</a>のサンプルアプリケーションからは、scaffold を一切使わずに開発を進めていきます。scaffold を使わない代わりに、開発の各ステップで、手頃な<em>一口サイズ</em>のコードを書いてもらいます。この一口サイズのコードは、無理なく理解できる程度にシンプルで、かつ、ある程度の歯ごたえとやりがいを得られるように配慮してあります。各ステップで理解する必要のあるコードの量はわずかですが、こうした理解を積み重ねていくことで、最終的にRailsの知識を高いレベルで身につけられるように構成されています。この知識は、どのようなWebアプリを作成する時にも応用が効く、柔軟性の高いものです。</p>
</div>




<div class="label" id="sec-introduction"></div>


<h2><a id="sec-1_1" href="./beginning.html#sec-introduction" class="heading"><span class="number">1.1</span>はじめに</a></h2>


<p>Ruby on Rails は2004年にデビューして以来、急速に成長していきました。現在では、動的な Web アプリケーションを開発するフレームワークとして、最も有力かつ人気のあるフレームワークの１つになっています。小さなスタートアップから巨大企業まで、多くの組織が Rails を使っています。例えば、<a href="http://37signals.com/">37signals</a> や <a href="http://github.com/">GitHub</a>、<a href="http://shopify.com/">Shopify</a>、<a href="http://scribd.com/">Scribd</a>、<a href="http://twitter.com/">Twitter</a>、<a href="http://livingsocial.com/">Disney</a>、<a href="http://groupon.com/">Hulu</a>、<a href="http://hulu.com/">Yellow Pages</a> など、<a href="http://yellowpages.com/">Ruby on Rails を使っているサイトのリスト</a>は増える一方です。他にも、<a href="http://entp.com/">ENTP</a> や <a href="http://thoughtbot.com/">thoughtbot</a>、<a href="http://pivotallabs.com/">Pivotal Labs</a>、<a href="http://hashrocket.com/">Hashrocket</a> といった、Rails を専門的に扱う会社も数多くあります。また、Rails を専門にしたフリーランスのコンサルタントやインストラクター、開発者については、数え切るのが難しいほどです。</p>

<p>どうして Rails はこれだけ多くに人達に使われているのでしょうか？その理由の１つは、Rails が100%オープンソースで、制限の緩い <a href="http://www.opensource.org/licenses/mit-license.php">MIT ライセンス</a>で公開されているからです。これにより、Rails をダウンロードしたり使ったりしても、一切コストがかかりません。また、Rails が簡潔で美しく設計されていることも、Rails の成功を支えている秘訣の１つです。これは、Rails の背後で動いている <a href="http://ruby-lang.org/">Ruby</a> 言語の柔軟性によって実現されています。具体的には、Web アプリケーションの作成に特化した <a href="http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E">DSL (ドメイン固有言語)</a> を Ruby 言語で実装しているため、HTML やデータモデルの生成、URL のルーティングなど、Web プログラミングで必要な多くの作業が簡単になります。結果として、Rails を使ってアプリケーションを開発すると、コードが簡潔になり、読みやすくなります。</p>

<p>さらに、Rails は、最新の Web テクノロジーやフレームワーク設計に素早く適応しています。例えば、Rails は、REST という設計思想の重要性をいち早く理解し、対応したフレームワークの１つです (RESTについて後で解説します)。また、他のフレームワークで成功した新しい技術があれば、Railsの創始者である <a href="http://loudthinking.com/">David Heinemeier Hansson</a> や <a href="http://rubyonrails.org/core">Rails のコアチーム</a>は、そのアイデアをためらうことなく取り入れています。最も印象深い例の１つは、恐らく、当時ライバルの関係にあった Merb と Rails との統合です。この統合の結果、Rails は、Merb のモジュール設計や安定した <a href="http://ja.wikipedia.org/wiki/Application_programming_interface">API</a>、そして、パフォーマンスの向上といった恩恵を受けることができました。</p>

<p>最後に、Rails には、非常に熱心で多様なコミュニティがあります。具体的には、何百人ものオープンソース<a href="http://contributors.rubyonrails.org/">コントリビュータ</a>達や、多くの参加者で賑わう<a href="http://railsconf.com/">カンファレンス</a>、膨大な数の <a href="http://agilewebdevelopment.com/plugins">gem</a> (例えば、ページネーションや画像アップロードといった特定の問題を解決するための gem など) 、情報豊かなブログの数々、そして、掲示板や IRC の宝庫が、Rails コミュニティの中に存在しています。このような熱心で多様なコミュニティのおかげで、例えば、開発中に何らかのエラーに遭遇したとしても、エラー内容を Google で検索するだけで、関連するブログ記事や掲示板のスレッドを見つけることができます。</p>

<div class="label" id="sec-comments_for_various_readers"></div>


<h3><a id="sec-1_1_1" href="./beginning.html#sec-comments_for_various_readers" class="heading"><span class="number">1.1.1</span> 読者の皆さまへのコメント</a></h3>


<p><em>Rails チュートリアル</em>は、統合的なチュートリアルになっています。本チュートリアルは Rails を中心に構成されていますが、他にも、Ruby 言語や RSpec を使ったテスト、<a href="http://ja.wikipedia.org/wiki/HTML">HTML</a>、<a href="http://ja.wikipedia.org/wiki/CSS">CSS</a>、そして、わずかな <a href="http://ja.wikipedia.org/wiki/JavaScript">JavaScript</a> と <a href="http://ja.wikipedia.org/wiki/SQL">SQL</a>のチュートリアルも含まれています。このような統合的なチュートリアルになっているため、現時点の Web 開発の知識量に関わらず、このチュートリアルを読み終える頃には、あなたは上述した各トピックを卒なくこなせるようになるだけではなく、より高度な情報源を難なく読みこなす実力がつくようになります。言い換えると、本書で扱うトピックの範囲が<em>広い</em>ということでもあります。もしまだ十分なプログラミング経験を持っていないのであれば、その情報量の多さに圧倒されるかもしれません。そこで、読者の経験や知識に応じた、<em>Railsチュートリアル</em>を読破するためのアドバイスを用意しました。ぜひ参考にしてください。<br /></p>

<p><strong>【すべての読者へ】</strong> よく聞かれる質問の１つが「Rails を覚える前に Ruby を勉強した方が良いでしょうか？」という質問です。この質問の答えは、あなたの学習スタイルやプログラミング経験によります。もしあなたが全てを最初から体系的に学びたい場合や、プログラミングの経験が全くない場合は、恐らく、Ruby を最初に学んだ方が良いでしょう。また、Ruby を学ぶのであれば、Peter Cooper の「<a href="http://amzn.to/1k4KqxP"><em>Beginning Ruby</em></a>」をお勧めします。一方で、これから Rails で開発を始めようとする人の多くは「<em>Web アプリケーション</em>を作りたい！」と考えているので、たった1つの Web ページを作成するために 500 ページもある Ruby の本を読み通す気にはなれないでしょう。したがって、このような方には、Ruby を対話的に学習できる Web サービス「<a href="http://tryruby.org/">Try Ruby</a><sup class="footnote" id="fnref-1_2"><a href="./beginning.html#fn-1_2">2</a></sup>」を使って、Ruby をザックリと理解しておくことをお勧めします。また、必要であれば、<a href="http://railsforzombies.org/">Rails for Zombies</a><sup class="footnote" id="fnref-1_3"><a href="./beginning.html#fn-1_3">3</a></sup>で Rails の全体像を把握しておくと良いかもしれません (訳注: いずれも英語版のみ)。</p>

<p>もう１つよく聞かれる質問が「最初からテストを書くべきですか？」という質問です。「はじめに」で述べたように、<em>Rails チュートリアル</em>では、テスト駆動開発 (TDD) を最初から採用しています。というのも、著者の開発経験から、テスト駆動開発が、Rails アプリケーションの開発に最も適切な手法だと考えているからです。ただし、テスト駆動開発を採用したことにより、本チュートリアルの複雑さが増し、読者への負担も増えています。そこで、もしテストで行き詰まってしまった場合には、思い切って (一周目は) その箇所を飛ばしてしまいましょう。あるいは、もっとお勧めの方法としては、「テストがどのように動くか」は気にせずに、あなたの書いたコードが正しく動くかどうかの検証ツールとして、本書のテストを使う方法です。具体的には、<em>spec</em> と呼ばれるテストファイルを作成し、そのファイルに、<em>本書で指示された通りに</em>テストコードをコピー＆ペーストしてください。<a class="ref" href="./filling-in-the-layout.html#top">第5章</a>で詳しく説明しますが、テストスイート (複数のテストケースを束ねたもの) を実行すると、最初はテストに失敗します。失敗することを確認したら、チュートリアルに従って、今度はアプリケーションのコードを書きます。最後に、同じテストスイートをもう一度実行すると、今度はテストに成功するようになっています。つまり、無事にテストに成功すれば、あなたが書いたコードは正しく動いている、ということになります。<br /></p>

<p><strong>【初めてプログラミングを始める方へ】</strong> <em>Rails チュートリアル</em>は、完全なプログラミング初心者を対象にして書かれたものではありません。というのも、比較的シンプルなWebアプリケーションであっても、ある程度の複雑さが必ず存在するからです。したがって、もしあなたが Web プログラミングの初心者で、かつ、この <em>Rails チュートリアル</em>を難しすぎると感じた場合は、まずは HTML や CSS の基礎を勉強してみると良いでしょう。それらの基礎が備わったら、是非もう一度 <em>Rails チュートリアル</em>に挑戦してください。(ちなみに、「これだ！」というお勧めの教材は思いつかなかったのですが、「<a href="http://headfirstlabs.com/books/hfhtml/"><em>Head First HTML</em></a>」は良い本のように思えます。また、David Sawyer McFarland による「<a href="http://amzn.to/1sRu6mK"><em>CSS: The Missing Manual</em></a>」を推薦してくれた読者もいます。)  Peter Cooper の「<a href="http://amzn.to/1k4KqxP"><em>Beginning Ruby</em></a>」の最初の2, 3章をやってみるのも良いでしょう。同書で扱うサンプルアプリケーションは、本格的な Web アプリケーションに比べて非常に小さいので、比較的やりやすいと思います。何故このようなセクションを設けたかというと、驚くほど多くの初心者の方々が、本書で Web 開発を学ぼうとしているからです。もちろん、それを止めるようなことはしません。ぜひ挑戦してみてください。最後に、そうした方々に特にお勧めするのは「<a href="https://www.railstutorial.org">Ruby><em>Rails チュートリアル</em>のスクリーンキャストのシリーズ</a><sup class="footnote" id="fnref-1_4"><a href="./beginning.html#fn-1_4">4</a></sup>」です (訳注: <a href="https://www.railstutorial.org">Ruby>日本語版</a>もリリースされました!)。この動画版 Rails チュートリアルでは、Rails を使ったソフトウェア開発の作業を、まるで 「肩越しに」見ているかのように学ぶことができます。<br /></p>

<p><strong>【プログラミングの経験があり、これから Web 開発を始める方へ】</strong> 既にクラスやメソッド、データ構造などの概念に馴染みがある方であれば、その知識は有利に働きます。ただし、Java や C/C++ といった言語と Ruby 言語では、記法が異なるので、少し違和感があるかもしれません。しかし、Ruby 言語の記法に慣れるまでに、そこまで時間はかかりません。(例えば、行末にセミコロンを書く習慣がついているかもしれませんが、Ruby では行末にセミコロンを置いても問題なく動きます。) <em>Rails チュートリアル</em>では、覚える必要のある Web 特有の概念を全てカバーしているので、例えば、もし今 <tt>POST</tt> や <tt>PATCH</tt> の違いが分からなくても、心配する必要はありません。<br /></p>

<p><strong>【Web 開発の経験があり、これから Railsを始める方へ】</strong> もし PHP や Python といった動的言語を使った経験がある場合、本書を楽に読み進められるはずです。特に、Python の経験があると非常に有利です。本書でカバーする基本的な概念については既に知っていると思いますが、テスト駆動開発や REST 構造については、初めて触れる概念になるかもしれません。また、Ruby には特有のクセがあるので、これも本書で初めて触れる知識になるでしょう。<br /></p>

<p><strong>【Ruby プログラミングの経験があり、これから Rails を始める方へ】</strong> 最近では多くの Ruby プログラマが Rails を使っているので、純粋に Ruby のみを使っている方は少ないと思います。ただ、もしあなたが純粋な Ruby プログラマであれば、本書をすらすら読めるに違いありません。また、本書を読み終わった後に、独自のアプリケーションを開発することも難しくないはずです。<br /></p>

<p><strong>【Rails を使った経験はあるが、まだ十分ではない方へ】</strong> もしかしたら、既に他のチュートリアルを読んだり、小規模な Rails アプリをいくつかの作った経験があるかもしれません。読者からのフィードバックを読む限りでは、そのような背景を持った方であっても、本書から多くのことを学べるはずだと自信を持って言えます。本書には、あなたが初めて Rails を学んだ頃よりも新しい技術がふんだんに盛り込まれているため、本書で学ぶ技術はきっと役に立つはずです。<br /></p>

<p><strong>【Rails を使った経験が十分にある方へ】</strong> Rails を使った開発の経験が既に十分にある場合、本書は必要ないでしょう。しかし、多くの Rails 開発者から「意外と役に立った」との声を頂いているので、Rails 開発者であっても、Rails を違う視点から見て楽しめるかもしれません。<br /></p>

<p>最後に、<em>Ruby on Rails チュートリアル</em>を読み終えた経験豊富なプログラマの方には、さらに高度な話題を扱っている「The Well-Grounded Rubyist」(David A. Black 著) または「Eloquent Ruby」(Russ Olsen 著) を読むことをお勧めします。あるいは、トピック別に書かれている「The Ruby Way」(Hal Fulton 著) を読んでみるのも良いでしょう。<br /></p>

<p>本書を読み始めた時の知識量がどのようなレベルであったとして、本書を読み終えた頃には、あなたはより高度な Rails の情報源を読めるようになっているはずです。中でも、特にお勧めしたい Rails の情報源は、次のとおりです。</p>

<ul>

<li><a href="http://railscasts.com/">RailsCasts (英語)</a> (Ryan Bates) : 質の高い (ほぼ) 無料のスクリーンキャスト</li>
<li><a href="http://peepcode.com/">PeepCode (英語)</a>: 質の高い商用のスクリーンキャスト</li>
<li><a href="http://www.codeschool.com/">Code School (英語)</a>: プログラミングを対話的に学習できるコース</li>
<li><a href="http://railsguides.jp/">Rails ガイド</a>: トピック毎に分類された最新の Rails リファレンス</li>
<li><a href="http://railscasts.com/">RailsCasts (英語)</a> (Ryan Bates): さっきも <a href="http://railscasts.com/">RailsCasts</a> を紹介しましたっけ？そのぐらい <a href="http://railscasts.com/"><em>RailsCasts</em></a> はお勧めです。</li>


</ul>




<h3><a id="sec-1_1_2" href="./beginning.html#sec-1_1_2" class="heading"><span class="number">1.1.2</span> Railsと「スケール」について</a></h3>


<p>本節を続ける前に、一旦ここで、初期の頃から Rails フレームワークに対して指摘されていた「Rails はスケールできない」という主張について触れたいと思います。すなわち、「Rails では大量のトラフィックを捌くことができない」という主張です。この主張の一部には、間違った認識があります。それは、<a href="http://idleprocess.wordpress.com/2009/11/24/presentation-summary-high-performance-at-massive-scale-lessons-learned-at-facebook/">あなたが<em>Webサイト</em>をスケールさせるのであって、フレームワークがWebサイトをスケールさせるのではない</a>、ということです。Rails は素晴らしいフレームワークではありますが、しかし、ただのフレームワークでしかありません。したがって、本来のあるべき問いは「Rails で構築されたWebサイトはスケールできるのか？」となります。そして、今となっては、この主張の答えは明白です。なぜなら、世界で最もトラフィックの大きいWebサイトのいくつかは、Rails で構築されているからです。ただし、Webサイトをスケール<em>させる</em>ことは、Rails だけで出来ることではありません。Rails 以外の知識も必要になります。といっても、Hulu や Yellow Pages といった大量のトラフィックを捌いているWebアプリケーションも Rails で構築されているので、そこまで心配する必要はありません。少なくとも、<em>あなたの</em>アプリケーションが Hulu や Yellow Pages 並みに成長するまでの間は、「Rails だからスケールできない」ということにはならないでしょう。</p>

<div class="label" id="sec-conventions"></div>


<h3><a id="sec-1_1_3" href="./beginning.html#sec-conventions" class="heading"><span class="number">1.1.3</span> この本における取り決め</a></h3>


<p>本書では、できるだけ分かりやすい取り決めを使っています。本項では、その中でも、分かりにくいかもしれない一部の取り決めについて説明します。</p>

<p><a href="./book">HTML 版</a>、<a href="http://tatsu-zine.com/books/railstutorial">PDF 版</a>ともに、文中には内部リンク (<a class="ref" href="./beginning.html#sec-up_and_running">1.2</a>など) と外部リンク (<a href="http://rubyonrails.org/download">Ruby on Railsダウンロードページ</a>など) が多数含まれています<sup class="footnote" id="fnref-1_5"><a href="./beginning.html#fn-1_5">5</a></sup>。</p>

<p>本書の出てくる例の多くは、コマンドライン (ターミナル) のコマンドを使っています。簡素化のため、コマンドラインを使った例では、次のような Unix スタイルのプロンプト (行の頭に &#39;$&#39; を表示するスタイル) を使っています。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">&quot;hello, world&quot;</span>
<span class="go">&quot;hello world&quot;</span>
</pre></div>
</div>


<p>なお、Windows のコマンドラインでは、大なり記号 (<code>&gt;</code>) がプロンプトに表示されるので、$ を &gt; に置き換えて読んでください。</p>

<div class="code"><div class="highlight"><pre><span class="go">C:\Sites&gt; echo &quot;hello, world&quot;</span>
<span class="go">&quot;hello world&quot;</span>
</pre></div>
</div>


<p>また、Unix システム上では、いくつかのコマンドを入力する際に <code>sudo</code> コマンド (他のユーザーとしてプログラムを実行するためのコマンド) を使わなければならない場合があります<sup class="footnote" id="fnref-1_6"><a href="./beginning.html#fn-1_6">6</a></sup>。<code>sudo</code> コマンドを使って実行されたプログラムは、通常のユーザーではアクセスできないファイルやディレクトリにアクセスできる「管理者権限」で実行されます。例えば、<a class="ref" href="./beginning.html#sec-rubygems">1.2.2</a> では、次のような管理者権限で実行するコマンドが出てきます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> sudo ruby setup.rb</pre></div>
</div>


<p>ほとんどの Unix/Linux/OS X のシステムでは、<code>sudo</code> の実行が必要です。ただし、<a class="ref" href="./beginning.html#sec-install_ruby">1.2.2.3</a> で推奨されている Ruby Version Manager を使っている場合は、次の例のように、管理者権限を使わずに実行することができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby setup.rb</pre></div>
</div>


<p>Rails には、コマンドラインで実行できる多数のコマンドが付属しています。例えば、<a class="ref" href="./beginning.html#sec-rails_server">1.2.5</a> で使われる次のコマンドは、開発用 Web サーバーをローカル PC 上で実行するコマンドです。</p>

<div class="code"><div class="highlight"><pre><span class="nv">$ </span>rails server</pre></div>
</div>


<p>コマンドラインのプロンプトと同様に、<em>Rails チュートリアル</em>では、ディレクトリの区切りに Unix スタイルのスラッシュ(<code>/</code>)を使っています。したがって、例えばサンプルアプリケーションの場所は、次にように表記されます。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app</pre></div>
</div>


<p>なお、Windows のコマンドプロンプトでは、ディレクトリの区切りは次のように表示されるはずです。</p>

<div class="code"><div class="highlight"><pre>C:\Sites\sample_app</pre></div>
</div>


<p>Rails で作成するアプリケーションのルートディレクトリを、<em>Rails ルート</em>と呼びます。この用語は誤解されやすいようで、多くの人が Rails ルートを「Railsがインストールされたディレクトリ」だと勘違いします。この点を明確にするため、<em>Rails チュートリアル</em>では、Rails ルートは <em>Rails アプリケーションのルートディレクトリ</em>を指すものとします。また、全てのディレクトリは、このルートディレクトリを起点とした相対パスで示します。例えば、著者のサンプルアプリケーションの <code>config</code> ディレクトリは、次の場所にあります。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app/config</pre></div>
</div>


<p>このとき、この Rails アプリケーションのルートディレクトリは、<code>config</code> ディレクトリの1つ上の階層にあります。したがって、次の場所にあります。</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app</pre></div>
</div>


<p>しかし、長いパスを毎回表記すると、読みづらくなります。そこで、本書では、次のようなディレクトリパスを参照する場合、</p>

<div class="code"><div class="highlight"><pre>/Users/mhartl/rails_projects/sample_app/config/routes.rb</pre></div>
</div>


<p>アプリケーションのルートパスを省略して、単純に <code>config/routes.rb</code> と表記することにします。</p>

<p><em>Rails チュートリアル</em>では、様々なプログラムの出力結果  (例えば、シェルコマンドやバージョン管理ツール、Ruby プログラムの出力結果) を、頻繁に記載するようにしています。出力結果は、コンピュータシステムによって微妙に異なるので、本書の出力結果と実際の出力が正確に一致するとは限りません。しかし、細かい出力結果の差異が問題になることはないので、あまり気にする必要はありません。</p>

<p>一方、コンピュータシステムによっては、一部のコマンドを実行した時にエラーが発生するかもしれません。しかし本書では、あらゆる場面を想定して、全てのエラーの対策を記載するような<a href="http://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%BC%E3%82%B7%E3%83%A5%E3%83%9D%E3%82%B9">果てしない徒労</a>はしていません。その代わり、エラーメッセージを Google で検索してください (原文: &quot;Google the error message&quot; algorithm) &quot;。エラーメッセージを Google で検索することは、実際のソフトウェア開発でも使われているテクニックなので、その良い練習にも繋がります。もし本書のチュートリアルを進めていくうちに何か問題が生じたら、<a href="./help">Rails チュートリアルの Help ページ</a>を読んでみてください。このページには、問題を解決するためのリソースやヒントが記載されているので、問題を解決する手掛かりになるはずです<sup class="footnote" id="fnref-1_7"><a href="./beginning.html#fn-1_7">7</a></sup>。</p>

<div class="label" id="sec-up_and_running"></div>


<h2><a id="sec-1_2" href="./beginning.html#sec-up_and_running" class="heading"><span class="number">1.2</span> さっそく動作させる</a></h2>




<blockquote><p>本書の第1章は、さしずめロースクールで言うところの「淘汰期間」(訳注: そこで生き残れるかどうかを選別する期間) のようなものである。本章で開発環境の構築に成功できた人ならば、最後までやり通すことは難しくありません。<br /> —Bob Cavezza (<em>Rails チュートリアル</em>読者)</p>
</blockquote>


<p>いよいよ、Ruby on Rails の開発構築と、最初のアプリを作成する時が来ました。プログラミング経験が無い方は少し苦労すると思いますが、どうか諦めずに頑張ってください。苦労するのはあなただけではありません。これは全ての開発者が何度も通る道であり、そして、ここでの苦労が大いに報われることは、著者が保証いたします。</p>

<div class="label" id="sec-development_tools"></div>


<h3><a id="sec-1_2_1" href="./beginning.html#sec-development_tools" class="heading"><span class="number">1.2.1</span>開発環境</a></h3>


<p>開発環境は Rails プログラマの数だけあります。というのも、開発者は慣れてくると、自分の環境をとことんカスタマイズするものだからです。しかし、大別すると、開発環境はテキストエディタやコマンドラインを使う環境と、IDE 環境 (統合開発環境) の２つに分けられます。まずは後者から見てみましょう。</p>

<h4><a id="sec-1_2_1_1" href="./beginning.html#sec-1_2_1_1" class="heading">IDE</a></h4>


<p>最も有名な Rails 用 IDE として、<a href="http://www.aptana.com/rails/">RadRails</a> と <a href="http://www.jetbrains.com/ruby/index.html">RubyMine</a> が挙げられます。中でも、RubyMine が良いという評判をよく聞きます。本書の読者の一人 (David Loeffler) は、<a href="https://github.com/perfectionist/sample_project/wiki">Rails チュートリアルで RubyMine を使用する方法</a><sup class="footnote" id="fnref-1_8"><a href="./beginning.html#fn-1_8">8</a></sup> というドキュメントをまとめてくれました。IDE での開発が好みという方は、先ほど挙げたリンクをチェックしてみて、自分のスタイルに合うかどうか試しに使ってみるとよいでしょう。</p>

<h4><a id="sec-1_2_1_2" href="./beginning.html#sec-1_2_1_2" class="heading">テキストエディタとコマンドライン</a></h4>


<p>著者自身は、全てが整った強力な IDE の代わりに、「<em>テキストエディタ</em>でテキストを編集し、<em>コマンドライン</em>でコマンドを実行する」というシンプルな手段を好んでいます (<a class="ref" href="./beginning.html#fig-editor_shell">図 1.1</a>)。どのように組み合わせて使うべきかはあなたの好みやプラットフォームによって異なりますが、私がお勧めするツールを次の通りです。</p>

<ul>
<li><strong>テキストエディタ:</strong> 断然 <a href="http://www.sublimetext.com/2">Sublime Text 2</a> をお勧めします。これは非常によくできたクロスプラットフォームのテキストエディタです。現時点ではまだベータ版ですが、既にベータ版とは思えないほどパワフルなエディタです。Sublime Text は、<a href="http://macromates.com">TextMate</a> の影響を強く受けています。実際、スニペットやカラースキームなどの設定では TextMate との互換性があります。（TextMate は Mac OS X 版しかありませんが、もしあなたが Mac ユーザーであれば、TextMate は今でも良い選択であると言えます。) 次に私がお勧めするテキストエディタは <a href="http://www.vim.org/">Vim</a><sup class="footnote" id="fnref-1_9"><a href="./beginning.html#fn-1_9">9</a></sup> です。Vim は多くのプラットフォーム上で動作します。Vim は無償で手に入りますが、Sublime Text は有償です (訳注: ただし、無料の試用期間に制限はありません)。どちらもプロの開発者が使っているエディタですが、私の経験では、Sublime Text の方が初心者にとって<em>はるかに</em>扱いやすいエディタだと言えます。</li>

<li><strong>ターミナル:</strong> OS X の場合、<a href="http://iterm.sourceforge.net/">iTerm</a> か、最初からインストールされている Terminal.app をお勧めします。Linux の場合、デフォルトのターミナルで問題ありません。Windows の場合、Linux が動作する仮想マシンを用意して、その仮想マシン上で Rails アプリケーションを開発する人が多いです。この場合、お勧めのコマンドラインの上記の通りです。一方で、Windows 自身に開発環境をインストールしたい場合、<a href="http://railsinstaller.org/">Rails インストーラ</a>付属のコマンドプロンプトを使うことをお勧めします (<a class="ref" href="./beginning.html#sec-rails_installer_windows">1.2.2.1</a>)。</li>
</ul>


<p>なお、Sublime Text を選んだ方の中のために、より高度な設定方法を解説した <a href="https://github.com/mhartl/rails_tutorial_sublime_text">Railsチュートリアル: Sublime Text</a><sup class="footnote" id="fnref-1_10"><a href="./beginning.html#fn-1_10">10</a></sup> を用意しました。ただし、この種の設定は厄介でエラーも起きやすいので、あくまで上級者向けです。Sublime Text は、デフォルト設定のままでも、Rails アプリケーションのエディタとして十分に機能します。</p>

<div class="label" id="fig-editor_shell"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/editor_shell.png" alt="editor_shell" /></span></div><div class="caption"><span class="header">図1.1：</span> <span class="description">テキストエディタ/コマンドライン開発環境 (TextMate/ iTerm) <a href="../images/figures/editor_shell-full.png">(拡大)</a></span></div></div>




<h4><a id="sec-1_2_1_3" href="./beginning.html#sec-1_2_1_3" class="heading">ブラウザ</a></h4>


<p>Webブラウザの種類は豊富ですが、大半の Rails 開発者は Firefox や Safari、あるいは Chrome を使います。これらの3つのブラウザには、ページの任意の部分を右クリック (または control を押しながらクリック) して、要素を表示する機能 (Inspect element 機能) が標準で組み込まれています。</p>

<h4><a id="sec-1_2_1_4" href="./beginning.html#sec-1_2_1_4" class="heading">使用するツールについて</a></h4>


<p>開発環境を整えていく過程で、「全てを思い通りに使いこなすには<em>かなり</em>長い時間がかかる」と実感するかもしれません。実際、テキストエディタや IDE を使いこなせるようになるまでには、非常に長い時間が必要になります。例えば、Sublime Text や Vim にも専用のチュートリアルがあり、このようなチュートリアルを読み終えるだけでも数週間かかります。初めて開発する方は驚いたかもしれませんが、<em>開発ツールの学習に時間をかけることは、いたって普通の事</em>であり、開発者であれば誰もが通る道です。「良いアイディアが浮かんだから、<em>ただ Rails で Web アプリを作りたいだけ</em>なのに、奇妙で古くさい Unix のエディタの使い方を覚えるだけで1週間もかかってる！」とイライラする事もあるでしょう。しかしながら、道具の使い方を覚えることが職人にとって当然の心得であるように、使用するツールについて学ぶことは大切なことです。払った努力に見合う見返りが、必ずあります。</p>

<div class="label" id="sec-rubygems"></div>


<h3><a id="sec-1_2_2" href="./beginning.html#sec-rubygems" class="heading"><span class="number">1.2.2</span>Ruby、RubyGems、Rails、Git</a></h3>




<blockquote><p>実質的に世界中のあらゆるソフトウェアは、壊れているか使いにくいかのどちらかだ。人々がソフトウェアに恐怖心を抱くのは、結局これが原因なのだ。人々は何かインストールしようとしたりオンラインフォームに記入したりするたびに、それらがさっぱり動かないという事態にすっかり慣らされてしまっている。正直、<em>私は</em>何かをインストールすることが怖い。これでも私はコンピュータサイエンスの博士号を持っているのだが。<br /> —Paul Graham (<em>Founders at Work</em>)</p>
</blockquote>


<p>さあ、RubyとRailsをインストールしましょう。本書では可能な限り多くの環境をカバーするようにしていますが、システムが変われば手順がうまくいかないこともあります。問題が生じた場合は、エラーメッセージをGoogleで検索するか、<a href="./help">RailsチュートリアルのHelpページ</a>を参照してください。</p>

<p><strong>なお、特に断りのない限り、Railsを含むすべてのソフトウェアはチュートリアルで使用されているものと同じバージョンを使用してください。そうでないと同じ結果を得られないことがあります。</strong> バージョンが少々異なっていても同じ結果を得られることもありますが、特にRailsのバージョンに関しては必ず指定を守ってください。一方、例外もあります。たとえば、Rubyのバージョンがその例外に該当します。本チュートリアル内では、Ruby 1.9.3とRuby 2.0.0は実質的に同じように動作するので、どちらを使ってもチュートリアルには影響しません。お好きな方をご使用ください。</p>

<div class="label" id="sec-rails_installer_windows"></div>


<h4><a id="sec-1_2_2_1" href="./beginning.html#sec-rails_installer_windows" class="heading">Railsインストーラ (Windows)</a></h4>


<p>最近までWindows上でのRailsのインストールは困難だったのですが、<a href="http://engineyard.com/">Engine Yard</a>の方々(特にDr. Nic WilliamsとWayne E. Seguin)のおかげで非常に簡単になりました。Windowsユーザーの方は<a href="http://railsinstaller.org/">Railsインストーラ</a>からインストーラをダウンロードしてください。exeファイルをダブルクリックし、指示に従ってGit、Ruby、RubyGems、そしてRails自身をインストールします (<a class="ref" href="./beginning.html#sec-install_git">1.2.2.2</a>、<a class="ref" href="./beginning.html#sec-install_ruby">1.2.2.3</a>、<a class="ref" href="./beginning.html#sec-install_rubygems">1.2.2.4</a>、<a class="ref" href="./beginning.html#sec-install_rails">1.2.2.5</a>はスキップしてください)。インストール完了後、<a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>までスキップして最初のアプリケーション作成に取りかかってください。</p>

<p>注意: このRailsインストーラによってインストールされるRailsのバージョンは<a class="ref" href="./beginning.html#sec-install_rails">1.2.2.5</a>に記載のものと異なることがあります。その場合、互換性の問題が生じることもありえます。この問題を解決するために、Railsのバージョン番号順に並んだRubyインストーラのリストを作成してもらうようNicとWayneに働きかけています。</p>

<div class="label" id="sec-install_git"></div>


<h4><a id="sec-1_2_2_2" href="./beginning.html#sec-install_git" class="heading">Gitのインストール</a></h4>


<p>Rails環境の多くの部分は、<a href="http://git-scm.com/">Git</a>という<a href="http://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0">バージョン管理システム</a>の機能に依存します (Gitの詳細については<a class="ref" href="./beginning.html#sec-version_control">1.3</a>で解説しています)。Gitは本書で多用されているので、早い内にインストールを済ませておきます。<a href="http://git-scm.com/book/ja/%E4%BD%BF%E3%81%84%E5%A7%8B%E3%82%81%E3%82%8B-Git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><em>Pro Git</em>の「Gitのインストール」</a>でプラットフォーム毎の解説を行っているので参考にしてください。</p>

<div class="label" id="sec-install_ruby"></div>


<h4><a id="sec-1_2_2_3" href="./beginning.html#sec-install_ruby" class="heading">Rubyのインストール</a></h4>


<p>次にRubyをインストールします。もしかすると既にあなたのシステムに入っているかもしれないので、その場合は以下を実行して</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby -v<span class="go">
ruby &quot;1.9.3&quot;</span>
</pre></div>
</div>


<p>バージョン情報を確認してください。Rails 3はRuby 1.8.7以上で動作しますが、1.9.2が最適です。このチュートリアルはバージョン1.9.2または1.9.3を使用していることを前提で進めていきますが、1.8.7でも問題はないはずです (ただし1つだけ文法の違いがあり、<a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>で補足しています。また、出力に若干の違いが生じます)。</p>

<p>OS X、またはLinuxを使う場合、<a href="http://rvm.io/">Ruby Version Manager (RVM)</a>を使用してRubyをインストールすることを強くお勧めします(訳注: 最近ではrbenvも有力です。rbenvのセットアップ方法については、こちらをご参照ください: <a href='https://gist.github.com/axross/8429061'>rbenvを使ったRailsチュートリアルの進め方</a>)。RVMを使うと、複数のRubyバージョンを共存させられるのでとても便利です。(Windows上で動作する同様のソフトに<a href="http://github.com/vertiginous/pik">Pik</a>があります。)同じマシン上で異なるバージョンのRubyやRailsを実行したい場合、これは特に重要です。RVMで問題が生じたときは、作者のWayne E. SeguinとRVMのIRCチャットのチャンネル (<a href="http://webchat.freenode.net/?channels=rvm">#rvm on freenode.net</a>)で連絡を取れることがあります<sup class="footnote" id="fnref-1_11"><a href="./beginning.html#fn-1_11">11</a></sup>。Linuxを使用している方には、Sudobitsブログの「<a href="http://blog.sudobits.com/2012/05/02/how-to-install-ruby-on-rails-in-ubuntu-12-04-lts/">UbuntuにRuby on Railsをインストールする方法</a>」が特にお勧めです。</p>

<p><a href="http://rvm.io/rvm/install/">RVMをインストール</a>後、以下を実行してRubyをインストールします<sup class="footnote" id="fnref-1_12"><a href="./beginning.html#fn-1_12">12</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm get head <span class="o">&amp;&amp;</span> rvm reload
<span class="gp">$</span> rvm install 1.9.3
<span class="go">&lt;しばらく待つ&gt;</span>
</pre></div>
</div>


<p>最初のコマンドはRVMの更新とリロードを行います。RVMは頻繁に更新されているので、RVM操作の際にはこれを行うようにしてください。次のコマンドはRuby 1.9.3をインストールします。システムによってはダウンロードとコンパイルに多少時間がかかることがありますので、なかなか終わらなくても心配せずに待ってください。</p>

<p>OS Xユーザーの場合、<code>autoconf</code>の実行ファイルがないと問題が生じることがあります。この場合は<a href="http://mxcl.github.com/homebrew/">Homebrew</a><sup class="footnote" id="fnref-1_13"><a href="./beginning.html#fn-1_13">13</a></sup>というOS X用のパッケージ管理システムをインストールしてから以下を実行してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> brew install automake
<span class="gp">$</span> rvm install 1.9.3
</pre></div>
</div>


<p>Linuxユーザーの場合、OpenSSLというライブラリへのパスを追加する必要が生じることがあるとの報告を受けました。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm install 1.9.3 --with-openssl-dir<span class="o">=</span><span class="nv">$HOME</span>/.rvm/
</pre></div>
</div>


<p>一部の古いOS Xシステムでは、readlineライブラリへのパスを追加する必要が生じる場合があります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm install 1.9.3 --with-readline-dir<span class="o">=</span>/opt/local
</pre></div>
</div>


<p>(何度も書きましたが、環境構築にトラブルはつきものです。地道にネットを検索し、問題を特定することが唯一の解決策です。)</p>

<p>Rubyをインストールしたら、Railsのアプリケーションを実行するために必要な他のソフトウェア向けにシステムを構成する必要があります。通常、これは<em>gem</em>のインストールに関連します。gemとは自己完結型のRubyコードのパッケージです。バージョン番号の異なるgem同士がコンフリクトすることがあるため、一連のgemを自己完結的にまとめた<em>gemset</em>というものを作成してバージョンを使い分けるのが便利です。本書のチュートリアル用に、以下の要領で<code>rails3tutorial2ndEd</code>というgemsetをぜひ作成しておいてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm use 1.9.3@rails3tutorial2ndEd --create --default
<span class="go">Using /Users/mhartl/.rvm/gems/ruby-1.9.3 with gemset rails3tutorial2ndEd</span>
</pre></div>
</div>


<p>このコマンドを実行すると、Ruby 1.9.3に関連付けて<code>rails3tutorial2ndEd</code>というgemsetを作成し (<tt class="verb">--create</tt>オプション)、このgemsetをただちに使用可能にします (<tt class="verb">use</tt>)とデフォルト指定用の(<tt class="verb">--default</tt>)。以後、<code>1.9.3@rails3tutorial2ndEd</code>というRubyとgemsetの組み合わせがすべてのターミナルウィンドウで使用可能になります。RVMにはgemset管理のためのコマンドが多数用意されています。詳細については<a href="http://rvm.io/gemsets/">http://rvm.beginrescueend.com/gemsets/</a>を参照してください。RVMがうまく動かない場合は以下を実行してヘルプを表示してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm --help
<span class="gp">$</span> rvm gemset --help
</pre></div>
</div>


<div class="label" id="sec-install_rubygems"></div>


<h4><a id="sec-1_2_2_4" href="./beginning.html#sec-install_rubygems" class="heading">RubyGemsのインストール</a></h4>


<p>RubyGemsはRubyのプロジェクトのためのパッケージマネージャであり、Rubyのパッケージ (<em>gem</em>) として利用できる多くの有用なライブラリがあります。Railsもgemとしてインストールします。Rubyがインストールされていれば、RubyGemsは簡単にインストールできます。<a href="http://rvm.io/rvm/install/">RVMをインストール</a>してあれば、既にRubyGemsも同時にインストールされているはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> which gem
<span class="go">/Users/mhartl/.rvm/rubies/ruby-1.9.3-p0/bin/gem</span>
</pre></div>
</div>


<p>RubyGemsがインストールされていない場合は、<a href="https://rubygems.org/pages/download">RubyGemsをダウンロード</a>して解凍し、作成された<code>rubygems</code>ディレクトリでセットアッププログラムを実行してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ruby setup.rb
</pre></div>
</div>


<p>(アクセス権の問題が生じたら、<a class="ref" href="./beginning.html#sec-conventions">1.1.3</a>を参照してください。おそらく<code>sudo</code>コマンドを併用する必要があります。)</p>

<p>既にRubyGemsがインストールされている場合は、システムをチュートリアルで使われているバージョンに更新してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem update --system 1.8.24
</pre></div>
</div>


<p>システムを特定のバージョンに固定しておけば、今後RubyGemsが変更されたときのコンフリクトを防止できます。</p>

<p>gemをインストールすると、RubyGemsによってriとrdocという2種類のドキュメントがデフォルトで作成されます。多くのRubyやRailsの開発者はこれらのドキュメントが自動生成される時間すら惜しいと考えます。(多くのプログラマーはネイティブのriやrdocなど参照せず、さっさとオンラインドキュメントを見に行ってしまいます。) riやrdocの自動生成を抑制するには、<code>.gemrc</code>というファイルを<a class="ref" href="./beginning.html#code-create_gemrc">リスト1.1</a>のようにホームディレクトリに作成し、そこに<a class="ref" href="./beginning.html#code-gemrc">リスト1.2</a>の内容を追加しておきます。(チルダ“<tt class="verb">~</tt>”は「ホームディレクトリ」を表します。 <code>.gemrc</code>ファイルのようにファイル名冒頭にドット「<tt class="verb">.</tt>」を付けると隠しファイルとして扱われます。Unixの設定ファイルにはこのような名前を付けるのが習わしとなっています。)</p>

<div class="label" id="code-create_gemrc"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.1</span> <span class="description">gem設定ファイルを作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> subl ~/.gemrc
</pre></div>
</div></div>


<p>冒頭の<code>subl</code>はOS Xで Sublime Textを起動するコマンドです。 設定方法については<a href="http://www.sublimetext.com/docs/2/osx_command_line.html">OS X コマンドライン用Sublime Text 2ドキュメント</a> (英語) を参照してください。使用しているプラットフォームやエディタが異なる場合、sublを他のエディタコマンドに読み替えてください (エディタのアイコンをダブルクリックするか、<code>mate</code>、<code>vim</code>、<code>gvim</code>、<code>mvim</code>などのコマンドに差し替えます)。記述を簡素化するため、本書で以後<code>subl</code>と書かれていたら各自好みのエディタに読み替えてください。</p>

<div class="label" id="code-gemrc"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.2</span> <span class="description"><code>.gemrc</code>にriとrdoc生成を抑制するコマンドを追加する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">install:</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span>
<span class="ss">update:</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span>
</pre></div>
</div></div>




<div class="label" id="sec-install_rails"></div>


<h4><a id="sec-1_2_2_5" href="./beginning.html#sec-install_rails" class="heading">Railsのインストール</a></h4>


<p>RubyGemsをインストールしてしまえば、Railsのインストールは簡単です。本書ではRails 3.2で統一します。以下を実行して3.2をインストールしてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem install rails -v 3.2.14</pre></div>
</div>


<p>正しくインストールされたかどうかを確認するには、以下のコマンドを実行してバージョンを確認してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails -v
<span class="go">Rails 3.2.14</span>
</pre></div>
</div>


<p><em>メモ: </em> <a class="ref" href="./beginning.html#sec-rails_installer_windows">1.2.2.1</a>でRailsインストーラを使用してRailsをインストールした場合、Railsのバージョンが異なっている可能性があります。この記事の執筆時点では、このバージョンの違いは影響していません。ただし、今後Railsのバージョンが本書指定のものから離れていくにつれ、バージョンの違いによる影響が顕著になる可能性があります。特定のバージョンのRailsインストーラへのリンクを作成してもらえるよう、現在Engine Yardに働きかけています。</p>

<p>Linuxを実行している場合は、この時点で、他にもいくつかのパッケージをインストールする必要が生じる場合があります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> sudo apt-get install libxslt-dev libxml2-dev libsqlite3-dev <span class="c"># Linuxのみ</span>
</pre></div>
</div>




<div class="label" id="sec-the_first_application"></div>


<h3><a id="sec-1_2_3" href="./beginning.html#sec-the_first_application" class="heading"><span class="number">1.2.3</span>最初のアプリケーション</a></h3>


<p>どんなRailsアプリケーションも最初の作成手順は同じです。<code>rails new</code>コマンドを実行して作成します。このコマンドを実行するだけで、指定のディレクトリにRailsアプリケーションのスケルトンを簡単に作成できます。これを行うには、まず複数のRailsプロジェクトを保存するためのディレクトリを作成し、<code>rails new</code>を実行して最初のアプリケーションを作成します (<a class="ref" href="./beginning.html#code-rails_command">リスト1.3</a>)。</p>

<div class="label" id="code-rails_command"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.3</span> <span class="description"><code>rails new</code>を実行してアプリケーションを新規作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> mkdir rails_projects
<span class="gp">$</span> <span class="nb">cd </span>rails_projects
<span class="gp">$</span> rails new first_app
<span class="go">      create  </span>
<span class="go">      create  README.rdoc</span>
<span class="go">      create  Rakefile</span>
<span class="go">      create  config.ru</span>
<span class="go">      create  .gitignore</span>
<span class="go">      create  Gemfile</span>
<span class="go">      create  app</span>
<span class="go">      create  app/assets/images/rails.png</span>
<span class="go">      create  app/assets/javascripts/application.js</span>
<span class="go">      create  app/assets/stylesheets/application.css</span>
<span class="go">      create  app/controllers/application_controller.rb</span>
<span class="go">      create  app/helpers/application_helper.rb</span>
<span class="go">      create  app/mailers</span>
<span class="go">      create  app/models</span>
<span class="go">      create  app/views/layouts/application.html.erb</span>
<span class="go">      create  app/mailers/.gitkeep</span>
<span class="go">      create  app/models/.gitkeep</span>
<span class="go">      create  config</span>
<span class="go">      create  config/routes.rb</span>
<span class="go">      create  config/application.rb</span>
<span class="go">      create  config/environment.rb</span>
<span class="go">      .</span>
<span class="go">      .</span>
<span class="go">      .</span>
<span class="go">      create  vendor/plugins</span>
<span class="go">      create  vendor/plugins/.gitkeep</span>
<span class="go">         run  bundle install</span>
<span class="go">Fetching source index for https://rubygems.org/</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">Your bundle is complete!</span><span class="go"> Use `bundle show [gemname]` 
to see where a bundled gem is installed.</span>
<span class="go"></span>
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-rails_command">Listing 1.3</a>の下の方に注目してください。<code>rails new</code>を実行すると、ファイルの作成後に<code>bundle install</code>コマンドが自動的に実行されています。もしbundle installが実行されていなくても心配はいりません。落ち着いて<a class="ref" href="./beginning.html#sec-bundler">1.2.4</a>の手順に従えば実行できます。</p>

<p><code>rails</code>コマンドによって、非常に多くのファイルとディレクトリが作成されていることに注目してください。ディレクトリとファイルの構造 (<a class="ref" href="./beginning.html#fig-directory_structure_rails_3_2">図1.2</a>) がこのように標準化されていることは数あるRailsの利点の１つであり、実際に動作するアプリケーションを何も無い状態からただちに作成することができるのです。さらに、この構造はすべてのRailsアプリに共通しているので、他の開発者の書いたコードの挙動を容易に推察できます。Railsがデフォルトで作成するファイルについては<a class="ref" href="./beginning.html#table-rails_directory_structure">表1.1</a>を参照してください。本書を通してこれらのファイルやディレクトリの目的を学んでいきます。特に、<a class="ref" href="./filling-in-the-layout.html#sec-the_asset_pipeline">5.2.1</a>以降ではRails 3.1の新機能である<em>アセットパイプライン</em>の一部となる<code>app/assets</code>ディレクトリについて詳しく説明します。アセットパイプラインによって、CSS (Cascading Style Sheet) やJavaScriptファイルなどのアセットを簡単に編成したりデプロイすることができます。</p>

<div class="label" id="fig-directory_structure_rails_3_2"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/directory_structure_rails_31.png" alt="directory_structure_rails_31" /></span></div><div class="caption"><span class="header">図1.2: </span><span class="description">新規作成されたRailsアプリケーションのディレクトリ構造。<a href="../images/figures/directory_structure_rails_31-full.png">(拡大)</a></span></div></div>




<div class="label" id="table-rails_directory_structure"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>ファイル/ディレクトリ</strong></th><th class="align_left"><strong>目的</strong></th></tr><tr class="top_bar"><td class="align_left"><code>app/</code></td><td class="align_left">モデル、ビュー、コントローラ、ヘルパーなどを含む主要なアプリケーションコード</td></tr><tr><td class="align_left"><code>app/assets</code></td><td class="align_left">アプリケーションで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>config/</code></td><td class="align_left">アプリケーションの設定</td></tr><tr><td class="align_left"><code>db/</code></td><td class="align_left">データベース関連のファイル</td></tr><tr><td class="align_left"><code>doc/</code></td><td class="align_left">マニュアルなど、アプリケーションのドキュメント</td></tr><tr><td class="align_left"><code>lib/</code></td><td class="align_left">ライブラリモジュール</td></tr><tr><td class="align_left"><code>lib/assets</code></td><td class="align_left">ライブラリで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>log/</code></td><td class="align_left">アプリケーションのログファイル</td></tr><tr><td class="align_left"><code>public/</code></td><td class="align_left">エラーページなど、一般(Webブラウザなど)に直接公開するデータ</td></tr><tr><td class="align_left"><code>script/rails</code></td><td class="align_left">コード生成、コンソールの起動、ローカルのWebサーバの立ち上げなどに使用するRailsスクリプト</td></tr><tr><td class="align_left"><code>test/</code></td><td class="align_left">アプリケーションのテスト(<a class="ref" href="./static-pages.html#sec-static_pages_with_rails">3.1.2</a>で作成する<code>spec/</code>ディレクトリがあるため、現在は使用されていません)</td></tr><tr><td class="align_left"><code>tmp/</code></td><td class="align_left">一時ファイル</td></tr><tr><td class="align_left"><code>vendor/</code></td><td class="align_left">サードパーティのプラグインやgemなど</td></tr><tr><td class="align_left"><code>vendor/assets</code></td><td class="align_left">サードパーティのプラグインやgemで使用するCSS (Cascading Style Sheet)、JavaScriptファイル、画像などのアセット</td></tr><tr><td class="align_left"><code>README.rdoc</code></td><td class="align_left">アプリケーションの簡単な説明</td></tr><tr><td class="align_left"><code>Rakefile</code></td><td class="align_left"><code>rake</code>コマンドで使用可能なタスク</td></tr><tr><td class="align_left"><code>Gemfile</code></td><td class="align_left">このアプリケーションに必要なGemの定義ファイル</td></tr><tr><td class="align_left"><code>Gemfile.lock</code></td><td class="align_left">アプリケーションのすべてのコピーが同じgemのバージョンを使用していることを確認するために使用されるgemのリスト</td></tr><tr><td class="align_left"><code>config.ru</code></td><td class="align_left"><a href="http://rack.rubyforge.org/doc/">Rackミドルウェア</a>用の設定ファイル</td></tr><tr><td class="align_left"><code>.gitignore</code></td><td class="align_left">Gitに無視させたいファイルを指定するためのパターン</td></tr></table></div><div class="caption"><span class="header">表1.1: </span> <span class="description">デフォルトのRailsフォルダ構造まとめ。</span></div></div>




<div class="label" id="sec-bundler"></div>


<h3><a id="sec-1_2_4" href="./beginning.html#sec-bundler" class="heading"><span class="number">1.2.4</span> Bundler</a></h3>


<p>Railsアプリケーションを新規作成したら、次は<em>Bundler</em>を実行して、アプリケーションに必要なgemをインストールおよびインクルードします。<a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>でも簡単に説明したように、Bundlerは<code>rails</code>によって自動的に実行 (この場合は<code>bundle install</code>) されます。ここではデフォルトのアプリケーションgemを変更してBundlerを再度実行してみます。そのためにまず、好みのエディタで<code>Gemfile</code>を開きます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>first_app/
<span class="gp">$</span> subl Gemfile</pre></div>
</div>


<p>ファイルの内容は<a class="ref" href="./beginning.html#code-default_gemfile">リスト1.4</a>のようになっているはずです。Gemfileの内容はRubyのコードですが、ここでは文法を気にする必要はありません。Rubyについては<a class="ref" href="./rails-flavored-ruby.html#top">第4章</a>でもっとくわしく説明します。</p>

<div class="label" id="code-default_gemfile"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.4</span> <span class="description"><code>first_app</code>ディレクトリ直下にあるデフォルトの<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.14&#39;</span>

<span class="c1"># Bundle edge Rails instead:</span>
<span class="c1"># gem &#39;rails&#39;, :git =&gt; &#39;git://github.com/rails/rails.git&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>


<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;~&gt; 3.2.3&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.2.2&#39;</span>

  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>

<span class="c1"># To use ActiveModel has_secure_password</span>
<span class="c1"># gem &#39;bcrypt-ruby&#39;, &#39;~&gt; 3.0.0&#39;</span>

<span class="c1"># To use Jbuilder templates for JSON</span>
<span class="c1"># gem &#39;jbuilder&#39;</span>

<span class="c1"># Use unicorn as the web server</span>
<span class="c1"># gem &#39;unicorn&#39;</span>

<span class="c1"># Deploy with Capistrano</span>
<span class="c1"># gem &#39;capistrano&#39;</span>

<span class="c1"># To use debugger</span>
<span class="c1"># gem &#39;ruby-debug19&#39;, :require =&gt; &#39;ruby-debug&#39;</span>
</pre></div>
</div></div>


<p>ほとんどの行はハッシュシンボル <code>#</code>でコメントされています。これらの行では、よく使われているgemとBundlerの文法の例をコメント形式で紹介しています。この時点では、デフォルト以外のgemは使用しません。 デフォルトは、Rails自体のgem、アセットパイプライン関連のいくつかのgem (<a class="ref" href="./filling-in-the-layout.html#sec-the_asset_pipeline">5.2.1</a>)、JQuery JavaScriptライブラリ関連のgem、<a href="http://www.sqlite.org/">SQLiteデータベース</a>へのRubyインターフェイス用gemです。</p>

<p><code>gem</code> コマンドで特定のバージョン番号を指定しない限り、Bundlerは自動的に最新バージョンのgemを取得してインストールしてくれます。残念ながらgemを更新すると小さな問題を起こすことがよくあるので、<a class="ref" href="./beginning.html#code-default_gemfile">リスト1.4</a>からコメントアウト行を除いた<a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>に示したように、このチュートリアルではたいていの場合動作確認済みのバージョン番号を指定しています。</p>

<div class="label" id="code-gemfile_sqlite_version"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.5</span> <span class="description">gemのバージョンを指定した<code>Gemfile</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.14&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
<span class="k">end</span>


<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>

  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>ではJQueryの行を変更しています。JQueryはRailsでデフォルトで使用されるJavaScriptのライブラリです。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>
</pre></div>
</div>


<p>他にも変更を行います。</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>この変更を行うと、Bundlerは<code>sqlite3</code> gemの<code>1.3.5</code>を強制的にインストールします。ここではさらに、SQLiteをdevelopment環境 (<a class="ref" href="./sign-up.html#sec-rails_environments">7.1.1</a>) でのみ使用するための指定も行なっていることに注意してください。こうすることで、Heroku (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) で使用するデータベースソフトウェアと衝突する可能性を避けられます。</p>

<p><a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>では他にもいくつかの変更を行なっています。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;~&gt; 3.2.3&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.2.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.2.3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>以下の構文を実行すると</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.2.3&#39;</span>
</pre></div>
</div>


<p><code>uglifier</code>のバージョンが<code>1.2.3</code>以上であれば最新バージョンのgemがインストールされます。 極端に言えばバージョンが<code>7.2</code>であってもそれが最新ならインストールされます。なお、uglifierはアセットパイプラインでファイル圧縮を行うためのものです。一方、以下のコードを実行すると</p>

<div class="code"><div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.2.2&#39;</span>
</pre></div>
</div>


<p><code>coffee-rails</code> (これもアセットパイプラインで使用するgemです) のバージョンが<code>3.3</code> より小さい場合にインストールします。つまり、<tt class="verb">&gt;=</tt>と書くと必ずアップグレードが行われますが、<tt class="verb">~&gt; 3.2.2</tt>と書くとマイナーなアップグレードしか行われないことになります。この場合<code>3.2.1</code> から<code>3.2.2</code>へのアップグレードは行われますが、<code>3.2</code>から <code>3.3</code>へのアップグレードは行われません。経験上、残念ながらマイナーアップグレードですら問題を引き起こすことがあります。このため、<em>Railsチュートリアル</em>では基本的にすべてのgemでバージョンをピンポイントで指定してます。(例外として、執筆時点でベータ版やRC (Release Candidate) 版のgemについては<tt class="verb">~&gt;</tt>を使用し、最終版がリリースされたときに読み込まれるようにしてあります。) 主にベテラン開発者の方へ: <code>Gemfile</code>で<tt class="verb">~&gt;</tt>が指定されているgemも含め、基本的にはなるべく最新のgemを使用してください。ただし、それによって本書に記載されているのと異なる挙動を示す可能性がある点に注意してください。</p>

<p><code>Gemfile</code>を正しく設定した後、<code>bundle update</code><sup class="footnote" id="fnref-1_14"><a href="./beginning.html#fn-1_14">14</a></sup>と<code>bundle install</code>を使用してgemをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle update
<span class="gp">$</span> bundle install
<span class="go">Fetching source index for https://rubygems.org/</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p>OS Xユーザーの場合、このときに<code>ruby.h</code>などのRubyヘッダファイルがないというエラーが表示されることがあります。その場合はXcodeをインストールしてください。この開発ツールはOS Xのインストーラディスクに含まれていますが、フルインストールするのは大げさなので、サイズの小さい<a href="https://developer.apple.com/downloads/">Command Line Tools for Xcode</a><sup class="footnote" id="fnref-1_15"><a href="./beginning.html#fn-1_15">15</a></sup>だけをインストールすることをお勧めします。Nokogiri gemのインストール中にlibxsltエラーが発生した場合は、以下のようにRubyを再インストールしてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm reinstall 1.9.3
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p><code>bundle install</code>コマンドの実行にはしばらく時間がかかるかもしれません。完了後、アプリケーションが実行可能になります。<em>注: </em>このセットアップ方法は最初のアプリケーションにはよいのですが、理想的な方法ではありません。<a class="ref" href="./static-pages.html#top">第3章</a>ではBundlerを使用してRuby gemをインストールするためのさらに強力で複雑な方法をご紹介します。</p>

<div class="label" id="sec-rails_server"></div>


<h3><a id="sec-1_2_5" href="./beginning.html#sec-rails_server" class="heading"><span class="number">1.2.5</span> <tt>rails server</tt></a></h3>


<p><a class="ref" href="./beginning.html#sec-the_first_application">1.2.3</a>の<code>rails new</code>コマンドと<a class="ref" href="./beginning.html#sec-bundler">1.2.4</a>の<code>bundle install</code>コマンドを実行したおかげで、実際に動かすことのできるアプリケーションが作成されました。うれしいことに、Railsには開発マシンからのみブラウズできる<em>ローカル</em>Webサーバを起動させるためのコマンドラインプログラム (<em>スクリプト</em>) が付属しているので、以下のコマンドを実行するだけで簡単に起動することができます<sup class="footnote" id="fnref-1_16"><a href="./beginning.html#fn-1_16">16</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails server
<span class="go">=&gt; Booting WEBrick</span>
<span class="go">=&gt; Rails application starting on http://0.0.0.0:3000</span>
<span class="go">=&gt; Call with -d to detach</span>
<span class="go">=&gt; Ctrl-C to shutdown server</span>
</pre></div>
</div>


<p>(JavaScriptランタイムがインストールされていないというエラーが表示された場合は、<a href="https://github.com/sstephenson/execjs">GitHubのexecjsページ</a>にあるインストール可能なランタイムを確認してください。<a href="http://nodejs.org/">Node.js</a>が特にお勧めです。) 表示されたメッセージは、RailsアプリケーションがIPaddress<code>0.0.0.0</code>、<a href="http://ja.wikipedia.org/wiki/%E3%83%9D%E3%83%BC%E3%83%88%E7%95%AA%E5%8F%B7">ポート番号</a> 3000<sup class="footnote" id="fnref-1_17"><a href="./beginning.html#fn-1_17">17</a></sup>で動作していることを示しています。このIPアドレスは、このマシンに設定されているすべてのIPアドレスで受信待ち (listen) するように指定しています。これにより、<code>127.0.0.1</code>(<code>localhost</code>)という特別なアドレスでアプリケーションをブラウズできます。<a class="ref" href="./beginning.html#fig-riding_rails_31">図1.3</a>は、<a href="http://localhost:3000/">http://localhost:3000/</a>をブラウザで表示した時の結果です。</p>

<div class="label" id="fig-riding_rails_31"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/riding_rails_31.png" alt="riding_rails_31" /></span></div><div class="caption"><span class="header">図1.3:</span> <span class="description">デフォルトのRailsページ。 <a href="../images/figures/riding_rails_31-full.png">（拡大）</a></span></div></div>


<p>この最初のアプリケーションの情報を見るには、「About your application’s environment」のリンクをクリックしてください。<a class="ref" href="./beginning.html#fig-riding_rails_32_environment">図1.4</a>のような画面が表示されます (<a class="ref" href="./beginning.html#fig-riding_rails_32_environment">図1.4</a>は私の環境でキャプチャしたものなので、これとは若干異なる可能性があります)。</p>

<div class="label" id="fig-riding_rails_32_environment"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/riding_rails_32_environment.png" alt="riding_rails_32_environment" /></span></div><div class="caption"><span class="header">図1.4:</span> <span class="description">アプリケーション環境が表示されているデフォルトページ<a href="../images/figures/riding_rails_32_environment-full.png">（拡大）</a></span></div></div>


<p>もちろん、いずれデフォルトのRailsページは不要になりますが、アプリケーションが動いているのを見るのは気分のいいものです。<a class="ref" href="./filling-in-the-layout.html#sec-rails_routes">5.3.2</a>ではこのデフォルトページを削除し、カスタマイズしたホームページに置き換えます。</p>

<div class="label" id="sec-mvc"></div>


<h3><a id="sec-1_2_6" href="./beginning.html#sec-mvc" class="heading"><span class="number">1.2.6</span> Model-View-Controller (MVC)</a></h3>


<p>まだ始まったばかりですが、今のうちにRailsアプリケーションの全体的な仕組みを知っておくことは後々役立ちます (<a class="ref" href="./beginning.html#fig-MVC">図1.5</a>)。デフォルトのRailsアプリ構造 (<a class="ref" href="./beginning.html#fig-directory_structure_rails_3_2">図1.2</a>) を眺めてみると、<code>app/</code>というディレクトリがあり、その中に「<code>models</code>」「<code>views</code>」「<code>controllers</code>」という3つのサブディレクトリがあることに気付いた方もいると思います。ここにはRailsが<a href="http://ja.wikipedia.org/wiki/Model_View_Controller">MVC (model-view-controller)</a> というアーキテクチャパターンを採用していることが暗に示されています。MVCでは、ドメインロジック (ビジネスロジックともいいます) と、グラフィカルユーザーインターフェース (GUI) と密に関連する入力/表示ロジックを分離します。Webアプリケーションの場合、「ドメインロジック」はユーザーや記事、商品などのデータモデルに相当し、ユーザーインターフェースはWebページを指します。</p>

<p>Railsアプリと通信する際、ブラウザは一般的にWebサーバに<em>request</em> (リクエスト) を送信し、これはリクエストを処理する役割を担っているRailsの<em>controller</em> (コントローラ) に渡されます。 コントローラは、場合によってはすぐに<em>view</em> (ビュー) を生成してHTMLをブラウザに送り返します。動的なサイトでは、一般にコントローラは (ユーザーなどの) サイトの要素を表しており、データベースとの通信を担当しているRubyのオブジェクトである<em>model</em> (モデル) と対話します。モデルを呼び出した後、コントローラは、ビューをレンダリングし、完成したWebページをHTMLとしてブラウザに返します。</p>

<div class="label" id="fig-MVC"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/mvc_schematic.png" alt="mvc_schematic" /></span></div><div class="caption"><span class="header">図1.5: </span> <span class="description">model-view-controller (MVC) アーキテクチャの概念図。</span></div></div>


<p>今はまだこの解説が少し抽象的に思えるかもしれませんが、この章は後に何度も参照する事になるのでご安心ください。さらに、 <a class="ref" href="./a-demo-app.html#sec-mvc_in_action">2.2.2</a>のデモアプリケーションの説明の中で、MVCについてもっと詳しく解説します。サンプルアプリケーションでは、MVCの3つの要素をすべて使用します。<a class="ref" href="./static-pages.html#sec-static_pages_with_rails">3.1.2</a>ではまずコントローラとビューを使用し、モデルは<a class="ref" href="./modeling-users.html#sec-user_model">6.1</a>から使い始めます。 <a class="ref" href="./sign-up.html#sec-a_users_resource">7.1.2</a>では3つの要素が協調して動作します。</p>

<div class="label" id="sec-version_control"></div>


<h2><a id="sec-1_3" href="./beginning.html#sec-version_control" class="heading"><span class="number">1.3</span> Gitによるバージョン管理</a></h2>


<p>新しく動作するRailsアプリが完成したところで、さっそくアプリケーションのソースコードを<em>バージョン管理</em>下に置きましょう。これを行わないとアプリケーションが動かないということではありませんが、ほとんどのRails開発者はバージョン管理は開発現場において必要不可欠であると考えています。バージョン管理システムを導入しておけば、プロジェクトのコードの履歴を追ったり、うっかり削除してしまったファイルを復旧 (ロールバック) したりという作業が行えるようになります。バージョン管理システムを熟知することは、今やあらゆるソフトウェア開発者にとって必須のスキルであると言ってよいでしょう。</p>

<p>バージョン管理システムにもさまざまなものがありますが、RailsコミュニティではLinuxカーネル用にLinus Torvaldsにより開発された分散バージョン管理システムである<a href="http://git-scm.com/">Git</a>が主流になっています。Git (というよりバージョン管理) はそれだけで大きなテーマなので、すべてを説明しようとすると軽く一冊の本を超えてしまいます。本書では簡単に言及するにとどめますが、幸いネット上には無償で利用できるリソースがあふれています。その中でも特に「<a href="http://progit.org"><em>Pro Git</em></a>」Scott Chacon (Apress, 2009) をお勧めいたします (訳注: Pro Gitには素晴らしい<a href="http://git-scm.com/book/ja/">日本語版</a>があります)。ソースコードのバージョン管理は<em>何としても</em>導入してください。バージョン管理はRailsを使用するどんな場面でも必要になりますし、バージョン管理システムを応用して、自分の作成したコードを他の開発者と簡単に共有したり <a class="ref" href="./beginning.html#sec-github">1.3.4</a>)、最初の章で作成したアプリケーションを本番サーバーへデプロイしたりすることもできる (<a class="ref" href="./beginning.html#sec-deploying">1.4</a>) からです。</p>

<div class="label" id="sec-git_setup"></div>


<h3><a id="sec-1_3_1" href="./beginning.html#sec-git_setup" class="heading"><span class="number">1.3.1</span>インストールとセットアップ</a></h3>


<p>Gitがインストールされていない場合は、まず<a class="ref" href="./beginning.html#sec-install_git">1.2.2.2</a>に従ってGitをインストールしてください (リンク先の節でも述べているように、<a href="http://git-scm.com/book/ja/%E4%BD%BF%E3%81%84%E5%A7%8B%E3%82%81%E3%82%8B-Git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><em>Pro Git</em>の「Gitのインストール</a>」の記載に従うことになります)。</p>

<h4><a id="sec-1_3_1_1" href="./beginning.html#sec-1_3_1_1" class="heading">最初のシステムセットアップ</a></h4>


<p>Gitのインストール後、最初に1回だけ行う必要のある設定があります。これは<em>system</em>セットアップと呼ばれ、使用するコンピュータ1台につき1回だけ行います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global user.name <span class="s2">&quot;あなたの名前&quot;</span>
<span class="gp">$</span> git config --global user.email your.email@example.com
</pre></div>
</div>


<p>私の場合、<code>checkout</code> という長ったらしいコマンドの代わりに<code>co</code>という短いコマンド (エイリアス) も使えるようにしています。これを行うには以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global alias.co checkout
</pre></div>
</div>


<p>本書では、<code>co</code>エイリアスを設定していないシステムでも動作するようにフルスペルの<code>checkout</code>を使用していますが、私自身は実際の開発ではほとんどいつも<code>git co</code>を使ってプロジェクトをチェックアウトしています。</p>

<p>手順の最後として、Gitのコミットメッセージを入力するときに使用するエディタを設定できます。Sublime Text、TextMate、gVim、MacVimなどのGUIエディタを使用する場合、シェルから離れずシェル内で起動するようフラグを付けてください<sup class="footnote" id="fnref-1_18"><a href="./beginning.html#fn-1_18">18</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git config --global core.editor <span class="s2">&quot;subl -w&quot;</span>
</pre></div>
</div>


<p><code>&quot;subl -w&quot;</code> の部分は、TextMateの場合は <code>&quot;mate -w&quot;</code>、gVimの場合は<code>&quot;gvim -f&quot;</code>、MacVimの場合は<code>&quot;mvim -f&quot;</code> にそれぞれ置き換えます。</p>

<h4><a id="sec-1_3_1_2" href="./beginning.html#sec-1_3_1_2" class="heading">最初のリポジトリセットアップ</a></h4>


<p>今度は、<em>レポジトリ</em>を作成するたびに必要な作業を行います。まず、Railsアプリケーションのルートディレクトリに移動し、新しいリポジトリの初期化を行います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="go">Initialized empty Git repository in /Users/mhartl/rails_projects/first_app/.git/</span>
</pre></div>
</div>


<p>次に、プロジェクトのファイルをリポジトリに追加します。ここで１つ問題点があります。Gitは<em>すべての</em>ファイルの変更履歴を管理するようになっていますが、管理対象に含めたくないファイルもあります。たとえば、Railsによって作成されるログファイルは頻繁に内容が変わるので、いちいちバージョン管理に更新させたくありません。Gitにはこういったファイルを管理対象から除外する機能があります。<code>.gitignore</code>というファイルをアプリケーションのルートディレクトリに置き、除外したいファイルを指定するためのルールをそこに記載します。<sup class="footnote" id="fnref-1_19"><a href="./beginning.html#fn-1_19">19</a></sup></p>

<p><a class="ref" href="./beginning.html#table-rails_directory_structure">表1.1</a>をもう一度見てみると、<code>rails</code>コマンドを実行した時にRailsアプリケーションのルートディレクトリに<code>.gitignore</code>ファイルが作成されています (<a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>)。</p>

<div class="label" id="code-default_gitignore"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.6</span> <span class="description"><code>rails</code>コマンドで作成されるデフォルトの<code>.gitignore</code>ファイルの内容。</span> </div>
<div class="code"><div class="highlight"><pre># See http://help.github.com/ignore-files/ for more about ignoring files.
#
# If you find yourself ignoring temporary files generated by your text editor
# or operating system, you probably want to add a global ignore instead:
#   git config --global core.excludesfile ~/.gitignore_global

# Ignore bundler config
/.bundle

# Ignore the default SQLite database.
/db/*.sqlite3

# Ignore all logfiles and tempfiles.
/log/*.log
/tmp
</pre></div>
</div></div>


<p><a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>の設定では、ログファイル、Railsの一時ファイル (<code>tmp</code>)、SQLiteデータベースなどが除外されます。(<code>log/</code>ディレクトリ以下のログファイルを除外したい場合は、<code>log/*.log</code>と指定することで、ファイル名が<code>.log</code>で終わるファイルが除外されます。これらのファイルは頻繁に更新されるため、バージョン管理に含めるのは何かと不便です。さらに、他の開発者と共同作業を行う場合にこのようなファイルをバージョン管理に含めると無用な衝突 (conflict) が発生し、関係者一同が無駄にいらいらすることになりかねません。</p>

<p>本書のチュートリアルでは、<a class="ref" href="./beginning.html#code-default_gitignore">リスト1.6</a>の<code>.gitignore</code>設定で十分です。システム環境によっては、<a class="ref" href="./beginning.html#code-gitignore">リスト1.7</a>のように設定するとさらに便利になることがあります。この<code>.gitignore</code>では、Railsドキュメントファイル、VimやEmacsのスワップファイル、そしてOS Xユーザーにはお馴染みの、あのいまいましい<code>.DS_Store</code>ディレクトリ (MacのFinder操作で作成される隠しディレクトリ) も管理対象から除外されます。この拡張版除外設定を使用したい場合は、<code>.gitignore</code>を好みのテキストエディタで開き、<a class="ref" href="./beginning.html#code-gitignore">リスト1.7</a>の内容で置き換えます。</p>

<div class="label" id="code-gitignore"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.7</span> <span class="description">より多くのパターンを除外する<code>.gitignore</code>ファイル。</span> </div>
<div class="code"><div class="highlight"><pre># Ignore bundler config
/.bundle

# Ignore the default SQLite database.
/db/*.sqlite3

# Ignore all logfiles and tempfiles.
/log/*.log
/tmp

# Ignore other unneeded files.
doc/
*.swp
*~
.project
.DS_Store
.idea
</pre></div>
</div></div>




<div class="label" id="sec-adding_and_committing"></div>


<h3><a id="sec-1_3_2" href="./beginning.html#sec-adding_and_committing" class="heading"><span class="number">1.3.2</span>追加とコミット</a></h3>


<p>最後に、新しく作成したRailsプロジェクトのファイルをGitに追加し、次にそれをコミットします。ファイルを追加する (<code>.gitignore</code>で指定されているものを除く) には、以下のコマンドを実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
</pre></div>
</div>


<p>ここで「<code>.</code>」は現在のディレクトリ (カレントディレクトリ) を指します。Gitは<em>再帰的に</em>ファイルを追加できるので、自動的にすべてのサブディレクトリも追加されます。このコマンドによりプロジェクトのファイルは、コミット待ちの変更が格納されている「<em>ステージングエリア</em>」という一種の待機場所に追加されます。ステージングエリアにあるファイルのリストを表示するには、<code>status</code>コマンドを実行します<sup class="footnote" id="fnref-1_20"><a href="./beginning.html#fn-1_20">20</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span>
<span class="gp">#</span> Initial commit
<span class="gp">#</span>
<span class="gp">#</span> Changes to be committed:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       new file:   README.rdoc
<span class="gp">#</span>       new file:   Rakefile
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p>（出力結果が長いので、省略された部分を示すために縦点を使っています。）</p>

<p>変更を保存するには、<code>commit</code>コマンドを使います。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
<span class="go">[master (root-commit) df0a62f] Initial commit</span>
<span class="go">42 files changed, 8461 insertions(+), 0 deletions(-)</span>
<span class="go">create mode 100644 README.rdoc</span>
<span class="go">create mode 100644 Rakefile</span>
<span class="go">.</span>
<span class="go">.</span>
<span class="go">.</span>
</pre></div>
</div>


<p><code>-m</code>フラグは、コミットメッセージ (コミット内容の覚書) をその場で追加する場合に使用します。<code>-m</code>を省略した場合、<a class="ref" href="./beginning.html#sec-git_setup">1.3.1</a>で設定されたエディタが起動され、コミットメッセージの入力を求められます。</p>

<p>ここでコミットについて少し解説しておきます。Gitにおけるコミットは、あくまで<em>ローカル</em>マシン上での操作であることに注意してください。この点について、もう一つの有名なオープンソースバージョン管理システムであるSubversionとははっきり異なります。Gitの場合、コミットを実行してもリモート上にあるリポジトリを直接変更することはありません。Gitでは、ローカルでの変更保存 (<code>git commit</code>) と、リモート上のリポジトリへの変更反映 (<code>git push</code>) の2段階に分かれています。<a class="ref" href="./beginning.html#sec-git_commands">1.3.5</a>にはこのpushの例が記載されています。</p>

<p>ちなみに、<code>log</code>コマンドでコミットメッセージの履歴を参照できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git log
<span class="go">commit df0a62f3f091e53ffa799309b3e32c27b0b38eb4</span>
<span class="go">Author: Michael Hartl &lt;michael@michaelhartl.com&gt;</span>
<span class="go">Date:   Thu Oct 15 11:36:21 2009 -0700</span>

<span class="go">  Initial commit</span>
</pre></div>
</div>


<p><code>git log</code>を終了するには<code>q</code>キーを押してください。</p>

<h3><a id="sec-1_3_3" href="./beginning.html#sec-1_3_3" class="heading"><span class="number">1.3.3</span>Gitのメリット</a></h3>


<p>今の時点では、ソースコードをバージョン管理下に置かなければならない理由が今ひとつよくわからないという方がいるかもしれませんので、例を１つ紹介します (この後の章でも多くの実例を紹介します)。仮に、あなたが重要な<code>app/controllers/</code>ディレクトリを削除してしまったとしましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/controllers/
<span class="go">application_controller.rb</span>
<span class="gp">$</span> rm -rf app/controllers/
<span class="gp">$</span> ls app/controllers/
<span class="go">ls: app/controllers/: No such file or directory</span>
</pre></div>
</div>


<p>ここでは、Unixコマンドの<code>ls</code>で<code>app/controllers/</code>ディレクトリの中身を表示した後、<code>rm</code>コマンドをうっかり実行してこのディレクトリを削除してしまいました。<code>-rf</code>フラグは、「recursive」(サブディレクトリやその中のファイルもすべて削除する)、「 force」(削除して良いかどうかをユーザーに確認しない) を指定するオプションです。</p>

<p>現在の状態を確認してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="gp">#</span> Changed but not updated:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git add/rm &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       deleted:    app/controllers/application_controller.rb
<span class="gp">#</span>
<span class="go">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span>
</pre></div>
</div>


<p>ファイルがいくつか削除されましたが、この変更が行われたのは現在の「作業ツリー」内のみなので、まだコミット (保存) されていません。つまり、以前のコミットを<code>checkout</code>コマンド (と、現在までの変更を強制的に上書きして元に戻すための<code>-f</code>フラグ) でチェックアウトすれば、簡単に削除前の状態に戻すことができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -f
<span class="gp">$</span> git status
<span class="gp">#</span> On branch master
<span class="go">nothing to commit (working directory clean)</span>
<span class="gp">$</span> ls app/controllers/
<span class="go">application_controller.rb</span>
</pre></div>
</div>


<p>削除されたディレクトリとファイルが無事復旧しました。これでひと安心です。</p>

<div class="label" id="sec-github"></div>


<h3><a id="sec-1_3_4" href="./beginning.html#sec-github" class="heading"><span class="number">1.3.4</span>GitHub</a></h3>


<p>Gitを使用してプロジェクトをバージョン管理下に置くことができたので、今度は<a href="http://github.com">GitHub</a>にソースコードをアップロードしてみましょう。GitHubは、Gitリポジトリの置き場所を提供したり (ホスティング)、リポジトリを開発者同士で共有するサービスを提供するWebサービスとして有名です。GitHubにわざわざリポジトリをプッシュするのには2つの理由があります。１つ目は、ソースコード (とそのすべての変更履歴) の完全なバックアップを作成することです。２つ目は、他の開発者との共同作業をより簡単に行うことです。GitHubへのプッシュは必須ではありませんが、GitHubのメンバーになっておくと、多くのオープンソースプロジェクトに参加できるようになります。</p>

<div class="label" id="fig-create_first_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/create_first_repository_new.png" alt="create_first_repository_new" /></span></div><div class="caption"><span class="header">図1.6: </span><span class="description">アカウント作成直後のGitHubページ。<a href="../images/figures/create_first_repository_new-full.png">(拡大)</a></span></div></div>


<p>GitHubにはさまざまな有料プランがありますが、オープンソースのコードなら無料で利用できるので、初めて利用するのであれば<a href="https://github.com/signup/free">無料のGitHubアカウント</a>を作成しましょう (念のため、<a href="http://help.github.com/key-setup-redirect">GitHubのSSHキー作成方法のチュートリアル</a>を先に読んでおいてください)。 アカウント作成後、[<a href="http://github.com/new">Create repository</a>]をクリックし、<a class="ref" href="./beginning.html#fig-create_first_repository">図1.6</a>に従ってフォームに記入します。(注意: このときに<code>README</code>ファイルを使用してリポジトリを初期化<em>しないでください</em> 。<code>rails new</code>コマンドを実行するときにこれらのファイルが作成されるからです。) リポジトリを作成したら、以下を実行してアプリケーションをプッシュします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/first_app.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>


<p>最初のコマンドは、現在のメイン (<em>master</em>) ブランチ用の &quot;origin&quot; としてGitHubに追加します。次のコマンドで実際に GitHubにプッシュします （<tt>-u</tt>フラグについては気にする必要はありません。気になるのであれば &quot;git set upstream&quot;で検索してみてください）。もちろん、<tt class="verb">&lt;username&gt;</tt>はあなたの名前に置き換えてください。たとえば、私が<code>railstutorial</code>用に実行したコマンドは以下のとおりです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:railstutorial/first_app.git
</pre></div>
</div>


<p>このコマンドを実行すると、GitHubにファイル閲覧、コミット履歴の表示など多数の機能を備えたアプリケーションのリポジトリ用のページが作成されました (<a class="ref" href="./beginning.html#fig-github_repository_page">図1.7</a>)。</p>

<div class="label" id="fig-github_repository_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/github_repository_page.png" alt="github_repository_page" /></span></div><div class="caption"><span class="header">図1.7: </span><span class="description">GitHubのリポジトリページ。<a href="../images/figures/github_repository_page-full.png">(拡大)</a></span></div></div>


<p>なお、GitHubにはコマンドラインインターフェイスを拡張したGUIアプリケーションもあります。 GUIアプリケーションの方が好みであれば、<a href="http://windows.github.com/">GitHub for Windows</a>や<a href="http://mac.github.com/">GitHub for Mac</a>をチェックしてみてください  (Linux用のGitHubは今のところGitしかないようです)。</p>

<div class="label" id="sec-git_commands"></div>


<h3><a id="sec-1_3_5" href="./beginning.html#sec-git_commands" class="heading"><span class="number">1.3.5</span>ブランチ (branch)、変更 (edit)、 コミット (commit)、マージ (merge)</a></h3>


<p><a class="ref" href="./beginning.html#sec-github">1.3.4</a>,で紹介した手順を踏んでいれば、GitHubは自動的にリポジトリのメインページに<code>README</code>ファイルの内容を表示している事に気付くかもしれません。このチュートリアルでは、プロジェクトは<code>rails</code>コマンドによって作成されたRailsアプリケーションなので、<code>README</code>ファイルはRailsに既に含まれています (<a class="ref" href="./beginning.html#fig-rails_readme">図1.8</a>)。<code>README</code>ファイルの拡張子は<code>.rdoc</code>になっているので、GitHubでは適切なフォーマットで表示されます。しかしその内容はRailsフレームワークそのものに関するもので、そのままでは役に立ちません。この節ではREADMEの内容を編集し、プロジェクトに関する記述に置き換えます。それと同時に、Gitでbranch、edit、commit、mergeを行う際に私がお勧めしたいワークフローの実例をお見せします。</p>

<div class="label" id="fig-rails_readme"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/rails_readme_3_2.png" alt="rails_readme_3_2" /></span></div><div class="caption"><span class="header">図1.8: </span><span class="description">GitHub上の、役に立たない初期の<code>README</code>ファイル<a href="../images/figures/rails_readme_3_2-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-git_branch"></div>


<h4><a id="sec-1_3_5_1" href="./beginning.html#sec-git_branch" class="heading">ブランチ (branch)</a></h4>


<p>Gitは、ブランチ (<em>branch</em>) を極めて簡単かつ高速に作成することができます。ブランチは基本的にはリポジトリのコピーで、ブランチ上では元のファイルを触らずに新しいコードを書くなど、自由に変更や実験を試すことができます。通常、親リポジトリは<em>マスター</em>ブランチと呼ばれ、トピックブランチ (短期間だけ使う一時的なブランチ) は<code>checkout</code>と<code>-b</code>フラグを使って作成できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b modify-README
<span class="go">Switched to a new branch &#39;modify-README&#39;</span>
<span class="gp">$</span> git branch
<span class="go">master</span>
<span class="go">* modify-README</span>
</pre></div>
</div>


<p>2つ目のコマンド (<code>git branch</code>) は、単にすべてのローカルブランチを一覧表示しているだけです。「<code>*</code>」はそのブランチが現在使用中であることを表します。1番目の<code>git checkout -b modify-README</code>コマンドで、ブランチの新規作成とそのブランチへの切り替えが同時に行われていることに注目してください。<code>modify-README</code>ブランチに*が付いていることで、このブランチが現在使用中であることが示されています (<a class="ref" href="./beginning.html#sec-version_control">1.3</a>で<code>co</code>エイリアスを設定した場合は、<code>git co -b modify-README</code>と入力することもできます)。</p>

<p>ブランチの真価は他の開発者と共同で作業する時に発揮されますが<sup class="footnote" id="fnref-1_21"><a href="./beginning.html#fn-1_21">21</a></sup>、このチュートリアルのように一人で作業する時にも役立ちます。マスターブランチはトピックブランチで行った変更に影響されないので、たとえブランチ上のコードが<em>めちゃくちゃ</em>になってしまっても、マスターブランチをチェックアウトしてトピックブランチを削除すれば、いつでも変更を破棄する事ができます。具体的な方法についてはこの章の最後で説明します。</p>

<p>ちなみに、通常このような小さな変更のためにわざわざブランチを作成する必要はありませんが、ブランチがよい習慣であることに変わりはないので、少しでも練習しておきましょう。</p>

<div class="label" id="sec-git_edit"></div>


<h4><a id="sec-1_3_5_2" href="./beginning.html#sec-git_edit" class="heading">変更 (Edit)</a></h4>


<p>トピックブランチを作成後、READMEの内容をわかりやすく書き換えてみましょう。私の場合、デフォルトのRDocを編集するときには主に<a href="http://daringfireball.net/projects/markdown/">Markdown</a>というマークアップ言語を使用しています。拡張子を<code>.md</code>にしておけば、GitHubにアップロードしたときに自動的にドキュメントがきれいに整形されます。今回はGitに付属する<code>mv</code>コマンド (注: Unixのmvコマンドではありません!) を使ってREADMEの拡張子を変更し、それからREADMEの内容を<a class="ref" href="./beginning.html#code-new_readme">リスト1.8</a>の内容に書き換えます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README.rdoc README.md
<span class="gp">$</span> subl README.md
</pre></div>
</div>


<div class="label" id="code-new_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.8</span> <span class="description">新しい<code>README</code>ファイル (<code>README.md</code>)。</span> </div>
<div class="code"><div class="highlight"><pre># Ruby on Rails チュートリアル：サンプルアプリケーション

これは以下で使用する最初のアプリケーションです。
[*Ruby on Rails Tutorial: Learn Rails by Example*](http://railstutorial.jp/)
by [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>




<div class="label" id="sec-git_commit"></div>


<h4><a id="sec-1_3_5_3" href="./beginning.html#sec-git_commit" class="heading">コミット (commit)</a></h4>


<p>変更が終わったら、ブランチの状態を確認してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git status
<span class="gp">#</span> On branch modify-README
<span class="gp">#</span> Changes to be committed:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       renamed:    README.rdoc -&gt; README.md
<span class="gp">#</span>
<span class="gp">#</span> Changed but not updated:
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
<span class="gp">#</span>   <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
<span class="gp">#</span>
<span class="gp">#</span>       modified:   README.md
<span class="gp">#</span>
</pre></div>
</div>


<p>この時点で、<a class="ref" href="./beginning.html#sec-adding_and_committing">1.3.2</a>のように<code>git add .</code>を実行することもできますが、Gitには現存するすべてのファイル (git mvで作成したファイルも含む) への変更を一括でコミットする<code>-a</code>フラグがあります。このフラグは非常によく使われます。なお、<code>git mv</code>で作成されたファイルは、Gitでは新規ファイルではなく変更として扱われます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git commit -a -m <span class="s2">&quot;Improve the README file&quot;</span>
<span class="go">2 files changed, 5 insertions(+), 243 deletions(-)</span>
<span class="go">delete mode 100644 README.rdoc</span>
<span class="go">create mode 100644 README.md</span>
</pre></div>
</div>


<p><code>-a</code>フラグは慎重に扱ってください。最後のコミット後に新しいファイルを追加した場合は、まず<code>git add</code>を実行してバージョン管理下に置く必要があります。</p>

<p>コミットメッセージは<em>現在形</em>で書くようにしましょう。Gitのモデルは、(単一のパッチではなく) 一連のパッチとしてコミットされます。そのため、コミットメッセージを書くときには、そのコミットが「何をしたのか」と履歴スタイルで書くよりも「何を<em>する</em>」ためのものなのかを書く方が、後から見返したときにわかりやすくなります。さらに、現在形で書いておけば、Gitコマンド自身によって生成されるコミットメッセージとも時制が整合します。詳細についてはGitHubに投稿された「<a href="https://github.com/blog/926-shiny-new-commit-styles">最新のコミット方法</a> (英語)」を参照してください。</p>

<div class="label" id="sec-git_merge"></div>


<h4><a id="sec-1_3_5_4" href="./beginning.html#sec-git_merge" class="heading">マージ (merge)</a></h4>


<p>ファイルの変更が終わったので、マスターブランチにこの変更を<em>マージ (merge)</em> します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="go">Switched to branch &#39;master&#39;</span>
<span class="gp">$</span> git merge modify-README
<span class="go">Updating 34f06b7..2c92bef</span>
<span class="go">Fast forward</span>
<span class="go">README.rdoc     |  243 --------------------------------------------------</span>
<span class="go">README.md       |    5 +</span>
<span class="go">2 files changed, 5 insertions(+), 243 deletions(-)</span>
<span class="go">delete mode 100644 README.rdoc</span>
<span class="go">create mode 100644 README.md</span>
</pre></div>
</div>


<p>Gitの出力には<code>34f06b7</code>のような文字列が含まれていることがあります。Gitはこれらをリポジトリの内部処理に使用しています。この文字列は環境の違いにより上記のものと少し異なるかもしれませんが、他の部分はほぼ同じはずです。</p>

<p>変更をマージした後は、<code>git branch -d</code>を実行してトピックブランチを削除すれば終わりです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git branch -d modify-README
<span class="go">Deleted branch modify-README (was 2c92bef).</span>
</pre></div>
</div>


<p>トピックブランチの削除は必須ではありません。実際、トピックブランチを削除せずにそのままにしておくことはよく行われています。トピックブランチを削除せずに残しておけば、トピックブランチとマスターブランチを交互に行き来して、きりの良い所で変更をマージする事ができます。</p>

<p>上で述べたように、<code>git branch -D</code>でトピックブランチ上の変更を破棄することもできます。</p>

<div class="code"><div class="highlight"><pre><span class="c"># これはあくまで例です。ブランチでミスをした時以外は実行しないでください。</span>
<span class="nv">$ </span>git checkout -b topic-branch
<span class="nv">$ </span>&lt;really screw up the branch&gt;
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -a -m <span class="s2">&quot;Major screw up&quot;</span>
<span class="nv">$ </span>git checkout master
<span class="nv">$ </span>git branch -D topic-branch
</pre></div>
</div>


<p><code>-d</code>フラグと異なり、<code>-D</code>フラグは変更をマージしていなくてもブランチを削除してくれます。</p>

<div class="label" id="sec-git_push"></div>


<h4><a id="sec-1_3_5_5" href="./beginning.html#sec-git_push" class="heading">プッシュ (push)</a></h4>


<p><code>README</code>ファイルの更新が終わったので、GitHubに変更をプッシュして結果を見てみましょう。既に<a class="ref" href="./beginning.html#sec-github">1.3.4</a>で一度プッシュを行ったので、大抵のシステムでは<code>git push</code>を実行するときに<code>origin master</code>を省略できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>先ほど説明したとおり、Markdownで記述された新しいファイルはGitHubできれいにフォーマットされます (<a class="ref" href="./beginning.html#fig-new_readme">図1.9</a>)。</p>

<div class="label" id="fig-new_readme"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/new_readme.png" alt="new_readme" /></span></div><div class="caption"><span class="header">図1.9:</span> <span class="description">Markdownを使用してフォーマットされた改良版<code>README</code>ファイル。<a href="../images/figures/new_readme-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-deploying"></div>


<h2><a id="sec-1_4" href="./beginning.html#sec-deploying" class="heading"><span class="number">1.4</span>デプロイする</a></h2>


<p>この段階では空っぽのRailsアプリケーションしかありませんが、本番環境にデプロイしてしまいましょう。アプリケーションのデプロイは必須ではありませんが、頻繁にデプロイすることによって、開発サイクルでの問題を早い段階で見つけることができます。開発環境のテストを繰り返すばかりで、いつまでも本番環境にデプロイしないままだと、アプリケーションを公開する時に思わぬ事態に遭遇する可能性が高まります<sup class="footnote" id="fnref-1_22"><a href="./beginning.html#fn-1_22">22</a></sup>。</p>

<p>かつてはRailsアプリのデプロイは大変な作業でしたが、ここ数年急速に簡単になってきており、さまざまな本番環境を選択できるようになりました。<a href="http://www.modrails.com/">Phusion Passenger</a> (ApacheやNginx<sup class="footnote" id="fnref-1_23"><a href="./beginning.html#fn-1_23">23</a></sup>Webサーバ用のモジュール) を実行できるさまざまな共有ホストや仮想プライベートサーバ (VPS) の他に、フルサービスホスティングを提供する<a href="http://engineyard.com/">Engine Yard</a>や<a href="http://railsmachine.com/">Rails Machine</a>、クラウドサービスを提供する<a href="http://cloud.engineyard.com">Engine Yard Cloud</a>や<a href="http://heroku.com/">Heroku</a>などがあります。</p>

<p>私のお気に入りはHerokuで、Railsを含むRuby Webアプリ用のホスティングプラットフォームです<sup class="footnote" id="fnref-1_24"><a href="./beginning.html#fn-1_24">24</a></sup>。Herokuは、ソースコードのバージョン管理にGitを使用していれば、Railsアプリケーションを簡単に本番環境にデプロイできます (Gitを導入したのは、まさにこのHerokuで使うためでもあります。まだGitをインストールしていなければ、<a class="ref" href="./beginning.html#sec-version_control">1.3</a>を参照してください)。この章では、私たちの最初のアプリケーションをHerokuにデプロイします。</p>

<div class="label" id="sec-heroku_setup"></div>


<h3><a id="sec-1_4_1" href="./beginning.html#sec-heroku_setup" class="heading"><span class="number">1.4.1</span> Herokuのセットアップ</a></h3>


<p>Herokuでは<a href="http://www.postgresql.org/">PostgreSQL</a>データベースを使用します (ちなみに発音は “post-gres-cue-ell” で、よく“Postgres”と略されます)。そのためには、production (本番) 環境に<tt>pg</tt> gemをインストールしてRailsがPostgreSQLと通信できるようにします。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>上のコードを<a class="ref" href="./beginning.html#code-gemfile_sqlite_version">リスト1.5</a>の<code>Gemfile</code>に追加すると、<a class="ref" href="./beginning.html#code-gemfile_pg_gem">リスト1.9</a>のようになります。</p>

<div class="label" id="code-gemfile_pg_gem"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.9</span> <span class="description">PostgreSQL用の<tt>pg</tt> gemを追加した <code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.14&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
<span class="k">end</span>


<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>

  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>インストールの際には、<code>bundle install</code>に特殊なフラグを追加します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install --without production
</pre></div>
</div>


<p><tt class="verb">--without production</tt>オプションを追加すると、 production用のgem (この場合は<tt>pg</tt>のみ) はローカルの環境にはインストールされません。(今回追加したgemは本番環境でしか使用できないように制限されているので、このコマンドを実行しても、ローカルgemはローカルの環境にインストールされません。ただし<code>Gemfile.lock</code>については、Herokuがこれを使用して本番環境のRailsアプリケーションで必要なgemを推測するため、更新しておく必要があります。)</p>

<p>次にHerokuのアカウントを新規作成して設定します。最初に<a href="http://api.heroku.com/signup">Herokuのユーザー登録</a>を行います。アカウント作成後に完了通知メールが届いたら、<a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a>を使用して必要なHerokuソフトウェアをインストールします<sup class="footnote" id="fnref-1_25"><a href="./beginning.html#fn-1_25">25</a></sup>。次にターミナルで以下の<code>heroku</code>コマンドを実行します (実行前にターミナルの終了と再起動が必要なことがあります)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku login
</pre></div>
</div>


<p>最後に、元のRailsプロジェクトディレクトリに移動し、<code>heroku</code>コマンドを実行して、Herokuサーバー上にサンプルアプリケーション用の場所を作成します (<a class="ref" href="./beginning.html#code-heroku_create">リスト1.10</a>)。</p>

<div class="label" id="code-heroku_create"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト1.10</span> <span class="description">Herokuに新しいアプリケーションを作成する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects/first_app
<span class="gp">$</span> heroku addons:add heroku-postgresql
<span class="nb"># 訳注: ↑Heroku上の更新により、PostgreSQLの使用を明示的に示す必要があります。</span>
<span class="nb"># 詳細: https://devcenter.heroku.com/articles/pre-provision-database</span>
<span class="gp">$</span> heroku create
<span class="go">Created http://stormy-cloud-5881.herokuapp.com/ |</span>
<span class="go">git@heroku.com:stormy-cloud-5881.herokuapp.com</span>
<span class="go">Git remote heroku added</span>
</pre></div>
</div></div>


<p>この<code>heroku</code>コマンドを実行すると、私たちのRailsアプリケーション専用のサブドメインが作成され、ただちにブラウザで表示可能になります。今はまだ何もありませんが、すぐにデプロイしてWebページを表示させましょう。</p>

<div class="label" id="sec-heroku_step_one"></div>


<h3><a id="sec-1_4_2" href="./beginning.html#sec-heroku_step_one" class="heading"><span class="number">1.4.2</span> Herokuにデプロイする (1)</a></h3>


<p>Railsアプリケーションを実際にHerokuにデプロイするには、まずGitを使用してHerokuにリポジトリをプッシュします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku master
</pre></div>
</div>


<h3><a id="sec-1_4_3" href="./beginning.html#sec-1_4_3" class="heading"><span class="number">1.4.3</span> Herokuにデプロイする (2)</a></h3>


<p>失礼、その2はありません。これで終わりです (<a class="ref" href="./beginning.html#fig-heroku_app_31">図1.10</a>)。デプロイされたアプリケーションの表示は、<code>heroku create</code> (<a class="ref" href="./beginning.html#code-heroku_create">リスト1.10</a>) を実行した際に生成されたアドレスをブラウザで開くだけです (もちろんここに出てくる私のアドレスではなく、あなたのアドレスを使ってください)。<code>heroku</code>コマンドに以下の引数を与えるだけで、正しいアドレスでブラウザが起動します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>なお、設定の関係で、&quot;About your application’s environment” リンクはHeroku上ではリンク切れになります。これは正常です。<a class="ref" href="./filling-in-the-layout.html#sec-rails_routes">5.3.2</a>ではこのデフォルトのRailsページは削除されるので、完全なサンプルアプリケーションではこのエラーは消え去ります。</p>

<div class="label" id="fig-heroku_app_31"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/heroku_app_31.png" alt="heroku_app_31" /></span></div><div class="caption"><span class="header">図1.10: </span><span class="description">Heroku上で動作しているRailsチュートリアルの最初のアプリケーション。<a href="../images/figures/heroku_app_31-full.png">(拡大)</a></span></div></div>


<p>Herokuへのデプロイが完了した後は、アプリケーションの管理と設定にこんな美しいユーザーインターフェースを使用できます (<a class="ref" href="./beginning.html#fig-heroku_info">図1.11</a>)。</p>

<div class="label" id="fig-heroku_info"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="../images/figures/heroku_info.png" alt="heroku_info" /></span></div><div class="caption"><span class="header">図1.11: </span><span class="description">美しいHerokuのインターフェイス。<a href="../images/figures/heroku_info-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-heroku_commands"></div>


<h3><a id="sec-1_4_4" href="./beginning.html#sec-heroku_commands" class="heading"><span class="number">1.4.4</span>Herokuコマンド</a></h3>


<p><a href="http://devcenter.heroku.com/heroku-command">Herokuのコマンド</a>はたくさんあるので、ここでは簡単に触れる程度にとどめますが、少しだけ使ってみましょう。アプリケーションの名前を変更してみます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku rename railstutorial
</pre></div>
</div>


<p>注意: この名前は、私のサンプルアプリケーションで既に使用していますので、他の名前を使用してください。実際は、Herokuで生成されたデフォルトのアドレスでも十分です。本当にアプリケーションの名前を変えてみたい場合は、次のようなランダムなサブドメイン名を設定し、この章の冒頭で説明したアプリケーションのセキュリティを実装してみる方法もあります。</p>

<pre class="verbatim">hwpcbmze.heroku.com
seyjhflo.heroku.com
jhyicevg.heroku.com</pre>


<p>このようなでたらめのサブドメイン名なら、アドレスを渡さない限りサイトがアクセスされる心配もありません。(ちなみに、Rubyの威力の一端をお見せするために、ランダムなサブドメイン名を生成するためのコンパクトなコードを以下に記します。</p>

<div class="code"><div class="highlight"><pre><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">shuffle</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">7</span><span class="o">].</span><span class="n">join</span>
</pre></div>
</div>


<p>最高ですね。)</p>

<p>Herokuでは、サブドメインの他に独自ドメインも使用できます。(実は、この<a href="http://railstutorial.jp">Ruby on RailsチュートリアルWebサイト</a>もHeroku上にあるのです。あなたが本書をオンラインで読んでいるということは、まさにHerokuにホスティングされたWebサイトを見ているということになります。) カスタムドメインや他のHeroku関連の情報については、<a href="http://devcenter.heroku.com/">Herokuドキュメント</a>を参照してください。</p>

<div class="label" id="sec-beginning_conclusion"></div>


<h2><a id="sec-1_5" href="./beginning.html#sec-beginning_conclusion" class="heading"><span class="number">1.5</span>最後に</a></h2>


<p>この章ではインストール、開発環境の設定、バージョン管理、本番環境へのデプロイなど、多くの課題を達成しました。ここまでの進捗をTwitterに投稿したりFacebookで通知するには以下のリンクからどうぞ。</p>

<div class="center"><a href="http://twitter.com/?status=RailsチュートリアルでRuby on Railsを学習中!%20http://railstutorial.jp/%20via%20@railstutorialjp">RailsチュートリアルでRuby on Railsを学習中! http://railstutorial.jp/</a></div>


<p> </p>

<p>後は、Railsを実際に勉強するだけです。一緒に頑張りましょう。</p>

<div class="navigation">  <a class="next_page" href="./a-demo-app.html#top">
</a><a class="next_page" href="./a-demo-app.html#top">    <span class="number">第2章</span>デモアプリケーション»</a><a class="next_page" href="./a-demo-app.html#top">  </a>

<a class="prev_page" href="/"></a>
<a class="prev_page" href="/">
  <span class="number">トップページ</span></a>
<a class="prev_page" href="/">  </a>

</div><div class="footnotes">
<ol>
<li id="fn-1_1"><em>URI</em>はUniform Resource Identifierの略です。それよりやや一般性の低い<em>URL</em>はUniform Resource Locatorの略です。URIは、要するに「ブラウザのアドレスバーにあるあれ」と考えればだいたい合っています。<a class="arrow" href="./beginning.html#fnref-1_1">↑</a></li>
<li id="fn-1_2">http://tryruby.org/ <a class="arrow" href="./beginning.html#fnref-1_2">↑</a></li>
<li id="fn-1_3">http://railsforzombies.org/ <a class="arrow" href="./beginning.html#fnref-1_3">↑</a></li>
<li id="fn-1_4">http://railstutorial.jp/screencasts <a class="arrow" href="./beginning.html#fnref-1_4">↑</a></li>
<li id="fn-1_5"><em>Railsチュートリアル</em>を読んでいて、チュートリアル内部の別セクション番号へのリンクをクリックして移動したら、なるべくすぐに元の場所に戻ることをお勧めします。Webページで読んでいる場合は、ブラウザの [戻る] ボタンで戻れます。Adobe ReaderやOS XのプレビューでPDF版を読んでいる場合でも、同様に戻る方法があります。Adobe Readerの場合は、ドキュメント画面を右クリックして [Previous View]をクリックします。OS X Previewの場合はメニューの <tt>[移動] &gt; [戻る]</tt> で戻れます。<a class="arrow" href="./beginning.html#fnref-1_5">↑</a></li>
<li id="fn-1_6"><code>sudo</code>コマンドを実行するとデフォルトでroot (スーパーユーザー) に切り替わるためか、多くの人がsudoコマンドを &quot;superuser do&quot; の略だと誤って信じています。正しくは、<code>sudo</code>は<code>su</code>コマンドと英語の “do” をつなげたものです。そして<code>su</code>コマンドは “substitute user” (ユーザーの切替) の略なのです。ターミナルで<code>man su</code>と入力すればこのことを確認できます。 <a class="arrow" href="./beginning.html#fnref-1_6">↑</a></li>
<li id="fn-1_7">http://railstutorial.jp/help <a class="arrow" href="./beginning.html#fnref-1_7">↑</a></li>
<li id="fn-1_8">https://github.com/perfectionist/sample_project/wiki <a class="arrow" href="./beginning.html#fnref-1_8">↑</a></li>
<li id="fn-1_9">viは、Unixで古くから使用されているコマンドベースの強力なエディタです。Vimは &quot;vi improved&quot; の略です。<a class="arrow" href="./beginning.html#fnref-1_9">↑</a></li>
<li id="fn-1_10">https://github.com/mhartl/rails_tutorial_sublime_text <a class="arrow" href="./beginning.html#fnref-1_10">↑</a></li>
<li id="fn-1_11">IRCが初めてであれば、まず “irc client &lt;あなたのプラットフォーム&gt;”で検索することをお勧めします。 OS X用のネイティブクライアントとしては<a href="http://colloquy.info/">Colloquy</a>と<a href="http://limechat.net/mac/">LimeChat</a>がお勧めです。もちろんWeb版のインターフェイスもあります。<a href="http://webchat.freenode.net/?channels=rvm">http://webchat.freenode.net/?channels=rvm</a> <a class="arrow" href="./beginning.html#fnref-1_11">↑</a></li>
<li id="fn-1_12">場合によっては、動作させるために<a href="http://subversion.tigris.org/">Subversion</a>というバージョン管理システムをインストールしておく必要があるかもしれません。<a class="arrow" href="./beginning.html#fnref-1_12">↑</a></li>
<li id="fn-1_13">http://mxcl.github.com/homebrew/ <a class="arrow" href="./beginning.html#fnref-1_13">↑</a></li>
<li id="fn-1_14">この手順が必要となるのは、Rails gemのバージョンを変更した場合に限られます。おそらくRailsインストーラを使用している場合にしかこういうことは起こらないでしょう。他の場合にこの手順を実行しても大丈夫です。<a class="arrow" href="./beginning.html#fnref-1_14">↑</a></li>
<li id="fn-1_15">https://developer.apple.com/downloads/ <a class="arrow" href="./beginning.html#fnref-1_15">↑</a></li>
<li id="fn-1_16">Windowsユーザーの場合は代わりに<code>ruby rails server</code>と入力する必要がある場合があると<a class="ref" href="./beginning.html#sec-conventions">1.1.3</a>に書いてあったことを思い出してください。<a class="arrow" href="./beginning.html#fnref-1_16">↑</a></li>
<li id="fn-1_17">通常、Webサイトは80番ポートで受信待ちしますが、このポートを使用するには特別な権限が必要になることが多いので、Railsの開発用サーバーでは制限の少ない、番号の大きいポート (いわゆるハイナンバーポート) を使用します。<a class="arrow" href="./beginning.html#fnref-1_17">↑</a></li>
<li id="fn-1_18">GUIエディタの起動後もターミナルを使用し続けることはできます。ただし、Gitはデタッチ時にコミットメッセージが空のままファイルを閉じたとみなすため、コミットは中断されます。Gitのエディタオプションで<code>subl</code>や<code>gvim</code>にフラグを付けないと、このあたりの動作で頭が混乱するかもしれません (訳注: gitのエディタ設定はGUIエディタとあまり相性がよくないらしく、vimやnanoのようなコマンドベースのエディタを選択するのが無難なようです)。この注釈の意味がよくわからない場合は、無視してくださってよいです。<a class="arrow" href="./beginning.html#fnref-1_18">↑</a></li>
<li id="fn-1_19"><code>.gitignore</code>がディレクトリに見当たらない場合は、ファイルブラウザやエクスプローラで隠しファイルを表示するよう設定を変更する必要があるかもしれません。<a class="arrow" href="./beginning.html#fnref-1_19">↑</a></li>
<li id="fn-1_20"><code>git status</code>を実行したときに表示して欲しくないファイルがあれば、それらのファイルを<a class="ref" href="./beginning.html#code-gitignore">1.7</a>の<code>.gitignore</code>ファイルに追加してください。<a class="arrow" href="./beginning.html#fnref-1_20">↑</a></li>
<li id="fn-1_21">詳細については<a href="http://git-scm.com/book/ja/v1/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD"><em>Pro Git</em>の「Gitのブランチ機能」</a>を参照してください。<a class="arrow" href="./beginning.html#fnref-1_21">↑</a></li>
<li id="fn-1_22"><em>Railsチュートリアル</em>のサンプル・アプリケーションでは気にする必要はありません。作りかけの恥ずかしいWebアプリケーションをネットにうっかり公開してしまわないだろうかと心配する方もいらっしゃるかと思いますが、それを防ぐための方法はいくつもありますのでご安心ください。<a class="ref" href="./beginning.html#sec-heroku_commands">1.4.4</a>はその方法の1つです。<a class="arrow" href="./beginning.html#fnref-1_22">↑</a></li>
<li id="fn-1_23">“Engine X&quot; と発音します。<a class="arrow" href="./beginning.html#fnref-1_23">↑</a></li>
<li id="fn-1_24">Herokuは、Ruby Webプラットフォームに<a href="http://rack.rubyforge.org/">Rackミドルウェア</a>が導入されていれば動作します。このミドルウェアは、WebフレームワークとWebサーバーの標準インターフェイスを提供します。Rackインターフェイスを導入したことで、Rubyコミュニティは大きな力を得ることができました。Rackはさまざまなフレームワークに導入されており、<a href="http://www.sinatrarb.com/">Sinatra</a>、<a href="http://ramaze.net/">Ramaze</a>、<a href="http://camping.rubyforge.org/files/README.html">Camping</a>、そしてRubyがRackを採用しています。つまり、RubyのWebアプリケーションは基本的にHerokuでサポートされているということです。<a class="arrow" href="./beginning.html#fnref-1_24">↑</a></li>
<li id="fn-1_25">https://toolbelt.heroku.com/ <a class="arrow" href="./beginning.html#fnref-1_25">↑</a></li>
</ol>
</div>




    </div>
  </body>
</html>
